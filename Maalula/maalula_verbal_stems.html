<head>

<title>NWA Verb</title>

<style>
html {
  overflow-y: scroll;
}
p {margin:0;padding:1.5}
.header {
    background-color: lightgray;
    border: none;
    color: black;
    padding: 17px 0px;
    height: 50px;
    display: block;
    text-align: center;
    font-size: 36px;
    width: 100%;
    margin-left:auto;
    margin-right:auto;

}
.element {
    background-color: white;
    border: none;
    padding: 1px 0px;
    display: block;
    text-align: center;
    font-size: 36px;
    width: 100%;
    margin-left:auto;
    margin-right:auto;
}
.center {
    background-color: white;
    border: none;
    padding: 2px 0px;
    display: block;
    text-align: center;
    width: 100%;
    margin-left:auto;
    margin-right:auto;

}


</style>

</head>


<meta charset="UTF-8">
<h2 id="dictName" class="header"> 
  NWA Verb: Roots and Stems
</h2>

<span class="center">
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <b>Multiline:</b> 
  <input 
     type="checkbox" 
     id="multiline"  
     onclick="multiline()"
     checked
   />
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <b>Number of stems</b> 
  <input 
     type="checkbox" 
     id="ranges"  
     onclick="makeRanges()"
     checked
   />
</span>


<span class="center">
  <button 
     id="clipboard" 
     style="font-size:14pt;height:30pt" 
     onclick="outputToClip()"
  >
       Copy output to clipboard
  </button>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 

  <button 
     id="defaults" 
     style="font-size:20pt;height:35pt" 
     onclick="clearAll()"
  >
       Clear All
  </button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

  <input 
     type="search" 
     id="myInput" 
     style="font-size:20pt;height:35pt"
     value=""
  />
  <button 
     id="myBtn" 
     style="font-size:20pt;height:35pt" 
     onclick="search()"
  >
       Search
  </button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <span id="rangesInput"
	style="
	 position: absolute;
	 float:center;"
  >
  </span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

</span>
 



<br>
<form id="stem" onchange="input.focus()">
<table 
   onchange="changeTable()"
   id="table"
   cellpadding="2%" 
   style="
      margin-left: auto;
      margin-right: auto;
      font-weight:bold; 
      font-size:18pt; 
      float:center" 
   width="800" 
   border="2" 
   rules="rows"
>
  <tr bgcolor="#e0ebeb"> 
     <td id="I" align="left">
        I
     </td> 
     <td align="left">
  <label for="I_any">
    <input id="I_any" type="radio" name="I" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="I_yes">
    <input id="I_yes" type="radio" name="I" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="I_no">
    <input id="I_no" type="radio" name="I" value="no">no
  </label>
     </td> 
  </tr>

  <tr> 
     <td id="II" align="left">
        II
     </td> 
     <td align="left">
  <label for="II_any">
    <input id="II_any" type="radio" name="II" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="II_yes">
    <input id="II_yes" type="radio" name="II" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="II_no">
    <input id="II_no" type="radio" name="II" value="no">no
  </label>
     </td> 
  </tr>

  <tr bgcolor="#e0ebeb"> 
     <td id="III" align="left">
        III
     </td> 
     <td align="left">
  <label for="III_any">
    <input id="III_any" type="radio" name="III" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="III_yes">
    <input id="III_yes" type="radio" name="III" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="III_no">
    <input id="III_no" type="radio" name="III" value="no">no
  </label>
     </td> 
  </tr>

  <tr> 
     <td id="IV" align="left">
        IV
     </td> 
     <td align="left">
  <label for="IV_any">
    <input id="IV_any" type="radio" name="IV" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="IV_yes">
    <input id="IV_yes" type="radio" name="IV" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="IV_no">
    <input id="IV_no" type="radio" name="IV" value="no">no
  </label>
     </td> 
  </tr>

  <tr bgcolor="#e0ebeb"> 
     <td id="I(2)" align="left">
        I(2)
     </td> 
     <td align="left">
  <label for="I(2)_any">
    <input id="I(2)_any" type="radio" name="I(2)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="I(2)_yes">
    <input id="I(2)_yes" type="radio" name="I(2)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="I(2)_no">
    <input id="I(2)_no" type="radio" name="I(2)" value="no">no
  </label>
     </td> 
  </tr>

  <tr> 
     <td id="II(2)" align="left">
        II(2)
     </td> 
     <td align="left">
  <label for="II(2)_any">
    <input id="II(2)_any" type="radio" name="II(2)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="II(2)_yes">
    <input id="II(2)_yes" type="radio" name="II(2)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="II(2)_no">
    <input id="II(2)_no" type="radio" name="II(2)" value="no">no
  </label>
     </td> 
  </tr>

  <tr bgcolor="#e0ebeb"> 
     <td id="III(2)" align="left">
        III(2)
     </td> 
     <td align="left">
  <label for="III(2)_any">
    <input id="III(2)_any" type="radio" name="III(2)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="III(2)_yes">
    <input id="III(2)_yes" type="radio" name="III(2)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="III(2)_no">
    <input id="III(2)_no" type="radio" name="III(2)" value="no">no
  </label>
     </td> 
  </tr>

  <tr> 
     <td id="IV(2)" align="left">
        IV(2)
     </td> 
     <td align="left">
  <label for="IV(2)_any">
    <input id="IV(2)_any" type="radio" name="IV(2)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="IV(2)_yes">
    <input id="IV(2)_yes" type="radio" name="IV(2)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="IV(2)_no">
    <input id="IV(2)_no" type="radio" name="IV(2)" value="no">no
  </label>
     </td> 
  </tr>

  <tr bgcolor="#e0ebeb"> 
     <td id="I(7)" align="left">
        I(7)
     </td> 
     <td align="left">
  <label for="I(7)_any">
    <input id="I(7)_any" type="radio" name="I(7)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="I(7)_yes">
    <input id="I(7)_yes" type="radio" name="I(7)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="I(7)_no">
    <input id="I(7)_no" type="radio" name="I(7)" value="no">no
  </label>
     </td> 
  </tr>

  <tr> 
     <td id="I(8)" align="left">
        I(8)
     </td> 
     <td align="left">
  <label for="I(8)_any">
    <input id="I(8)_any" type="radio" name="I(8)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="I(8)_yes">
    <input id="I(8)_yes" type="radio" name="I(8)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="I(8)_no">
    <input id="I(8)_no" type="radio" name="I(8)" value="no">no
  </label>
     </td> 
  </tr>

  <tr bgcolor="#e0ebeb"> 
     <td id="I(10)" align="left">
        I(10)
     </td> 
     <td align="left">
  <label for="I(10)_any">
    <input id="I(10)_any" type="radio" name="I(10)" value="any" checked>any
  </label>
     </td> 
     <td align="left">
  <label for="I(10)_yes">
    <input id="I(10)_yes" type="radio" name="I(10)" value="yes">yes
  </label>
     </td> 
     <td align="left">
  <label for="I(10)_no">
    <input id="I(10)_no" type="radio" name="I(10)" value="no">no
  </label>
     </td> 
  </tr>

</table>
</form>




<p 
   id="output" 
   style="
          font-size:18pt; 
          padding-left:10%;
          padding-right:10%;"
>
</p>


<script src="verb.js"></script>
<script src="../myLibraries/copyToClip.js">
</script>

<script>


const blue = ["<font color='blue'>","</font>"];
const bluebold = ["<b><font color='blue'>","</font></b>"];
const bold = ["<b>","</b>"];
const redbold = ["<b><font color='red'>","</font></b>"];
const numColor = ["<b><font color='#b30000'>","</font></b>"];
const stems = [
    "I", 
    "II", 
    "III", 
    "IV", 
    "I(2)", 
    "II(2)", 
    "III(2)", 
    "IV(2)", 
    "I(7)", 
    "I(8)", 
    "I(10)",
  ];

let flagRanges;
makeRanges();

let perf = [];
perf = perfInit();

let flagMultiline = "m"; 

let stemsFrom;
let stemsTo;


let input = document.getElementById("myInput");
input.focus();
input.addEventListener("keyup", 
  function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
        document.getElementById("myBtn").click();
    }
  }
);

let stem = document.getElementById("stem");


function changeTable() {
  input.focus();
  for (let stemmy of stems) {
    switch (stem.elements[stemmy].value) { 
      case "yes":
    document.getElementById(stemmy).style.backgroundColor = "#00ff00";  
        break;
      case "no":
    document.getElementById(stemmy).style.backgroundColor = "#ff3333";  
        break
      case "any":
    document.getElementById(stemmy).style.backgroundColor = "";  
        break
    }

  }
}
  
function clearAll() {
  input.focus();
  for (let stemmy of stems) {
    stem.elements[stemmy].value = "any";
    document.getElementById(stemmy).style.backgroundColor = "";  
  }
  document.getElementById("output").innerHTML = "";
  document.getElementById("multiline").checked = true;
  document.getElementById("from").value = "";    
  document.getElementById("to").value = "";    
  input.value = "";
  
}

function multiline() {
  input.focus();
  flagMultiline = "m";
  let checkBox = document.getElementById("multiline");
  if (!(checkBox.checked)) { flagMultiline = "" }
}


function search() {
  setRanges();
  let regSearch;
  let regYes = [];
  let regNo = [];
  for (let stemmy of stems) {
    stemReady = "^" + stemmy.replace( /\(/, "\\(" ).replace( /\)/, "\\)" ) + " ";
    switch (stem.elements[stemmy].value) { 
      case "any": 
        break;
      case "yes":
        regYes.push( stemReady );
        break;
      case "no":
        regNo.push( stemReady );
        break
    }
  }
  if (input.value) {
    regSearch = input.value;
  }
  input.focus();
  if ( 
       (regYes.length == 0) &&  
       (regNo.length == 0) &&
       (!(regSearch)) &&
       ((!(flagRanges)) ||
        (flagRanges && ( stemsTo - stemsFrom >= 11 )))
     ) {
    document.getElementById("output").innerHTML = 
          numColor.join("Please provide meaningful search conditions");
    return;
  }
  main(regSearch, regYes, regNo);
}

function main(regSearch, regYes, regNo) {
  regYes = regYes.map(s => RegExp(s, "gmu"));
  regNo = regNo.map(s => RegExp(s, "gmu"));
  if (regSearch) {
    flagSearch = "g" + flagMultiline + "u";
    regSearch = RegExp(regSearch, flagSearch);
    regYes.unshift(regSearch);
  }
  let data = perf;
  let output = [];
  output = greppyArray( data, regYes, regNo ); 
  output = output.filter( s => matchesRange( s, /(^|>)I/gm, stemsFrom, stemsTo ) );

  let numberOfLines = output.length;
  let message = numberOfLines + " verbal roots found";
  message = numColor.join(numColor.join(message));
  output.unshift(message);
  output = output.map(s => s.replace(/(^.*)\n/mu, bold.join("$1\n"))); 
  output = paragrify(output);
  document.getElementById("output").innerHTML = output.join("\n");
}

function outputToClip() {
  htm = document.getElementById('output').innerHTML;
  copyToClip(htm);

}

function paragrify( output ) {
  let result = [];
  for (i=0; i<output.length; i++) {
    let lines = output[i].split("\n");
    for (let line of lines) {
      newLine = "<p style='margin:0cm;margin-bottom:0pt;line-height: 1'>\n" + 
          line + 
          "\n<\/p>\n";
      result.push(newLine); 
    }
    result.push("<p style='margin:0cm;margin-bottom:0pt;line-height: 1'><br><\/p>");
  }
  return result;
}

function greppyArray( arr, regYes, regNo ) {
  let output = [];
  for (let el of arr) {
    let flag = true;
    for (let reg of regYes) {
      let testy = (el.search(reg) > -1);
      if (!testy) {
        flag = false;
        break;
      }
    }
    for (let reg of regNo) {
      let testy = (el.search(reg) > -1);
      if (testy) {
        flag = false;
        break;
      }
    }
    if (flag) {
      for (reg of regYes) {
        el = el.replace(reg, redbold.join("$&"));
      }
      output.push(el);
    }
  }
  return output;
}

function matchesRange( str, reg, m, n ) {
  let number = (str.match( reg ) || []).length;
  return ( ( m <= number ) && ( number <=n ) );
}

function setRanges(){
  stemsFrom = 0;
  stemsTo = 11;
  if (flagRanges) {
    stemsFrom = document.getElementById("from").value;    
    stemsTo = document.getElementById("to").value;    
    stemsFrom = stemsFrom || 0;
    stemsTo = stemsTo || 11;
  } 
}

function makeRanges() {
  flagRanges = document.getElementById("ranges").checked;
  let rangesInput = document.getElementById("rangesInput");
  let rangesHTML = `
    <input 
       type="search" 
       id="from" 
       placeholder="from"  
       size="2" 
       maxlength="2" 
       style="font-size:20pt;height:35pt" 
    ></input>
    <input 
       type="search" 
       id="to" 
       placeholder="to"  
       size="2" 
       maxlength="2" 
       style="font-size:20pt;height:35pt" 
    ></input>
  `;
  rangesInput.innerHTML = "";
  if (flagRanges) {
  rangesInput.innerHTML = rangesHTML;
  }
}

</script>

<!--- 
- 
-->
