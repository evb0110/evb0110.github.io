import{d as E,aH as F,aB as y,c,E as m,b as M,a as U,o as b,f as _,k as u,g,i as h,h as w,V as A,p as N,_ as C,aI as I,F as L,n as J}from"./index-QbBoz4qz.js";import{a as P}from"./axios-CCb-kr4I.js";import{a as D}from"./assets-BulKEVUh.js";import{g as O}from"./getRegexFilterFn-CU_0py8y.js";import{b as Q}from"./betterSplit-CW8NIeFU.js";import{V}from"./VTextField-BwmyCn67.js";import{_ as z}from"./InfiniteScroll.vue_vue_type_script_setup_true_lang-zX6Fw6e7.js";import"./VInput-CVgha8SZ.js";import"./forwardRefs-DWGaNmQL.js";function G(i,l,e="application/octet-stream"){const s=document.createElement("a"),n=new Blob([i],{type:e});s.href=URL.createObjectURL(n),s.download=l,s.click()}function v(i,l,e="",s=!1){const d=(e?`color: ${e};`:"")+(s?"font-weight: bold;":""),t=d?` style='${d}'`:"";return`<${l}${t}>${i}</${l}>`}function q(i){const l=i.map(e=>`(?:${e})`).join("|");return RegExp(l)}const x=v("<br>","div"),B=E("calStore",()=>{const i=F(async()=>{const a=`=============
`,{data:p}=await P.get(D.calJson.link);return p.split(a).filter(Boolean).map(f=>f.split(`
`)).map(([f,...k])=>({entryName:f.replace(/\.txt$/,""),contents:k,contentsString:k.join(`
`)}))},[]),l=y("positive",""),e=y("negative",""),s=y("highlight",""),n=c(()=>({positive:l.value,negative:e.value,highlight:s.value})),o=c(()=>m.mapValues(n.value,X)),d=c(()=>!o.value.positive.length&&!o.value.negative.length),t=c(()=>O(o.value.positive.map(a=>RegExp(a)),o.value.negative.map(a=>RegExp(a)))),r=c(()=>d.value?[]:i.value.filter(a=>t.value(a.contentsString))),S=c(()=>{const a=m.mapValues(o.value,p=>p.some(m.identity)&&p.join(", "));return[a.positive&&`Should contain: ${a.positive}`,a.negative&&`Should not contain: ${a.negative}`,a.highlight&&`Highlight: ${a.highlight}`].filter(Boolean).map(p=>v(p,"div","brown",!0))}),T=c(()=>{if(!r.value.length)return"";const a=[`Total: ${r.value.length} entries`].map(f=>v(f,"div","green",!0)),p=v("=".repeat(25),"div");return[...S.value,a,p].join(x)}),R=c(()=>m.values(o.value).flat()),j=c(()=>q(R.value)),$=c(()=>{if(!r.value.length)return[];const a=r.value.map(W(j.value));return[T.value,x,...a]}),H=c(()=>$.value.join(""));return{cal:i,positive:l,negative:e,highlight:s,searchers:n,searchObj:o,isNoSearch:d,calMatchingParts:$,calMatchingHTML:H}});function K(i){return function(l){const e=Q(l,i).reduce((s,n,o)=>{const d=o%2?"red":"",t=o%2;return s+v(n,"span",d,t)},"");return v(e,"div")}}function W(i){return function({entryName:l,contents:e}){const s=v("+".repeat(25),"div","blue"),n=v(l,"div","purple",!0),o=e.map(K(i));return[n,...o,s,x].join("")}}function X(i){return m.chain(i).split(",").map(m.trim).compact().value()}const Y={class:"inputs"},Z={class:"input-block"},tt={class:"input-block"},et={class:"input-block"},nt=M({__name:"CalInputs",emits:["download"],setup(i,{emit:l}){const e=B(),s=l,n=U(e.searchers),o=m.debounce(()=>{m.assign(e,n)},1e3);return(d,t)=>(b(),_("div",Y,[u("div",Z,[t[4]||(t[4]=u("div",{class:"input-block__title"},"Should contain:   ",-1)),g(V,{modelValue:n.positive,"onUpdate:modelValue":[t[0]||(t[0]=r=>n.positive=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[5]||(t[5]=u("div",{class:"input-block__hint"},"e.g. Gal, Sam, CPA ",-1))]),u("div",tt,[t[6]||(t[6]=u("div",{class:"input-block__title"},"Should not contain:   ",-1)),g(V,{modelValue:n.negative,"onUpdate:modelValue":[t[1]||(t[1]=r=>n.negative=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[7]||(t[7]=u("div",{class:"input-block__hint"},"e.g. Syr, JBA, Man, Com",-1))]),u("div",et,[t[8]||(t[8]=u("div",{class:"input-block__title"},"Also highlight:   ",-1)),g(V,{modelValue:n.highlight,"onUpdate:modelValue":[t[2]||(t[2]=r=>n.highlight=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[9]||(t[9]=u("div",{class:"input-block__hint"},"e.g. LJLA, Qumran, Jud",-1))]),g(A,{disabled:h(e).isNoSearch,color:"green",variant:"outlined",class:"button",size:"large",onClick:t[3]||(t[3]=r=>s("download"))},{default:w(()=>t[10]||(t[10]=[N(" Download ")])),_:1},8,["disabled"])]))}}),ot=C(nt,[["__scopeId","data-v-b21a4d58"]]),at=["innerHTML"],lt=M({__name:"CalSearch",setup(i){const l=B(),{calMatchingParts:e,calMatchingHTML:s}=I(l),n=()=>{G(s.value,"result.html")};return(o,d)=>(b(),_(L,null,[g(h(ot),{onDownload:n}),g(z,{items:h(e),class:"search-results-box"},{default:w(({items:t})=>[(b(!0),_(L,null,J(t,(r,S)=>(b(),_("div",{key:S},[u("div",{innerHTML:r},null,8,at)]))),128))]),_:1},8,["items"])],64))}}),gt=C(lt,[["__scopeId","data-v-f894bcc4"]]);export{gt as default};
