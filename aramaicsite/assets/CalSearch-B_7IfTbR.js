import{d as E,c as u,E as m,b as k,a as F,o as _,f as S,n as p,g as h,m as f,h as M,j as U,V as A,_ as C,aH as N,F as L,i as I}from"./index-BmEQ_S1N.js";import{u as V}from"./index-CXZ00WhQ.js";import{g as J}from"./getRegexFilterFn-CU_0py8y.js";import{b as P}from"./betterSplit-CW8NIeFU.js";import{u as D}from"./assetsStore-p4TiRUo-.js";import{V as y}from"./VTextField-Ewql0E_3.js";import{_ as O}from"./InfiniteScroll.vue_vue_type_script_setup_true_lang-DEPAuEf8.js";import"./VInput-2PoRnf6A.js";import"./forwardRefs-DWGaNmQL.js";function Q(s,a,e="application/octet-stream"){const l=document.createElement("a"),n=new Blob([s],{type:e});l.href=URL.createObjectURL(n),l.download=a,l.click()}function v(s,a,e="",l=!1){const i=(e?`color: ${e};`:"")+(l?"font-weight: bold;":""),t=i?` style='${i}'`:"";return`<${a}${t}>${s}</${a}>`}function z(s){const a=s.map(e=>`(?:${e})`).join("|");return RegExp(a)}const $=v("<br>","div"),G=`=============
`,w=E("calStore",()=>{const s=D(),a=u(()=>{var o;return((o=s.calJson.data)==null?void 0:o.split(G).filter(Boolean).map(d=>d.split(`
`)).map(([d,...b])=>({entryName:d.replace(/\.txt$/,""),contents:b,contentsString:b.join(`
`)})))||[]}),e=V("positive",""),l=V("negative",""),n=V("highlight",""),r=u(()=>({positive:e.value,negative:l.value,highlight:n.value})),i=u(()=>m.mapValues(r.value,W)),t=u(()=>!i.value.positive.length&&!i.value.negative.length),c=u(()=>J(i.value.positive.map(o=>RegExp(o)),i.value.negative.map(o=>RegExp(o)))),g=u(()=>t.value?[]:a.value.filter(o=>c.value(o.contentsString))),T=u(()=>{const o=m.mapValues(i.value,d=>d.some(m.identity)&&d.join(", "));return[o.positive&&`Should contain: ${o.positive}`,o.negative&&`Should not contain: ${o.negative}`,o.highlight&&`Highlight: ${o.highlight}`].filter(Boolean).map(d=>v(d,"div","brown",!0))}),j=u(()=>{if(!g.value.length)return"";const o=[`Total: ${g.value.length} entries`].map(b=>v(b,"div","green",!0)),d=v("=".repeat(25),"div");return[...T.value,o,d].join($)}),B=u(()=>m.values(i.value).flat()),R=u(()=>z(B.value)),x=u(()=>{if(!g.value.length)return[];const o=g.value.map(K(R.value));return[j.value,$,...o]}),H=u(()=>x.value.join(""));return{cal:a,positive:e,negative:l,highlight:n,searchers:r,searchObj:i,isNoSearch:t,calMatchingParts:x,calMatchingHTML:H}});function q(s){return function(a){const e=P(a,s).reduce((l,n,r)=>{const i=r%2?"red":"",t=r%2;return l+v(n,"span",i,t)},"");return v(e,"div")}}function K(s){return function({entryName:a,contents:e}){const l=v("+".repeat(25),"div","blue"),n=v(a,"div","purple",!0),r=e.map(q(s));return[n,...r,l,$].join("")}}function W(s){return m.chain(s).split(",").map(m.trim).compact().value()}const X={class:"inputs"},Y={class:"input-block"},Z={class:"input-block"},tt={class:"input-block"},et=k({__name:"CalInputs",emits:["download"],setup(s,{emit:a}){const e=w(),l=a,n=F(e.searchers),r=m.debounce(()=>{m.assign(e,n)},1e3);return(i,t)=>(_(),S("div",X,[p("div",Y,[t[4]||(t[4]=p("div",{class:"input-block__title"},"Should contain:   ",-1)),h(y,{modelValue:n.positive,"onUpdate:modelValue":[t[0]||(t[0]=c=>n.positive=c),f(r)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[5]||(t[5]=p("div",{class:"input-block__hint"},"e.g. Gal, Sam, CPA ",-1))]),p("div",Z,[t[6]||(t[6]=p("div",{class:"input-block__title"},"Should not contain:   ",-1)),h(y,{modelValue:n.negative,"onUpdate:modelValue":[t[1]||(t[1]=c=>n.negative=c),f(r)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[7]||(t[7]=p("div",{class:"input-block__hint"},"e.g. Syr, JBA, Man, Com",-1))]),p("div",tt,[t[8]||(t[8]=p("div",{class:"input-block__title"},"Also highlight:   ",-1)),h(y,{modelValue:n.highlight,"onUpdate:modelValue":[t[2]||(t[2]=c=>n.highlight=c),f(r)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[9]||(t[9]=p("div",{class:"input-block__hint"},"e.g. LJLA, Qumran, Jud",-1))]),h(A,{disabled:f(e).isNoSearch,color:"green",variant:"outlined",class:"button",size:"large",onClick:t[3]||(t[3]=c=>l("download"))},{default:M(()=>t[10]||(t[10]=[U(" Download ")])),_:1},8,["disabled"])]))}}),nt=C(et,[["__scopeId","data-v-b21a4d58"]]),ot=["innerHTML"],at=k({__name:"CalSearch",setup(s){const a=w(),{calMatchingParts:e,calMatchingHTML:l}=N(a),n=()=>{Q(l.value,"result.html")};return(r,i)=>(_(),S(L,null,[h(f(nt),{onDownload:n}),h(O,{items:f(e),class:"search-results-box"},{default:M(({items:t})=>[(_(!0),S(L,null,I(t,(c,g)=>(_(),S("div",{key:g},[p("div",{innerHTML:c},null,8,ot)]))),128))]),_:1},8,["items"])],64))}}),vt=C(at,[["__scopeId","data-v-f894bcc4"]]);export{vt as default};
