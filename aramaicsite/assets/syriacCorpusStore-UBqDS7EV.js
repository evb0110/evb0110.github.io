var J=Object.defineProperty;var X=(t,e,s)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var y=(t,e,s)=>X(t,typeof e!="symbol"?e+"":e,s);import{aF as H,c as g,E as j,d as Q,U as Y,r as L,aG as q}from"./index-wqI0NW7N.js";import{u as $,A as v}from"./assetsStore-Axe9xE9o.js";import{u as Z}from"./index-Dt2_Lpnx.js";const ee=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/gu,te=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/u,se=/(?![\u0701-\u0709]|[\u0730-\u074c])[^\p{M}]/u;class I{constructor(e){y(this,"id",H());y(this,"str");y(this,"_nfd",null);y(this,"_stripped",null);y(this,"_chunks",null);this.str=e}static addFlagIfAbsent(e,s){return e.includes(s)?e:e+s}get nfd(){return this._nfd||this.cacheNFD(),this._nfd}get stripped(){return this._stripped||this.cacheStripped(),this._stripped}get chunks(){return this._chunks||this.cacheChunks(),this._chunks||[]}cacheNFD(){this._nfd||(this._nfd=this.str.normalize("NFD"))}cacheStripped(){var e;this._stripped||(this._stripped=((e=this.nfd)==null?void 0:e.replace(ee,""))||"")}cacheChunks(){this._chunks||(this._chunks=this.str===this.stripped?this.str.split(""):this.makeNFDChunks())}makeNFDChunks(){var r;const e=((r=this.nfd)==null?void 0:r.split(""))||[],s=[];let n=0;s[n]="";for(let i=0;i<e.length;i++)s[n]+=e[i],i+1<e.length&&!te.test(e[i+1])&&se.test(s[n])&&(n++,s[n]="");return s}splitInclusive(e){e=RegExp(e.source,I.addFlagIfAbsent(e.flags,"g"));const s=Array.from(this.stripped.matchAll(e)),n=[];let r=0;for(const i of s){const o=i[0].length,c=i.index;n.push(this.chunks.slice(r,c).join("")),n.push(this.chunks.slice(c,c+o).join("")),r=c+o}return n.push(this.chunks.slice(r).join("")),n}}const k=(t,e)=>e.some(s=>t instanceof s);let P,x;function ne(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function re(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,C=new WeakMap,D=new WeakMap;function ie(t){const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{s(p(t.result)),r()},o=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return D.set(e,t),e}function oe(t){if(B.has(t))return;const e=new Promise((s,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{s(),r()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});B.set(t,e)}let A={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return B.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return p(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function O(t){A=t(A)}function ae(t){return re().includes(t)?function(...e){return t.apply(M(this),e),p(this.request)}:function(...e){return p(t.apply(M(this),e))}}function ce(t){return typeof t=="function"?ae(t):(t instanceof IDBTransaction&&oe(t),k(t,ne())?new Proxy(t,A):t)}function p(t){if(t instanceof IDBRequest)return ie(t);if(C.has(t))return C.get(t);const e=ce(t);return e!==t&&(C.set(t,e),D.set(e,t)),e}const M=t=>D.get(t);function ue(t,e,{blocked:s,upgrade:n,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),c=p(o);return n&&o.addEventListener("upgradeneeded",a=>{n(p(o.result),a.oldVersion,a.newVersion,p(o.transaction),a)}),s&&o.addEventListener("blocked",a=>s(a.oldVersion,a.newVersion,a)),c.then(a=>{i&&a.addEventListener("close",()=>i()),r&&a.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const le=["get","getKey","getAll","getAllKeys","count"],de=["put","add","delete","clear"],S=new Map;function R(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(S.get(e))return S.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,r=de.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(r||le.includes(s)))return;const i=async function(o,...c){const a=this.transaction(o,r?"readwrite":"readonly");let u=a.store;return n&&(u=u.index(c.shift())),(await Promise.all([u[s](...c),r&&a.done]))[0]};return S.set(e,i),i}O(t=>({...t,get:(e,s,n)=>R(e,s)||t.get(e,s,n),has:(e,s)=>!!R(e,s)||t.has(e,s)}));const he=["continue","continuePrimaryKey","advance"],N={},_=new WeakMap,W=new WeakMap,fe={get(t,e){if(!he.includes(e))return t[e];let s=N[e];return s||(s=N[e]=function(...n){_.set(this,W.get(this)[e](...n))}),s}};async function*pe(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const s=new Proxy(e,fe);for(W.set(s,e),D.set(s,M(e));e;)yield s,e=await(_.get(s)||e.continue()),_.delete(s)}function T(t,e){return e===Symbol.asyncIterator&&k(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&k(t,[IDBIndex,IDBObjectStore])}O(t=>({...t,get(e,s,n){return T(e,s)?pe:t.get(e,s,n)},has(e,s){return T(e,s)||t.has(e,s)}}));const me="aramaic-site",f="store",w=ue(me,1,{upgrade(t){if(!t.objectStoreNames.contains(f))return t.createObjectStore(f)}});class F{static async get(e){return(await w).get(f,e)}static async set(e,s){return(await w).put(f,s,e)}static async delete(e){return(await w).delete(f,e)}static async clear(){return(await w).clear(f)}static async keys(){return(await w).getAllKeys(f)}}const E=(t,e)=>{const s=Z(t),n=g({get:()=>{switch(s.value){case"true":return!0;case"false":return!1}},set:r=>{switch(r){case!0:s.value="true";break;case!1:s.value="false";break}}});return j.isBoolean(e)&&(n.value=e),n},ye="ʔbgdhYwzḥṭyklmnsʕpṣqršt",we="AbgdhYwzHTyklmnsCpSqrWt",ge="ܐܒܓܕܗܞܘܙܚܛܝܟܠܡܢܣܥܦܨܩܪܫܬ",[K,V,G]=[ye,we,ge].map(t=>t.split("")),Se={translitArr:K,translitAnsiArr:V,originalLettersArr:G},Ee={pot:{name:"POT with Western vowels"},pnt:{name:"PNT with Western vowels"},syr:{name:"Syriac Corpus"}},ke=Q("syriacCorpusStore",()=>{const t=$(),e=Y([]),s=L(""),n=L(!1),r=E("simpleSymbols"),i=E("translit"),o=E("ignoreDiacritics"),c=g(()=>r.value?V:K),a=g(()=>{const l=s.value;return o.value?i.value?c.value.reduce((d,b,h)=>{const m=G[h],z=RegExp("(?<!\\\\)"+b,"gu");return d.replace(z,m)},l):new I(l).stripped:l}),u=g(()=>{if(!s.value)return[];const l=RegExp(a.value,"u");return o.value?e.value.filter(d=>l.test(d.line.stripped)):e.value.filter(d=>l.test(d.line.str))});async function U(l){e.value=[],n.value=!0;const d=l.map(h=>{switch(h){case"pot":return v.potJson;case"pnt":return v.pntJson;case"syr":default:return v.syrJson}}).flatMap(h=>{var m;return((m=t[h])==null?void 0:m.data)||[]}),b=await Ie(d);e.value=b.map(({filename:h,line:m})=>({filename:h,line:new I(m)})),n.value=!1}return{corpus:e,searchString:s,isPreprocessingSyriacCorpus:n,isSimpleSymbols:r,isTranslit:i,doIgnoreDiacritics:o,activeTranslitArr:c,finalSearchString:a,matchingSyriacLines:u,initSyriacCorpus:U}});async function Ie(t){const e=await q(t),s=await F.get("syriacCorpus")||{},n=s[e];if(n)return n;const r=t.flatMap(({filename:i,text:o})=>o.split(/\n+/).map(j.trim).map(c=>({filename:i,line:c})));return s[e]=r,await F.set("syriacCorpus",s),r}export{F as I,Ee as S,E as a,Se as s,ke as u};
