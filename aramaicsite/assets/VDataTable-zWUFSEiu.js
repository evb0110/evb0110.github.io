var Bt=Object.defineProperty;var Lt=(n,t,e)=>t in n?Bt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var V=(n,t,e)=>Lt(n,typeof t!="symbol"?t+"":t,e);import{I as T}from"./IDB-Q_OVpSNv.js";import{c as Ot}from"./VAvatar-DgRmv6w-.js";import{b4 as zt,z as q,ar as K,c as F,D as Ke,aK as Et,b1 as Rt,B as Nt,C as jt,b5 as Ht,aJ as Ut,aq as Gt,al as Wt,t as A,E as Y,g as b,aQ as Kt,av as Se,aD as $e,V as G,I as D,J as _,aS as qe,K as Qe,ab as Je,ai as Ze,aT as qt,aU as Qt,L as Xe,M as Jt,b2 as Ye,ac as et,b6 as z,r as H,b7 as Zt,af as Xt,b8 as me,ag as Yt,aC as xe,b9 as ea,ah as ce,H as ee,am as Ve,aM as Be,ba as ta,aE as aa,e as Fe,ae as be,bb as tt,ak as te,aj as ae,bc as na,an as W,w as at,a9 as la,bd as sa,G as ie,be as nt,bf as fe,bg as ue,bh as ra,A as ia,bi as oa,F as X,bj as ca,bk as Pe,j as Le,aA as Oe,k as ua,bl as ye,bm as re,m as se,x as da}from"./index-CdId13z1.js";import{V as lt,f as fa,e as ha}from"./VSelect-Dv7lScuN.js";import{V as Ce}from"./VCheckboxBtn-DfL7d19r.js";import{V as ze,m as ma}from"./VTable-Bct_N0Oo.js";function Ee(n,t,e){return Object.keys(n).filter(a=>zt(a)&&a.endsWith(t)).reduce((a,l)=>(a[l.slice(0,-t.length)]=s=>n[l](s,e(s)),a),{})}class ga{parse(t){const e=t.split(`
`).map(i=>i.trim()),a=this.extractValue(e,"xmin"),l=this.extractValue(e,"xmax"),s=[];let r=0;for(;r<e.length&&!e[r].includes("item []:");)r++;for(;r<e.length;){const i=e.findIndex((u,g)=>g>=r&&u.includes("item [")&&u.includes("]:"));if(i===-1)break;r=i+1;const o=e.findIndex((u,g)=>g>=r&&u.includes("name ="));if(o===-1)continue;const c=this.extractQuotedValue(e[o]),f=e.findIndex((u,g)=>g>=r&&u.includes("intervals: size ="));if(f===-1)continue;const h=[];for(r=f+1;r<e.length;){const u=e.findIndex((d,v)=>v>=r&&d.includes("intervals [")&&d.includes("]:"));if(u===-1||e[u+1]&&e[u+1].includes("item ["))break;r=u+1;const g=e.findIndex((d,v)=>v>=r&&v<r+10&&d.includes("xmin =")),m=e.findIndex((d,v)=>v>=r&&v<r+10&&d.includes("xmax =")),w=e.findIndex((d,v)=>v>=r&&v<r+10&&d.includes("text ="));if(g!==-1&&m!==-1&&w!==-1){const d={xmin:parseFloat(e[g].split("=")[1].trim()),xmax:parseFloat(e[m].split("=")[1].trim()),text:this.extractQuotedValue(e[w])},v=d.text.match(/^\s*\((\d+)\)/);v&&(d.utteranceNumber=parseInt(v[1])),h.push(d)}r=Math.max(g,m,w)+1}c&&s.push({name:c,intervals:h})}return{xmin:a,xmax:l,tiers:s}}extractUtteranceTimings(t){const e=new Map,a=t.tiers.find(s=>s.name==="SENT");if(!a)return e;let l=0;for(const s of a.intervals)!s.text||s.text.trim()===""||(l++,e.set(l,{start:s.xmin,end:s.xmax}));return e}extractValue(t,e){const a=t.find(l=>l.startsWith(e+" ="));return a?parseFloat(a.split("=")[1].trim()):0}extractQuotedValue(t){const e=t.match(/"([^"]*)"/);return e?e[1]:""}}const de=new ga,L="masc-corpus",j="metadata",we="folder-handle",pe="cache-version",Re="2.1";class va{constructor(){V(this,"isInitialized",!1);V(this,"initializationPromise",null);V(this,"folderHandle",null);V(this,"metadataCache",null);V(this,"basePath","");V(this,"onlineService",null);V(this,"isOnlineMode",!1)}async checkCacheVersion(){return await T.get(L,j,pe)===Re}async setCacheVersion(){await T.set(L,j,pe,Re)}async requestFolderAccess(){try{return this.folderHandle=await window.showDirectoryPicker({mode:"read",startIn:"downloads"}),await T.set(L,we,"handle",this.folderHandle),await this.processMetadata(),await this.setCacheVersion(),this.isInitialized=!0,!0}catch(t){return console.error("Error requesting folder access:",t),!1}}async loadFolderHandle(){try{const t=await T.get(L,we,"handle");if(!t)return!1;this.folderHandle=t;const e=await this.folderHandle.queryPermission({mode:"read"});return e==="granted"?!0:e==="prompt"?await this.folderHandle.requestPermission({mode:"read"})==="granted":!1}catch(t){return console.error("Error loading folder handle:",t),!1}}async getFileFromFolder(t){if(!this.folderHandle)return null;try{const e=t.split("/");let a=this.folderHandle;for(let r=0;r<e.length-1;r++)e[r]&&(a=await a.getDirectoryHandle(e[r]));const l=e[e.length-1];return await(await a.getFileHandle(l)).getFile()}catch(e){return console.error(`Error getting file ${t}:`,e),null}}async detectFolderStructure(){if(await this.getFileFromFolder("MASC_metadata.csv"))this.basePath="";else if(await this.getFileFromFolder("MASC_v1.0/MASC_metadata.csv"))this.basePath="MASC_v1.0/";else throw new Error("Could not find MASC_metadata.csv. Please select the MASC_v1.0 folder.");console.log("Detected base path:",this.basePath)}async processMetadata(){await this.detectFolderStructure();const t=await this.getFileFromFolder(this.basePath+"MASC_metadata.csv");if(!t)throw new Error("Could not find MASC_metadata.csv");const e=await t.text(),a=this.parseMetadata(e);await T.set(L,j,"speakers",a),await T.set(L,j,"basePath",this.basePath),this.metadataCache=a}parseMetadata(t){var l;const e=t.split(`
`).filter(s=>s.trim()),a=[];for(let s=1;s<e.length;s++){const r=e[s].split(";");r.length>=11&&a.push({serialNumber:parseInt(r[0])||0,textId:((l=r[1])==null?void 0:l.trim())||"",tokens:parseInt(r[2])||0,types:parseInt(r[3])||0,speakerName:r[4]||"",speakerId:r[5]||"",gender:r[6]||"M",age:parseInt(r[7])||0,occupation:r[8]||"",title:r[9]||"",textType:r[10]||""})}return a}async initialize(){if(!this.isInitialized)return this.initializationPromise?this.initializationPromise:(this.initializationPromise=(async()=>{await this.checkCacheVersion()&&(await this.loadFolderHandle()?(this.metadataCache=await T.get(L,j,"speakers"),this.basePath=await T.get(L,j,"basePath")||"",this.isInitialized=!0):await this.clearCache())})(),this.initializationPromise)}async setOnlineMode(t){this.onlineService=t,this.isOnlineMode=!0,this.isInitialized=!0,this.metadataCache=null}async isDataLoaded(){return this.isOnlineMode&&this.onlineService?await this.onlineService.isDataReady():(await this.initialize(),this.isInitialized)}async getMetadata(){if(this.isOnlineMode){const e=await T.get(L,j,"speakers");return e?(this.metadataCache=e,e):[]}if(await this.initialize(),this.metadataCache)return this.metadataCache;const t=await T.get(L,j,"speakers");return t&&(this.metadataCache=t),t||[]}async getTranscription(t,e=!1){if(this.isOnlineMode&&this.onlineService){const r=`${e?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions"}/${t}.txt`,i=await this.onlineService.getTextContent(r);return i?i.charCodeAt(0)===65279||i.startsWith("\uFEFF")?i.substring(1):i:(console.warn(`Could not find transcription file: ${r}`),"")}if(await this.initialize(),!this.folderHandle)return console.error("No folder access"),"";const a=e?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions",l=await this.getFileFromFolder(`${this.basePath}${a}/${t}.txt`);if(l){let s=await l.text();return(s.charCodeAt(0)===65279||s.startsWith("\uFEFF"))&&(s=s.substring(1)),s}return console.warn(`Could not find transcription file: ${this.basePath}${a}/${t}.txt`),""}async getAudioBlob(t){if(this.isOnlineMode&&this.onlineService){const a=`03a_MASC_audio_files/denoised/${t}.mp3`;return await this.onlineService.getFile(a)}return await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}03a_MASC_audio_files/denoised/${t}.mp3`):(console.error("No folder access"),null)}async getTextGrid(t){if(this.isOnlineMode&&this.onlineService){const a=`03b_MASC_textgrid_files/${t}.TextGrid`;return await this.onlineService.getTextContent(a)||""}if(await this.initialize(),!this.folderHandle)return console.error("No folder access"),"";const e=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${t}.TextGrid`);return e?await e.text():""}createAudioUrl(t){return URL.createObjectURL(t)}async searchTranscriptions(t,e=!1){if(await this.initialize(),!this.isInitialized)return console.warn("MASC data not initialized, cannot search"),[];const a=await this.getMetadata(),l=[];for(const s of a){const r=await this.getTranscription(s.textId,e);if(r&&r.toLowerCase().includes(t.toLowerCase())){const o=r.split(`
`).filter(c=>c.trim()).filter(c=>c.toLowerCase().includes(t.toLowerCase()));l.push({textId:s.textId,speaker:s,matches:o.slice(0,3)})}}return l}async getSpeakerTexts(t){return(await this.getMetadata()).filter(a=>a.speakerId===t)}async getTextsBySpeakerAttributes(t){return(await this.getMetadata()).filter(a=>!(t.gender&&a.gender!==t.gender||t.minAge&&a.age<t.minAge||t.maxAge&&a.age>t.maxAge||t.occupation&&!a.occupation.toLowerCase().includes(t.occupation.toLowerCase())))}async clearCache(){await T.set(L,j,pe,null),await T.set(L,we,"handle",null),this.isInitialized=!1,this.initializationPromise=null,this.folderHandle=null,this.metadataCache=null}async getUtteranceTimings(t){if(this.isOnlineMode&&this.onlineService){const e=await this.getTextGrid(t);if(!e)return null;const a=de.parse(e);return de.extractUtteranceTimings(a)}if(await this.initialize(),!this.folderHandle)return console.error("No folder access"),null;try{const e=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${t}.TextGrid`);if(!e)return console.warn(`Could not find TextGrid file for ${t}`),null;const a=await e.text(),l=de.parse(a);return de.extractUtteranceTimings(l)}catch(e){return console.error(`Error loading TextGrid for ${t}:`,e),null}}async getDatabaseFile(){return this.isOnlineMode&&this.onlineService?await this.onlineService.getFile("04_MASC_database/aramaic_corpus.db"):(await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}04_MASC_database/aramaic_corpus.db`):(console.error("No folder access"),null))}}const J=new va,xn=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"})),O="masc-corpus",Ne="https://evb0110.github.io/static/MASC_v1.0/manifest.json",je="https://evb0110.github.io/static/MASC_v1.0/",B={metadata:"metadata",textgrids:"textgrids",transcriptions:"transcriptions",lemmatized:"lemmatized",audio:"audio",database:"database",manifest:"manifest"};class ba{constructor(){V(this,"manifest",null);V(this,"localState",null);V(this,"downloadQueue",[]);V(this,"isDownloading",!1);V(this,"abortController",null);V(this,"isDatabaseInitialized",!1);V(this,"initializationInProgress",!1)}async initialize(){var t;if(this.initializationInProgress){console.log("MASCOnlineService: Initialization already in progress, skipping");return}this.initializationInProgress=!0;try{console.log("MASCOnlineService: Starting initialization"),await this.ensureDatabase(),console.log("MASCOnlineService: Database ensured"),console.log("MASCOnlineService: About to fetch manifest"),await this.fetchManifest(),console.log("MASCOnlineService: Manifest fetched, version:",(t=this.manifest)==null?void 0:t.version),await this.loadLocalState(),console.log("MASCOnlineService: Local state loaded")}catch(e){throw console.error("MASCOnlineService: Initialization error:",e),console.error("Error name:",e.name),console.error("Error message:",e.message),console.error("Error stack:",e.stack),e}finally{this.initializationInProgress=!1}}async ensureDatabase(){if(this.isDatabaseInitialized){console.log("Database already initialized, skipping");return}const t={initialized:!0,timestamp:Date.now()};for(const e of Object.values(B))try{await T.set(O,e,"_init",t),console.log(`Store ${e} initialized`)}catch(a){console.error(`Failed to initialize store ${e}:`,a)}await new Promise(e=>setTimeout(e,100)),this.isDatabaseInitialized=!0}async getDownloadStatus(){if(this.manifest||await this.fetchManifest(),!this.manifest)return{totalFiles:0,downloadedFiles:0,isComplete:!1,missingCritical:[]};this.localState||await this.loadLocalState();const t=Object.keys(this.manifest.files).length,e=this.localState?Object.values(this.localState.files).filter(l=>l.downloaded).length:0,a=await this.getMissingCriticalFiles();return{totalFiles:t,downloadedFiles:e,isComplete:e===t,missingCritical:a}}async getMissingCriticalFiles(){if(this.manifest||await this.fetchManifest(),!this.manifest)return[];const t=["MASC_metadata.csv","04_MASC_database/aramaic_corpus.db"],e=[];for(const a of t)if(this.manifest.files[a]){const l=this.getStoreForFile(a);await T.get(O,l,a)||e.push(a)}return e}async isDataReady(){try{if(!await T.get(O,B.metadata,"_init"))return console.log("isDataReady: Metadata store not initialized"),!1;const e=await T.get(O,B.audio,"_init");if(this.localState||await this.loadLocalState(),!this.localState||!this.localState.files)return console.log("isDataReady: No local state, assuming data exists if stores are initialized"),!0;const a=Object.values(this.localState.files).filter(l=>l.downloaded).length;return console.log("isDataReady: Downloaded files count:",a),a>0}catch(t){return console.error("isDataReady: Error checking data:",t),!0}}async getFilesToUpdate(){if(console.log("getFilesToUpdate: Checking files to update"),this.manifest||(console.log("getFilesToUpdate: No manifest, fetching..."),await this.fetchManifest()),!this.manifest)throw console.error("getFilesToUpdate: Still no manifest after fetch!"),new Error("Failed to load manifest");if(console.log("getFilesToUpdate: Manifest loaded with",Object.keys(this.manifest.files).length,"files"),!this.localState)return console.log("getFilesToUpdate: No local state, need to download all files"),Object.keys(this.manifest.files);const t=[];for(const[e,a]of Object.entries(this.manifest.files)){const l=this.localState.files[e];(!l||!l.downloaded||l.hash!==a.hash)&&t.push(e)}return t}async downloadAllFiles(t){var r,i;console.log("downloadAllFiles: Starting download process"),this.manifest||(console.log("downloadAllFiles: No manifest, fetching..."),await this.fetchManifest());const e=await this.getFilesToUpdate();if(console.log("downloadAllFiles: Files to download:",e.length),e.length===0){console.log("All files are up to date");return}console.log(`Downloading ${e.length} files from manifest`),console.log("First 5 files:",e.slice(0,5)),this.downloadQueue=[...e],this.isDownloading=!0,this.abortController=new AbortController;const a=this.calculateTotalSize(e);console.log(`Total download size: ${(a/1024/1024).toFixed(2)} MB for ${e.length} files`);const l={totalFiles:e.length,downloadedFiles:0,totalBytes:a,downloadedBytes:0,currentFile:"",currentFileProgress:0,errors:[]},s=Date.now();try{t(l),console.log("Initial progress callback called");const o=this.groupFilesByType(e);console.log("Grouped files by type:",Object.keys(o));for(const[c,f]of Object.entries(o))if(console.log(`Downloading ${f.length} ${c} files...`),c==="txt"||c==="json")for(let u=0;u<f.length;u+=10){const g=f.slice(u,u+10);if((r=this.abortController)!=null&&r.signal.aborted)throw console.log("Aborting downloads..."),new Error("Download cancelled");console.log(`Downloading chunk ${Math.floor(u/10)+1}/${Math.ceil(f.length/10)} of ${c} files...`);const m=g.map(async d=>{try{const v=this.manifest.files[d].size;await this.downloadFile(d,y=>{}),l.downloadedFiles++,l.downloadedBytes+=v,this.localState.files[d]||(this.localState.files[d]={downloaded:!1}),this.localState.files[d].downloaded=!0,this.localState.files[d].hash=this.manifest.files[d].hash,console.log(`Downloaded ${d} (${l.downloadedFiles}/${l.totalFiles})`)}catch(v){throw console.error(`Failed to download ${d}:`,v),l.errors.push(`Failed to download ${d}: ${v}`),l.downloadedFiles++,v}});await Promise.all(m);const w=(Date.now()-s)/1e3;if(w>0){l.speed=l.downloadedBytes/w;const d=l.totalBytes-l.downloadedBytes;l.timeRemaining=d/l.speed}l.currentFile=`Completed ${Math.min(u+10,f.length)}/${f.length} ${c} files`,t(l),await this.saveLocalState(),await new Promise(d=>setTimeout(d,100))}else for(const h of f){if((i=this.abortController)!=null&&i.signal.aborted)throw console.log("Aborting downloads..."),new Error("Download cancelled");try{l.currentFile=h;const u=this.manifest.files[h].size;t(l),await this.downloadFile(h,m=>{l.currentFileProgress=m,t(l)}),l.downloadedFiles++,l.downloadedBytes+=u,l.currentFileProgress=100;const g=(Date.now()-s)/1e3;if(g>0){l.speed=l.downloadedBytes/g;const m=l.totalBytes-l.downloadedBytes;l.timeRemaining=m/l.speed}console.log(`Downloaded ${h} (${l.downloadedFiles}/${l.totalFiles}) - ${(l.downloadedBytes/l.totalBytes*100).toFixed(1)}%`),this.localState.files[h]||(this.localState.files[h]={downloaded:!1}),this.localState.files[h].downloaded=!0,this.localState.files[h].hash=this.manifest.files[h].hash,t(l),await new Promise(m=>setTimeout(m,50))}catch(u){console.error(`Failed to download ${h}:`,u),l.errors.push(`Failed to download ${h}: ${u}`),l.downloadedFiles++,t(l)}}await this.saveLocalState()}finally{this.isDownloading=!1,this.abortController=null}}cancelDownload(){this.abortController&&(this.abortController.abort(),this.isDownloading=!1,console.log("Download cancelled"))}async clearAllData(){const t=Object.values(B);for(const e of t)try{await indexedDB.deleteDatabase(O);break}catch(a){console.error(`Failed to clear store ${e}:`,a)}this.localState=null}async getFile(t){const e=this.getStoreForFile(t),a=await T.get(O,e,t);if(!a){if(console.log(`File ${t} not found in IndexedDB, attempting to download...`),await this.downloadSingleFile(t)){const r=await T.get(O,e,t);if(r){const i=new Blob([r.content],{type:r.type});return new File([i],r.name,{type:r.type})}}return null}const l=new Blob([a.content],{type:a.type});return new File([l],a.name,{type:a.type})}async getManifest(){return this.manifest||await this.fetchManifest(),this.manifest}async getTextContent(t){const e=this.getStoreForFile(t),a=await T.get(O,e,t);if(!a){if(console.log(`File ${t} not found in IndexedDB, attempting to download...`),await this.downloadSingleFile(t)){const r=await T.get(O,e,t);if(r)return typeof r.content=="string"?r.content:new TextDecoder().decode(r.content)}return null}return typeof a.content=="string"?a.content:new TextDecoder().decode(a.content)}async checkForUpdates(){try{const t=this.manifest;return await this.fetchManifest(),!t||t.version!==this.manifest.version?!0:(await this.getFilesToUpdate()).length>0}catch(t){return console.error("Failed to check for updates:",t),!1}}async performBackgroundUpdate(t){const e=await this.getFilesToUpdate();if(e.length!==0){t==null||t(`Updating ${e.length} files...`);for(const a of e)try{await this.downloadFile(a),t==null||t(`Updated ${a}`)}catch(l){console.error(`Failed to update ${a}:`,l)}await this.saveLocalState(),t==null||t("Update complete")}}async downloadSingleFile(t){try{return this.manifest||await this.fetchManifest(),!this.manifest||!this.manifest.files[t]?(console.error(`File ${t} not found in manifest`),!1):(console.log(`Downloading single file: ${t}`),await this.downloadFile(t),this.localState||await this.loadLocalState(),this.localState&&(this.localState.files[t]||(this.localState.files[t]={downloaded:!1,hash:""}),this.localState.files[t].downloaded=!0,this.localState.files[t].hash=this.manifest.files[t].hash,await this.saveLocalState()),!0)}catch(e){return console.error(`Failed to download single file ${t}:`,e),!1}}async fetchManifest(){var t;if(console.log("fetchManifest: Starting fetch from:",Ne),typeof window>"u"||!window.fetch)throw new Error("Fetch API not available");try{const e=new AbortController,a=setTimeout(()=>{console.error("fetchManifest: Timeout after 10 seconds"),e.abort()},1e4);console.log("fetchManifest: Making fetch request"),console.log("Current location:",window.location.href);const l=await fetch(Ne,{signal:e.signal});if(clearTimeout(a),console.log("fetchManifest: Got response:",l.status),console.log("Response headers:",Array.from(l.headers.entries())),!l.ok)throw console.error("Manifest fetch failed:",l.status,l.statusText),new Error(`Failed to fetch manifest: ${l.status} ${l.statusText}`);const s=await l.text();console.log("Manifest response length:",s.length);try{this.manifest=JSON.parse(s),console.log("Manifest parsed successfully, files count:",Object.keys(((t=this.manifest)==null?void 0:t.files)||{}).length)}catch(r){throw console.error("Failed to parse manifest JSON:",r),console.log("Raw response:",s.substring(0,200)),new Error("Invalid manifest JSON")}}catch(e){if(console.error("Network error fetching manifest:",e),console.error("Error type:",e.constructor.name),console.error("Error details:",e),console.error("Error name:",e.name),console.error("Error message:",e.message),e.message&&e.message.includes("CORS")&&console.error("CORS error detected. GitHub Pages might be blocking the request."),e.name==="AbortError")throw new Error("Manifest fetch timed out after 10 seconds");console.log("Trying alternative manifest fetch approach..."),await this.fetchManifestAlternative()}}async fetchManifestAlternative(){console.warn("CORS error detected. Using local manifest fallback for development.");try{const t=await fetch("/masc-manifest.json");if(t.ok){this.manifest=await t.json(),console.log("Loaded manifest from public directory");return}}catch(t){console.log("Could not load manifest from public directory:",t)}try{const t=await fetch("/.devkit/manifest.json");if(t.ok){this.manifest=await t.json(),console.log("Loaded manifest from .devkit folder");return}}catch(t){console.log("Could not load local manifest:",t)}console.warn("Using minimal hardcoded manifest as last resort"),this.manifest={version:"1.0.0",generated:new Date().toISOString(),baseUrl:je,totalSize:919127219,totalFiles:889,files:{"speakers.json":{size:5e4,hash:"dummy",lastModified:new Date().toISOString()},"04_MASC_database/aramaic_corpus.db":{size:1e7,hash:"dummy",lastModified:new Date().toISOString()}}}}async loadLocalState(){const t=await T.get(O,B.manifest,"localState");t&&(this.localState=t)}async saveLocalState(){this.manifest&&(this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.version=this.manifest.version,await T.set(O,B.manifest,"localState",this.localState))}async downloadFile(t,e){var r,i,o;if((r=this.abortController)!=null&&r.signal.aborted)throw new Error("Download cancelled");const a=je+t,l=(i=this.manifest)==null?void 0:i.files[t],s=l&&l.size<5e4;try{const c=await fetch(a,{signal:(o=this.abortController)==null?void 0:o.signal,mode:"cors",credentials:"omit"});if(!c.ok)throw new Error(`Failed to download ${t}: ${c.statusText}`);let f;if(s){const m=await c.arrayBuffer();f=new Uint8Array(m),e&&e(100)}else{const m=Number(c.headers.get("content-length")),w=c.body.getReader(),d=[];let v=0;for(;;){const{done:C,value:M}=await w.read();if(C)break;d.push(M),v+=M.length,e&&m&&e(v/m*100)}f=new Uint8Array(v);let y=0;for(const C of d)f.set(C,y),y+=C.length}const h=this.getStoreForFile(t),u={name:t.split("/").pop(),content:f,type:this.getMimeType(t)};let g=3;for(;g>0;)try{await T.set(O,h,t,u),console.log(`Saved to IndexedDB: ${t} in store: ${h}`);break}catch(m){if(g--,g>0)console.warn(`Failed to save ${t} to IndexedDB (${m.message}), retrying... (${g} attempts left)`),await new Promise(w=>setTimeout(w,500));else throw console.error(`Failed to save ${t} to IndexedDB after all retries:`,m),m}this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.files[t]={downloaded:!0,hash:this.manifest.files[t].hash,downloadedAt:new Date().toISOString()}}catch(c){throw c.name==="AbortError"?(console.log(`Download of ${t} was aborted`),new Error("Download cancelled")):c}}getStoreForFile(t){return t.includes("MASC_textgrid")||t.includes("textgrid_files")?B.textgrids:t.includes("MASC_lemmatized")?B.lemmatized:t.includes("MASC_transcriptions")?B.transcriptions:t.includes("MASC_audio")||t.includes("audio_files")?B.audio:t.includes("MASC_database")||t.endsWith(".db")?B.database:(t.endsWith(".json"),B.metadata)}getMimeType(t){var a;switch((a=t.split(".").pop())==null?void 0:a.toLowerCase()){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"txt":return"text/plain";case"json":return"application/json";case"db":return"application/x-sqlite3";case"textgrid":return"text/plain";default:return"application/octet-stream"}}calculateTotalSize(t){return this.manifest?t.reduce((e,a)=>{var l;return e+(((l=this.manifest.files[a])==null?void 0:l.size)||0)},0):0}groupFilesByType(t){const e={metadata:[],transcriptions:[],lemmatized:[],textgrids:[],database:[],audio:[]};for(const a of t)a.endsWith(".json")?e.metadata.push(a):a.includes("MASC_transcriptions")?e.transcriptions.push(a):a.includes("MASC_lemmatized")?e.lemmatized.push(a):a.includes("textgrid")?e.textgrids.push(a):a.endsWith(".db")?e.database.push(a):a.includes("audio")?e.audio.push(a):e.metadata.push(a);return Object.fromEntries(Object.entries(e).filter(([a,l])=>l.length>0))}}const kn=new ba;class ya{parseText(t){if(!t||!t.trim())return[];const e=[],a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let s,r=!1;for(;(s=a.exec(t))!==null;){r=!0;const i=parseInt(s[1]),o=s[2].trim(),c=this.parseUtteranceTokens(o);e.push({number:i,tokens:c,raw:o})}if(!r)for(;(s=l.exec(t))!==null;){const i=parseInt(s[1]),o=s[2].trim(),c=this.parseUtteranceTokens(o);e.push({number:i,tokens:c,raw:o})}return e}parseUtteranceTokens(t){const e=[];let a=0,l=t;for(;l.trim();){let s=!1;const r=l.match(/^\s*<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/);if(r){const u=r[0],g=r[1].trim(),m=l.length>u.length&&/\s/.test(l[u.length]),w=g.match(/^(\S+?)<([^>]+)>$/);if(w){const[,d,v]=w,y={surface:d,annotation:v===d?void 0:v,position:a++,raw:u.trim(),isArabic:!0,arabicContent:d,spaceAfter:m};this.parseAnnotationContent(v,y),e.push(y)}else e.push({surface:g,position:a++,raw:u.trim(),isArabic:!0,arabicContent:g,spaceAfter:m});l=l.substring(u.length),s=!0;continue}let i="",o=!1,c=0,f=!1;for(;c<l.length;){const u=l[c];if(u==="<")o=!0;else if(u===">"){o=!1,i+=u,c++,c<l.length&&/\s/.test(l[c])&&(f=!0);break}if(!o&&/\s/.test(u)&&i.length>0&&!i.includes("<")){f=!0;break}i+=u,c++}if(!i||i.trim()===""){l=l.substring(1);continue}const h=i.match(/^(\S+?)<([^>]+)>-(\S+?)(?:<([^>]+)>)?$/);if(h){const[u,g,m,w,d]=h;e.push({surface:g+"-"+w,annotation:d,position:a++,raw:u,prefix:{surface:g,morphology:m},lemma:d?d.split(" ")[0]:void 0,spaceAfter:f}),s=!0}else if(i.includes("<")&&i.endsWith(">")){const u=i.trim(),g=u.match(/^([^<]+)<([^>]+)>$/);if(g){const[,m,w]=g,d={surface:m.trim(),annotation:w===m.trim()?void 0:w,position:a++,raw:u,spaceAfter:f};this.parseAnnotationContent(w,d),e.push(d),s=!0}}s||e.push({surface:i,position:a++,raw:i,spaceAfter:f}),l=l.substring(c).trimStart()}return e}parseAnnotationContent(t,e){const a=t.split(/\s+/);if(a.length===0)return;const l=a[0];if(l.includes("/")){const s=l.split("/").map(r=>r.trim()).filter(r=>r);s.length>0&&(e.lemma=s[0],s.length>1&&(e.variants=s.slice(1)))}else e.lemma=l;a.length>1&&(e.morphology=a.slice(1))}extractSurfaceForms(t){return this.parseText(t).map(a=>{const l=a.tokens.map(s=>s.surface);return`(${a.number}) ${l.join(" ")}`}).join(" ")}getTokenSummary(t){const e=[];return t.lemma&&e.push(`Lemma: ${t.lemma}`),t.variants&&t.variants.length>0&&e.push(`Variants: ${t.variants.join(", ")}`),t.morphology&&t.morphology.length>0&&e.push(`Morphology: ${t.morphology.join(" ")}`),t.prefix&&e.push(`Prefix: ${t.prefix.surface} (${t.prefix.morphology})`),t.isArabic&&e.push("Arabic"),e.join(`
`)}}const wa=new ya;class pa{parseTranscription(t){const e=[];if(!t)return e;const a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let s,r=!1;for(;(s=a.exec(t))!==null;){r=!0;const i=parseInt(s[1]),o=s[2].trim();e.push({number:i,text:o,tokens:this.tokenizePlainText(o,i)})}if(!r)for(;(s=l.exec(t))!==null;){const i=parseInt(s[1]),o=s[2].trim();e.push({number:i,text:o,tokens:this.tokenizePlainText(o,i)})}return e}parseLemmatizedTranscription(t){const e=[];if(!t)return e;const a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let s,r=!1;for(;(s=a.exec(t))!==null;){r=!0;const i=parseInt(s[1]),o=s[2].trim(),c=this.extractSurfaceForms(o);e.push({number:i,text:c,tokens:this.tokenizeLemmatizedText(o,i)})}if(!r)for(;(s=l.exec(t))!==null;){const i=parseInt(s[1]),o=s[2].trim(),c=this.extractSurfaceForms(o);e.push({number:i,text:c,tokens:this.tokenizeLemmatizedText(o,i)})}return e}parseAnnotatedTranscription(t){return wa.parseText(t)}tokenizePlainText(t,e){const a=[],l=t.split(/(\s+)/).filter(r=>r.trim());let s=0;for(const r of l)r.trim()&&(a.push({surface:r,position:s,utteranceNumber:e}),s++);return a}tokenizeLemmatizedText(t,e){const a=[];if(!t||!t.trim())return a;try{const s=this.extractSurfaceForms(t).split(/\s+/).filter(i=>i.trim());let r=0;for(const i of s)if(i.trim()){const o={surface:i,position:r,utteranceNumber:e},c=t.match(new RegExp(`${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}<([^>]+)>`));if(c){const h=c[1].split(" ");o.lemma=h[0].split("/")[0],h.length>1&&(o.morphology=h.slice(1))}a.push(o),r++}}catch(l){console.warn("Error tokenizing lemmatized text:",l),t.replace(/<[^>]*>/g," ").split(/\s+/).filter(r=>r.trim()).forEach((r,i)=>{a.push({surface:r,position:i,utteranceNumber:e})})}return a}async search(t,e={searchIn:"surface"}){var r;const a=[];let s=await J.getMetadata();(r=e.speakerFilter)!=null&&r.length&&(s=s.filter(i=>e.speakerFilter.includes(i.speakerId))),e.genderFilter&&(s=s.filter(i=>i.gender===e.genderFilter)),e.ageRange&&(s=s.filter(i=>i.age>=e.ageRange[0]&&i.age<=e.ageRange[1]));for(const i of s){const o=e.searchIn!=="surface",c=await J.getTranscription(i.textId,o);if(!c)continue;const f=o?this.parseLemmatizedTranscription(c):this.parseTranscription(c);for(const h of f){const u=this.findMatches(h.tokens,t,e);if(u.length>0){const g=this.getContext(h,u[0].position);a.push({textId:i.textId,speaker:i,utteranceNumber:h.number,utteranceText:h.text,matchedTokens:u,context:g})}}}return a}findMatches(t,e,a){const l=[],s=a.caseSensitive?e:e.toLowerCase();for(const r of t){let i="";a.searchIn==="surface"||a.searchIn==="both"?i=a.caseSensitive?r.surface:r.surface.toLowerCase():a.searchIn==="lemma"&&r.lemma&&(i=a.caseSensitive?r.lemma:r.lemma.toLowerCase());let o=!1;if(a.regex)try{o=new RegExp(s).test(i)}catch{o=i.includes(s)}else a.wholeWord?o=i===s:o=i.includes(s);o&&l.push(r)}return l}getContext(t,e,a=5){const l=t.tokens,s=l[e],r=l.slice(Math.max(0,e-a),e),i=l.slice(e+1,e+a+1);return{before:r.map(o=>o.surface).join(" "),match:s.surface,after:i.map(o=>o.surface).join(" ")}}async generateConcordance(t){return t.map(e=>({textId:e.textId,speaker:e.speaker,left:e.context.before,keyword:e.context.match,right:e.context.after,utteranceNumber:e.utteranceNumber,audioTimestamp:e.audioTimestamp}))}extractSurfaceForms(t){if(!t||!t.includes("<"))return t.trim();try{let e=t;const a=/<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/g;e=e.replace(a,(i,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const l=/<ar>\s*(.*?)\s*<\/ar>/g;e=e.replace(l,(i,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const s=/<(\w+)>\s*([^<]*?)\s*<\/\1>/g;e=e.replace(s," $2 ");const r=/(\S+?)<[^>]*>/g;return e=e.replace(r,"$1"),e=e.replace(/<[^>]*>/g," "),e=e.replace(/>[^<]*</g," "),e=e.replace(/^[>\s]+|[<\s]+$/g,""),e=e.replace(/\s+/g," ").trim(),e}catch(e){console.warn("Error parsing MASC content, falling back to simple extraction:",e);let a=t.replace(/(\S+?)<[^>]*>/g,"$1").replace(/<[^>]*>/g," ");return a=a.replace(/^[>\s]+|[<\s]+$/g,"").replace(/\s+/g," ").trim(),a}}async getWordFrequency(t={countBy:"surface"}){var s;const e=new Map;let l=await J.getMetadata();(s=t.speakerFilter)!=null&&s.length&&(l=l.filter(r=>t.speakerFilter.includes(r.speakerId)));for(const r of l){const i=t.countBy==="lemma",o=await J.getTranscription(r.textId,i);if(!o)continue;const c=i?this.parseLemmatizedTranscription(o):this.parseTranscription(o);for(const f of c)for(const h of f.tokens){const u=t.countBy==="lemma"&&h.lemma?h.lemma:h.surface;e.set(u,(e.get(u)||0)+1)}}if(t.minFrequency)for(const[r,i]of e.entries())i<t.minFrequency&&e.delete(r);return e}async getCollocations(t,e={window:3,minFrequency:2,measure:"frequency"}){const a=new Map,l=await J.getMetadata();for(const s of l){const r=await J.getTranscription(s.textId,!1);if(!r)continue;const i=this.parseTranscription(r);for(const o of i){const c=o.tokens;for(let f=0;f<c.length;f++)if(c[f].surface.toLowerCase().includes(t.toLowerCase())){for(let h=Math.max(0,f-e.window);h<=Math.min(c.length-1,f+e.window);h++)if(h!==f){const u=c[h].surface;a.set(u,(a.get(u)||0)+1)}}}}for(const[s,r]of a.entries())r<e.minFrequency&&a.delete(s);return a}exportResults(t,e){switch(e){case"csv":const a=["Text ID","Speaker","Gender","Age","Utterance","Left Context","Match","Right Context"],l=t.map(s=>[s.textId,s.speaker.speakerName,s.speaker.gender,s.speaker.age,s.utteranceNumber,s.context.before,s.context.match,s.context.after]);return[a,...l].map(s=>s.join("	")).join(`
`);case"json":return JSON.stringify(t,null,2);case"txt":return t.map(s=>`${s.textId} (${s.speaker.speakerName}): ...${s.context.before} [[${s.context.match}]] ${s.context.after}...`).join(`

`);default:return""}}generateCitation(t){const e=t.speaker;return`${e.speakerName} (${e.gender}, age ${e.age}). Text ${t.textId}, utterance ${t.utteranceNumber}. Modern Aramaic Spoken Corpus (MASC) v1.0.`}}const Fn=new pa,Sa=Ot("v-alert-title"),xa=["success","info","warning","error"],ka=_({border:{type:[Boolean,String],validator:n=>typeof n=="boolean"||["top","end","bottom","start"].includes(n)},borderColor:String,closable:Boolean,closeIcon:{type:z,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:n=>xa.includes(n)},...et(),...Ye(),...Jt(),...Xe(),...Qt(),...qt(),...Ze(),...Je(),...Qe(),...qe({variant:"flat"})},"VAlert"),Pn=q()({name:"VAlert",props:ka(),emits:{"click:close":n=>!0,"update:modelValue":n=>!0},setup(n,t){let{emit:e,slots:a}=t;const l=K(n,"modelValue"),s=F(()=>{if(n.icon!==!1)return n.type?n.icon??`$${n.type}`:n.icon}),r=F(()=>({color:n.color??n.type,variant:n.variant})),{themeClasses:i}=Ke(n),{colorClasses:o,colorStyles:c,variantClasses:f}=Et(r),{densityClasses:h}=Rt(n),{dimensionStyles:u}=Nt(n),{elevationClasses:g}=jt(n),{locationStyles:m}=Ht(n),{positionClasses:w}=Ut(n),{roundedClasses:d}=Gt(n),{textColorClasses:v,textColorStyles:y}=Wt(A(n,"borderColor")),{t:C}=Y(),M=F(()=>({"aria-label":C(n.closeLabel),onClick(k){l.value=!1,e("click:close",k)}}));return()=>{const k=!!(a.prepend||s.value),E=!!(a.title||n.title),N=!!(a.close||n.closable);return l.value&&b(n.tag,{class:["v-alert",n.border&&{"v-alert--border":!!n.border,[`v-alert--border-${n.border===!0?"start":n.border}`]:!0},{"v-alert--prominent":n.prominent},i.value,o.value,h.value,g.value,w.value,d.value,f.value,n.class],style:[c.value,u.value,m.value,n.style],role:"alert"},{default:()=>{var S,p;return[Kt(!1,"v-alert"),n.border&&b("div",{key:"border",class:["v-alert__border",v.value],style:y.value},null),k&&b("div",{key:"prepend",class:"v-alert__prepend"},[a.prepend?b($e,{key:"prepend-defaults",disabled:!s.value,defaults:{VIcon:{density:n.density,icon:s.value,size:n.prominent?44:28}}},a.prepend):b(Se,{key:"prepend-icon",density:n.density,icon:s.value,size:n.prominent?44:28},null)]),b("div",{class:"v-alert__content"},[E&&b(Sa,{key:"title"},{default:()=>{var x;return[((x=a.title)==null?void 0:x.call(a))??n.title]}}),((S=a.text)==null?void 0:S.call(a))??n.text,(p=a.default)==null?void 0:p.call(a)]),a.append&&b("div",{key:"append",class:"v-alert__append"},[a.append()]),N&&b("div",{key:"close",class:"v-alert__close"},[a.close?b($e,{key:"close-defaults",defaults:{VBtn:{icon:n.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var x;return[(x=a.close)==null?void 0:x.call(a,{props:M.value})]}}):b(G,D({key:"close-btn",icon:n.closeIcon,size:"x-small",variant:"text"},M.value),null)])]}})}}});function Fa(){const n=H([]);Zt(()=>n.value=[]);function t(e,a){n.value[a]=e}return{refs:n,updateRef:t}}const Pa=_({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:n=>n.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:n=>n%1===0},totalVisible:[Number,String],firstIcon:{type:z,default:"$first"},prevIcon:{type:z,default:"$prev"},nextIcon:{type:z,default:"$next"},lastIcon:{type:z,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...aa(),...et(),...Ye(),...Xe(),...Ze(),...ta(),...Je({tag:"nav"}),...Qe(),...qe({variant:"text"})},"VPagination"),He=q()({name:"VPagination",props:Pa(),emits:{"update:modelValue":n=>!0,first:n=>!0,prev:n=>!0,next:n=>!0,last:n=>!0},setup(n,t){let{slots:e,emit:a}=t;const l=K(n,"modelValue"),{t:s,n:r}=Y(),{isRtl:i}=Xt(),{themeClasses:o}=Ke(n),{width:c}=me(),f=Yt(-1);xe(void 0,{scoped:!0});const{resizeRef:h}=ea(S=>{if(!S.length)return;const{target:p,contentRect:x}=S[0],P=p.querySelector(".v-pagination__list > *");if(!P)return;const I=x.width,$=P.offsetWidth+parseFloat(getComputedStyle(P).marginRight)*2;f.value=w(I,$)}),u=F(()=>parseInt(n.length,10)),g=F(()=>parseInt(n.start,10)),m=F(()=>n.totalVisible!=null?parseInt(n.totalVisible,10):f.value>=0?f.value:w(c.value,58));function w(S,p){const x=n.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((S-p*x)/p).toFixed(2)))}const d=F(()=>{if(u.value<=0||isNaN(u.value)||u.value>Number.MAX_SAFE_INTEGER)return[];if(m.value<=0)return[];if(m.value===1)return[l.value];if(u.value<=m.value)return ce(u.value,g.value);const S=m.value%2===0,p=S?m.value/2:Math.floor(m.value/2),x=S?p:p+1,P=u.value-p;if(x-l.value>=0)return[...ce(Math.max(1,m.value-1),g.value),n.ellipsis,u.value];if(l.value-P>=(S?1:0)){const I=m.value-1,$=u.value-I+g.value;return[g.value,n.ellipsis,...ce(I,$)]}else{const I=Math.max(1,m.value-3),$=I===1?l.value:l.value-Math.ceil(I/2)+g.value;return[g.value,n.ellipsis,...ce(I,$),n.ellipsis,u.value]}});function v(S,p,x){S.preventDefault(),l.value=p,x&&a(x,p)}const{refs:y,updateRef:C}=Fa();xe({VPaginationBtn:{color:A(n,"color"),border:A(n,"border"),density:A(n,"density"),size:A(n,"size"),variant:A(n,"variant"),rounded:A(n,"rounded"),elevation:A(n,"elevation")}});const M=F(()=>d.value.map((S,p)=>{const x=P=>C(P,p);if(typeof S=="string")return{isActive:!1,key:`ellipsis-${p}`,page:S,props:{ref:x,ellipsis:!0,icon:!0,disabled:!0}};{const P=S===l.value;return{isActive:P,key:S,page:r(S),props:{ref:x,ellipsis:!1,icon:!0,disabled:!!n.disabled||+n.length<2,color:P?n.activeColor:n.color,"aria-current":P,"aria-label":s(P?n.currentPageAriaLabel:n.pageAriaLabel,S),onClick:I=>v(I,S)}}}})),k=F(()=>{const S=!!n.disabled||l.value<=g.value,p=!!n.disabled||l.value>=g.value+u.value-1;return{first:n.showFirstLastPage?{icon:i.value?n.lastIcon:n.firstIcon,onClick:x=>v(x,g.value,"first"),disabled:S,"aria-label":s(n.firstAriaLabel),"aria-disabled":S}:void 0,prev:{icon:i.value?n.nextIcon:n.prevIcon,onClick:x=>v(x,l.value-1,"prev"),disabled:S,"aria-label":s(n.previousAriaLabel),"aria-disabled":S},next:{icon:i.value?n.prevIcon:n.nextIcon,onClick:x=>v(x,l.value+1,"next"),disabled:p,"aria-label":s(n.nextAriaLabel),"aria-disabled":p},last:n.showFirstLastPage?{icon:i.value?n.firstIcon:n.lastIcon,onClick:x=>v(x,g.value+u.value-1,"last"),disabled:p,"aria-label":s(n.lastAriaLabel),"aria-disabled":p}:void 0}});function E(){var p;const S=l.value-g.value;(p=y.value[S])==null||p.$el.focus()}function N(S){S.key===Ve.left&&!n.disabled&&l.value>+n.start?(l.value=l.value-1,Be(E)):S.key===Ve.right&&!n.disabled&&l.value<g.value+u.value-1&&(l.value=l.value+1,Be(E))}return ee(()=>b(n.tag,{ref:h,class:["v-pagination",o.value,n.class],style:n.style,role:"navigation","aria-label":s(n.ariaLabel),onKeydown:N,"data-test":"v-pagination-root"},{default:()=>[b("ul",{class:"v-pagination__list"},[n.showFirstLastPage&&b("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[e.first?e.first(k.value.first):b(G,D({_as:"VPaginationBtn"},k.value.first),null)]),b("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[e.prev?e.prev(k.value.prev):b(G,D({_as:"VPaginationBtn"},k.value.prev),null)]),M.value.map((S,p)=>b("li",{key:S.key,class:["v-pagination__item",{"v-pagination__item--is-active":S.isActive}],"data-test":"v-pagination-item"},[e.item?e.item(S):b(G,D({_as:"VPaginationBtn"},S.props),{default:()=>[S.page]})])),b("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[e.next?e.next(k.value.next):b(G,D({_as:"VPaginationBtn"},k.value.next),null)]),n.showFirstLastPage&&b("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[e.last?e.last(k.value.last):b(G,D({_as:"VPaginationBtn"},k.value.last),null)])])]})),{}}}),Ca=_({page:{type:[Number,String],default:1},itemsPerPage:{type:[Number,String],default:10}},"DataTable-paginate"),st=Symbol.for("vuetify:data-table-pagination");function Ta(n){const t=K(n,"page",void 0,a=>+(a??1)),e=K(n,"itemsPerPage",void 0,a=>+(a??10));return{page:t,itemsPerPage:e}}function Ia(n){const{page:t,itemsPerPage:e,itemsLength:a}=n,l=F(()=>e.value===-1?0:e.value*(t.value-1)),s=F(()=>e.value===-1?a.value:Math.min(a.value,l.value+e.value)),r=F(()=>e.value===-1||a.value===0?1:Math.ceil(a.value/e.value));Fe([t,r],()=>{t.value>r.value&&(t.value=r.value)});function i(u){e.value=u,t.value=1}function o(){t.value=be(t.value+1,1,r.value)}function c(){t.value=be(t.value-1,1,r.value)}function f(u){t.value=be(u,1,r.value)}const h={page:t,itemsPerPage:e,startIndex:l,stopIndex:s,pageCount:r,itemsLength:a,nextPage:o,prevPage:c,setPage:f,setItemsPerPage:i};return ae(st,h),h}function Ma(){const n=te(st);if(!n)throw new Error("Missing pagination!");return n}function Aa(n){const t=tt("usePaginatedItems"),{items:e,startIndex:a,stopIndex:l,itemsPerPage:s}=n,r=F(()=>s.value<=0?e.value:e.value.slice(a.value,l.value));return Fe(r,i=>{t.emit("update:currentItems",i)}),{paginatedItems:r}}const rt=_({prevIcon:{type:z,default:"$prev"},nextIcon:{type:z,default:"$next"},firstIcon:{type:z,default:"$first"},lastIcon:{type:z,default:"$last"},itemsPerPageText:{type:String,default:"$vuetify.dataFooter.itemsPerPageText"},pageText:{type:String,default:"$vuetify.dataFooter.pageText"},firstPageLabel:{type:String,default:"$vuetify.dataFooter.firstPage"},prevPageLabel:{type:String,default:"$vuetify.dataFooter.prevPage"},nextPageLabel:{type:String,default:"$vuetify.dataFooter.nextPage"},lastPageLabel:{type:String,default:"$vuetify.dataFooter.lastPage"},itemsPerPageOptions:{type:Array,default:()=>[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}]},showCurrentPage:Boolean},"VDataTableFooter"),Ue=q()({name:"VDataTableFooter",props:rt(),setup(n,t){let{slots:e}=t;const{t:a}=Y(),{page:l,pageCount:s,startIndex:r,stopIndex:i,itemsLength:o,itemsPerPage:c,setItemsPerPage:f}=Ma(),h=F(()=>n.itemsPerPageOptions.map(u=>typeof u=="number"?{value:u,title:u===-1?a("$vuetify.dataFooter.itemsPerPageAll"):String(u)}:{...u,title:isNaN(Number(u.title))?a(u.title):u.title}));return ee(()=>{var g;const u=He.filterProps(n);return b("div",{class:"v-data-table-footer"},[(g=e.prepend)==null?void 0:g.call(e),b("div",{class:"v-data-table-footer__items-per-page"},[b("span",null,[a(n.itemsPerPageText)]),b(lt,{items:h.value,modelValue:c.value,"onUpdate:modelValue":m=>f(Number(m)),density:"compact",variant:"outlined","hide-details":!0},null)]),b("div",{class:"v-data-table-footer__info"},[b("div",null,[a(n.pageText,o.value?r.value+1:0,i.value,o.value)])]),b("div",{class:"v-data-table-footer__pagination"},[b(He,D({modelValue:l.value,"onUpdate:modelValue":m=>l.value=m,density:"comfortable","first-aria-label":n.firstPageLabel,"last-aria-label":n.lastPageLabel,length:s.value,"next-aria-label":n.nextPageLabel,"previous-aria-label":n.prevPageLabel,rounded:!0,"show-first-last-page":!0,"total-visible":n.showCurrentPage?1:0,variant:"plain"},u),null)])])}),{}}}),he=na({align:{type:String,default:"start"},fixed:Boolean,fixedOffset:[Number,String],height:[Number,String],lastFixed:Boolean,noPadding:Boolean,tag:String,width:[Number,String],maxWidth:[Number,String],nowrap:Boolean},(n,t)=>{let{slots:e}=t;const a=n.tag??"td";return b(a,{class:["v-data-table__td",{"v-data-table-column--fixed":n.fixed,"v-data-table-column--last-fixed":n.lastFixed,"v-data-table-column--no-padding":n.noPadding,"v-data-table-column--nowrap":n.nowrap},`v-data-table-column--align-${n.align}`],style:{height:W(n.height),width:W(n.width),maxWidth:W(n.maxWidth),left:W(n.fixedOffset||null)}},{default:()=>{var l;return[(l=e.default)==null?void 0:l.call(e)]}})}),_a=_({headers:Array},"DataTable-header"),it=Symbol.for("vuetify:data-table-headers"),ot={title:"",sortable:!1},Da={...ot,width:48};function $a(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).map(e=>({element:e,priority:0}));return{enqueue:(e,a)=>{let l=!1;for(let s=0;s<t.length;s++)if(t[s].priority>a){t.splice(s,0,{element:e,priority:a}),l=!0;break}l||t.push({element:e,priority:a})},size:()=>t.length,count:()=>{let e=0;if(!t.length)return 0;const a=Math.floor(t[0].priority);for(let l=0;l<t.length;l++)Math.floor(t[l].priority)===a&&(e+=1);return e},dequeue:()=>t.shift()}}function ke(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(!n.children)t.push(n);else for(const e of n.children)ke(e,t);return t}function ct(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;for(const e of n)e.key&&t.add(e.key),e.children&&ct(e.children,t);return t}function Va(n){if(n.key){if(n.key==="data-table-group")return ot;if(["data-table-expand","data-table-select"].includes(n.key))return Da}}function Te(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return n.children?Math.max(t,...n.children.map(e=>Te(e,t+1))):t}function Ba(n){let t=!1;function e(s){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s)if(r&&(s.fixed=!0),s.fixed)if(s.children)for(let i=s.children.length-1;i>=0;i--)e(s.children[i],!0);else t?isNaN(+s.width)&&sa(`Multiple fixed columns should have a static width (key: ${s.key})`):s.lastFixed=!0,t=!0;else if(s.children)for(let i=s.children.length-1;i>=0;i--)e(s.children[i]);else t=!1}for(let s=n.length-1;s>=0;s--)e(n[s]);function a(s){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!s)return r;if(s.children){s.fixedOffset=r;for(const i of s.children)r=a(i,r)}else s.fixed&&(s.fixedOffset=r,r+=parseFloat(s.width||"0")||0);return r}let l=0;for(const s of n)l=a(s,l)}function La(n,t){const e=[];let a=0;const l=$a(n);for(;l.size()>0;){let r=l.count();const i=[];let o=1;for(;r>0;){const{element:c,priority:f}=l.dequeue(),h=t-a-Te(c);if(i.push({...c,rowspan:h??1,colspan:c.children?ke(c).length:1}),c.children)for(const u of c.children){const g=f%1+o/Math.pow(10,a+2);l.enqueue(u,a+h+g)}o+=1,r-=1}a+=1,e.push(i)}return{columns:n.map(r=>ke(r)).flat(),headers:e}}function ut(n){const t=[];for(const e of n){const a={...Va(e),...e},l=a.key??(typeof a.value=="string"?a.value:null),s=a.value??l??null,r={...a,key:l,value:s,sortable:a.sortable??(a.key!=null||!!a.sort),children:a.children?ut(a.children):void 0};t.push(r)}return t}function Oa(n,t){const e=H([]),a=H([]),l=H({}),s=H({}),r=H({});at(()=>{var w,d,v;const c=(n.headers||Object.keys(n.items[0]??{}).map(y=>({key:y,title:la(y)}))).slice(),f=ct(c);(w=t==null?void 0:t.groupBy)!=null&&w.value.length&&!f.has("data-table-group")&&c.unshift({key:"data-table-group",title:"Group"}),(d=t==null?void 0:t.showSelect)!=null&&d.value&&!f.has("data-table-select")&&c.unshift({key:"data-table-select"}),(v=t==null?void 0:t.showExpand)!=null&&v.value&&!f.has("data-table-expand")&&c.push({key:"data-table-expand"});const h=ut(c);Ba(h);const u=Math.max(...h.map(y=>Te(y)))+1,g=La(h,u);e.value=g.headers,a.value=g.columns;const m=g.headers.flat(1);for(const y of m)y.key&&(y.sortable&&(y.sort&&(l.value[y.key]=y.sort),y.sortRaw&&(s.value[y.key]=y.sortRaw)),y.filter&&(r.value[y.key]=y.filter))});const i={headers:e,columns:a,sortFunctions:l,sortRawFunctions:s,filterFunctions:r};return ae(it,i),i}function ge(){const n=te(it);if(!n)throw new Error("Missing headers!");return n}const za={showSelectAll:!1,allSelected:()=>[],select:n=>{var a;let{items:t,value:e}=n;return new Set(e?[(a=t[0])==null?void 0:a.value]:[])},selectAll:n=>{let{selected:t}=n;return t}},dt={showSelectAll:!0,allSelected:n=>{let{currentPage:t}=n;return t},select:n=>{let{items:t,value:e,selected:a}=n;for(const l of t)e?a.add(l.value):a.delete(l.value);return a},selectAll:n=>{let{value:t,currentPage:e,selected:a}=n;return dt.select({items:e,value:t,selected:a})}},ft={showSelectAll:!0,allSelected:n=>{let{allItems:t}=n;return t},select:n=>{let{items:t,value:e,selected:a}=n;for(const l of t)e?a.add(l.value):a.delete(l.value);return a},selectAll:n=>{let{value:t,allItems:e,selected:a}=n;return ft.select({items:e,value:t,selected:a})}},Ea=_({showSelect:Boolean,selectStrategy:{type:[String,Object],default:"page"},modelValue:{type:Array,default:()=>[]},valueComparator:{type:Function,default:nt}},"DataTable-select"),ht=Symbol.for("vuetify:data-table-selection");function Ra(n,t){let{allItems:e,currentPage:a}=t;const l=K(n,"modelValue",n.modelValue,v=>new Set(ie(v).map(y=>{var C;return((C=e.value.find(M=>n.valueComparator(y,M.value)))==null?void 0:C.value)??y})),v=>[...v.values()]),s=F(()=>e.value.filter(v=>v.selectable)),r=F(()=>a.value.filter(v=>v.selectable)),i=F(()=>{if(typeof n.selectStrategy=="object")return n.selectStrategy;switch(n.selectStrategy){case"single":return za;case"all":return ft;case"page":default:return dt}});function o(v){return ie(v).every(y=>l.value.has(y.value))}function c(v){return ie(v).some(y=>l.value.has(y.value))}function f(v,y){const C=i.value.select({items:v,value:y,selected:new Set(l.value)});l.value=C}function h(v){f([v],!o([v]))}function u(v){const y=i.value.selectAll({value:v,allItems:s.value,currentPage:r.value,selected:new Set(l.value)});l.value=y}const g=F(()=>l.value.size>0),m=F(()=>{const v=i.value.allSelected({allItems:s.value,currentPage:r.value});return!!v.length&&o(v)}),w=F(()=>i.value.showSelectAll),d={toggleSelect:h,select:f,selectAll:u,isSelected:o,isSomeSelected:c,someSelected:g,allSelected:m,showSelectAll:w};return ae(ht,d),d}function ve(){const n=te(ht);if(!n)throw new Error("Missing selection!");return n}const Na=_({sortBy:{type:Array,default:()=>[]},customKeySort:Object,multiSort:Boolean,mustSort:Boolean},"DataTable-sort"),mt=Symbol.for("vuetify:data-table-sort");function ja(n){const t=K(n,"sortBy"),e=A(n,"mustSort"),a=A(n,"multiSort");return{sortBy:t,mustSort:e,multiSort:a}}function Ha(n){const{sortBy:t,mustSort:e,multiSort:a,page:l}=n,s=o=>{if(o.key==null)return;let c=t.value.map(h=>({...h}))??[];const f=c.find(h=>h.key===o.key);f?f.order==="desc"?e.value?f.order="asc":c=c.filter(h=>h.key!==o.key):f.order="desc":a.value?c=[...c,{key:o.key,order:"asc"}]:c=[{key:o.key,order:"asc"}],t.value=c,l&&(l.value=1)};function r(o){return!!t.value.find(c=>c.key===o.key)}const i={sortBy:t,toggleSort:s,isSorted:r};return ae(mt,i),i}function gt(){const n=te(mt);if(!n)throw new Error("Missing sort!");return n}function Ua(n,t,e,a){const l=Y();return{sortedItems:F(()=>{var r,i;return e.value.length?Ga(t.value,e.value,l.current.value,{transform:a==null?void 0:a.transform,sortFunctions:{...n.customKeySort,...(r=a==null?void 0:a.sortFunctions)==null?void 0:r.value},sortRawFunctions:(i=a==null?void 0:a.sortRawFunctions)==null?void 0:i.value}):t.value})}}function Ga(n,t,e,a){const l=new Intl.Collator(e,{sensitivity:"accent",usage:"sort"});return n.map(r=>[r,a!=null&&a.transform?a.transform(r):r]).sort((r,i)=>{var o,c;for(let f=0;f<t.length;f++){let h=!1;const u=t[f].key,g=t[f].order??"asc";if(g===!1)continue;let m=fe(r[1],u),w=fe(i[1],u),d=r[0].raw,v=i[0].raw;if(g==="desc"&&([m,w]=[w,m],[d,v]=[v,d]),(o=a==null?void 0:a.sortRawFunctions)!=null&&o[u]){const y=a.sortRawFunctions[u](d,v);if(y==null)continue;if(h=!0,y)return y}if((c=a==null?void 0:a.sortFunctions)!=null&&c[u]){const y=a.sortFunctions[u](m,w);if(y==null)continue;if(h=!0,y)return y}if(!h){if(m instanceof Date&&w instanceof Date)return m.getTime()-w.getTime();if([m,w]=[m,w].map(y=>y!=null?y.toString().toLocaleLowerCase():y),m!==w)return ue(m)&&ue(w)?0:ue(m)?-1:ue(w)?1:!isNaN(m)&&!isNaN(w)?Number(m)-Number(w):l.compare(m,w)}}return 0}).map(r=>{let[i]=r;return i})}const vt=_({color:String,sticky:Boolean,disableSort:Boolean,multiSort:Boolean,sortAscIcon:{type:z,default:"$sortAsc"},sortDescIcon:{type:z,default:"$sortDesc"},headerProps:{type:Object},...Pe(),...ca()},"VDataTableHeaders"),Ge=q()({name:"VDataTableHeaders",props:vt(),setup(n,t){let{slots:e}=t;const{t:a}=Y(),{toggleSort:l,sortBy:s,isSorted:r}=gt(),{someSelected:i,allSelected:o,selectAll:c,showSelectAll:f}=ve(),{columns:h,headers:u}=ge(),{loaderClasses:g}=ra(n);function m(S,p){if(!(!n.sticky&&!S.fixed))return{position:"sticky",left:S.fixed?W(S.fixedOffset):void 0,top:n.sticky?`calc(var(--v-table-header-height) * ${p})`:void 0}}function w(S){const p=s.value.find(x=>x.key===S.key);return p?p.order==="asc"?n.sortAscIcon:n.sortDescIcon:n.sortAscIcon}const{backgroundColorClasses:d,backgroundColorStyles:v}=ia(n,"color"),{displayClasses:y,mobile:C}=me(n),M=F(()=>({headers:u.value,columns:h.value,toggleSort:l,isSorted:r,sortBy:s.value,someSelected:i.value,allSelected:o.value,selectAll:c,getSortIcon:w})),k=F(()=>["v-data-table__th",{"v-data-table__th--sticky":n.sticky},y.value,g.value]),E=S=>{let{column:p,x,y:P}=S;const I=p.key==="data-table-select"||p.key==="data-table-expand",$=D(n.headerProps??{},p.headerProps??{});return b(he,D({tag:"th",align:p.align,class:[{"v-data-table__th--sortable":p.sortable&&!n.disableSort,"v-data-table__th--sorted":r(p),"v-data-table__th--fixed":p.fixed},...k.value],style:{width:W(p.width),minWidth:W(p.minWidth),maxWidth:W(p.maxWidth),...m(p,P)},colspan:p.colspan,rowspan:p.rowspan,onClick:p.sortable?()=>l(p):void 0,fixed:p.fixed,nowrap:p.nowrap,lastFixed:p.lastFixed,noPadding:I},$),{default:()=>{var Z;const Q=`header.${p.key}`,oe={column:p,selectAll:c,isSorted:r,toggleSort:l,sortBy:s.value,someSelected:i.value,allSelected:o.value,getSortIcon:w};return e[Q]?e[Q](oe):p.key==="data-table-select"?((Z=e["header.data-table-select"])==null?void 0:Z.call(e,oe))??(f.value&&b(Ce,{modelValue:o.value,indeterminate:i.value&&!o.value,"onUpdate:modelValue":c},null)):b("div",{class:"v-data-table-header__content"},[b("span",null,[p.title]),p.sortable&&!n.disableSort&&b(Se,{key:"icon",class:"v-data-table-header__sort-icon",icon:w(p)},null),n.multiSort&&r(p)&&b("div",{key:"badge",class:["v-data-table-header__sort-badge",...d.value],style:v.value},[s.value.findIndex(ne=>ne.key===p.key)+1])])}})},N=()=>{const S=D(n.headerProps??{}??{}),p=F(()=>h.value.filter(P=>(P==null?void 0:P.sortable)&&!n.disableSort)),x=F(()=>{if(h.value.find(I=>I.key==="data-table-select")!=null)return o.value?"$checkboxOn":i.value?"$checkboxIndeterminate":"$checkboxOff"});return b(he,D({tag:"th",class:[...k.value],colspan:u.value.length+1},S),{default:()=>[b("div",{class:"v-data-table-header__content"},[b(lt,{chips:!0,class:"v-data-table__td-sort-select",clearable:!0,density:"default",items:p.value,label:a("$vuetify.dataTable.sortBy"),multiple:n.multiSort,variant:"underlined","onClick:clear":()=>s.value=[],appendIcon:x.value,"onClick:append":()=>c(!o.value)},{...e,chip:P=>{var I;return b(fa,{onClick:(I=P.item.raw)!=null&&I.sortable?()=>l(P.item.raw):void 0,onMousedown:$=>{$.preventDefault(),$.stopPropagation()}},{default:()=>[P.item.title,b(Se,{class:["v-data-table__td-sort-icon",r(P.item.raw)&&"v-data-table__td-sort-icon-active"],icon:w(P.item.raw),size:"small"},null)]})}})])]})};ee(()=>C.value?b("tr",null,[b(N,null,null)]):b(X,null,[e.headers?e.headers(M.value):u.value.map((S,p)=>b("tr",null,[S.map((x,P)=>b(E,{column:x,x:P,y:p},null))])),n.loading&&b("tr",{class:"v-data-table-progress"},[b("th",{colspan:h.value.length},[b(oa,{name:"v-data-table-progress",absolute:!0,active:!0,color:typeof n.loading=="boolean"?void 0:n.loading,indeterminate:!0},{default:e.loader})])])]))}}),Wa=_({groupBy:{type:Array,default:()=>[]}},"DataTable-group"),bt=Symbol.for("vuetify:data-table-group");function Ka(n){return{groupBy:K(n,"groupBy")}}function qa(n){const{disableSort:t,groupBy:e,sortBy:a}=n,l=H(new Set),s=F(()=>e.value.map(f=>({...f,order:f.order??!1})).concat(t!=null&&t.value?[]:a.value));function r(f){return l.value.has(f.id)}function i(f){const h=new Set(l.value);r(f)?h.delete(f.id):h.add(f.id),l.value=h}function o(f){function h(u){const g=[];for(const m of u.items)"type"in m&&m.type==="group"?g.push(...h(m)):g.push(m);return g}return h({items:f})}const c={sortByWithGroups:s,toggleGroup:i,opened:l,groupBy:e,extractRows:o,isGroupOpen:r};return ae(bt,c),c}function yt(){const n=te(bt);if(!n)throw new Error("Missing group!");return n}function Qa(n,t){if(!n.length)return[];const e=new Map;for(const a of n){const l=fe(a.raw,t);e.has(l)||e.set(l,[]),e.get(l).push(a)}return e}function wt(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"root";if(!t.length)return[];const l=Qa(n,t[0]),s=[],r=t.slice(1);return l.forEach((i,o)=>{const c=t[0],f=`${a}_${c}_${o}`;s.push({depth:e,id:f,key:c,value:o,items:r.length?wt(i,r,e+1,f):i,type:"group"})}),s}function pt(n,t){const e=[];for(const a of n)"type"in a&&a.type==="group"?(a.value!=null&&e.push(a),(t.has(a.id)||a.value==null)&&e.push(...pt(a.items,t))):e.push(a);return e}function Ja(n,t,e){return{flatItems:F(()=>{if(!t.value.length)return n.value;const l=wt(n.value,t.value.map(s=>s.key));return pt(l,e.value)})}}const Za=_({item:{type:Object,required:!0}},"VDataTableGroupHeaderRow"),Xa=q()({name:"VDataTableGroupHeaderRow",props:Za(),setup(n,t){let{slots:e}=t;const{isGroupOpen:a,toggleGroup:l,extractRows:s}=yt(),{isSelected:r,isSomeSelected:i,select:o}=ve(),{columns:c}=ge(),f=F(()=>s([n.item]));return()=>b("tr",{class:"v-data-table-group-header-row",style:{"--v-data-table-group-header-row-depth":n.item.depth}},[c.value.map(h=>{var u,g;if(h.key==="data-table-group"){const m=a(n.item)?"$expand":"$next",w=()=>l(n.item);return((u=e["data-table-group"])==null?void 0:u.call(e,{item:n.item,count:f.value.length,props:{icon:m,onClick:w}}))??b(he,{class:"v-data-table-group-header-row__column"},{default:()=>[b(G,{size:"small",variant:"text",icon:m,onClick:w},null),b("span",null,[n.item.value]),b("span",null,[Le("("),f.value.length,Le(")")])]})}if(h.key==="data-table-select"){const m=r(f.value),w=i(f.value)&&!m,d=v=>o(f.value,v);return((g=e["data-table-select"])==null?void 0:g.call(e,{props:{modelValue:m,indeterminate:w,"onUpdate:modelValue":d}}))??b("td",null,[b(Ce,{modelValue:m,indeterminate:w,"onUpdate:modelValue":d},null)])}return b("td",null,null)})])}}),Ya=_({expandOnClick:Boolean,showExpand:Boolean,expanded:{type:Array,default:()=>[]}},"DataTable-expand"),St=Symbol.for("vuetify:datatable:expanded");function en(n){const t=A(n,"expandOnClick"),e=K(n,"expanded",n.expanded,i=>new Set(i),i=>[...i.values()]);function a(i,o){const c=new Set(e.value);o?c.add(i.value):c.delete(i.value),e.value=c}function l(i){return e.value.has(i.value)}function s(i){a(i,!l(i))}const r={expand:a,expanded:e,expandOnClick:t,isExpanded:l,toggleExpand:s};return ae(St,r),r}function xt(){const n=te(St);if(!n)throw new Error("foo");return n}const tn=_({index:Number,item:Object,cellProps:[Object,Function],onClick:ye(),onContextmenu:ye(),onDblclick:ye(),...Pe()},"VDataTableRow"),an=q()({name:"VDataTableRow",props:tn(),setup(n,t){let{slots:e}=t;const{displayClasses:a,mobile:l}=me(n,"v-data-table__tr"),{isSelected:s,toggleSelect:r,someSelected:i,allSelected:o,selectAll:c}=ve(),{isExpanded:f,toggleExpand:h}=xt(),{toggleSort:u,sortBy:g,isSorted:m}=gt(),{columns:w}=ge();ee(()=>b("tr",{class:["v-data-table__tr",{"v-data-table__tr--clickable":!!(n.onClick||n.onContextmenu||n.onDblclick)},a.value],onClick:n.onClick,onContextmenu:n.onContextmenu,onDblclick:n.onDblclick},[n.item&&w.value.map((d,v)=>{const y=n.item,C=`item.${d.key}`,M=`header.${d.key}`,k={index:n.index,item:y.raw,internalItem:y,value:fe(y.columns,d.key),column:d,isSelected:s,toggleSelect:r,isExpanded:f,toggleExpand:h},E={column:d,selectAll:c,isSorted:m,toggleSort:u,sortBy:g.value,someSelected:i.value,allSelected:o.value,getSortIcon:()=>""},N=typeof n.cellProps=="function"?n.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value,column:d}):n.cellProps,S=typeof d.cellProps=="function"?d.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value}):d.cellProps;return b(he,D({align:d.align,class:{"v-data-table__td--expanded-row":d.key==="data-table-expand","v-data-table__td--select-row":d.key==="data-table-select"},fixed:d.fixed,fixedOffset:d.fixedOffset,lastFixed:d.lastFixed,maxWidth:l.value?void 0:d.maxWidth,noPadding:d.key==="data-table-select"||d.key==="data-table-expand",nowrap:d.nowrap,width:l.value?void 0:d.width},N,S),{default:()=>{var x,P,I,$,Q;if(e[C]&&!l.value)return(x=e[C])==null?void 0:x.call(e,k);if(d.key==="data-table-select")return((P=e["item.data-table-select"])==null?void 0:P.call(e,k))??b(Ce,{disabled:!y.selectable,modelValue:s([y]),onClick:Oe(()=>r(y),["stop"])},null);if(d.key==="data-table-expand")return((I=e["item.data-table-expand"])==null?void 0:I.call(e,k))??b(G,{icon:f(y)?"$collapse":"$expand",size:"small",variant:"text",onClick:Oe(()=>h(y),["stop"])},null);const p=ua(k.value);return l.value?b(X,null,[b("div",{class:"v-data-table__td-title"},[(($=e[M])==null?void 0:$.call(e,E))??d.title]),b("div",{class:"v-data-table__td-value"},[((Q=e[C])==null?void 0:Q.call(e,k))??p])]):p}})})]))}}),kt=_({loading:[Boolean,String],loadingText:{type:String,default:"$vuetify.dataIterator.loadingText"},hideNoData:Boolean,items:{type:Array,default:()=>[]},noDataText:{type:String,default:"$vuetify.noDataText"},rowProps:[Object,Function],cellProps:[Object,Function],...Pe()},"VDataTableRows"),We=q()({name:"VDataTableRows",inheritAttrs:!1,props:kt(),setup(n,t){let{attrs:e,slots:a}=t;const{columns:l}=ge(),{expandOnClick:s,toggleExpand:r,isExpanded:i}=xt(),{isSelected:o,toggleSelect:c}=ve(),{toggleGroup:f,isGroupOpen:h}=yt(),{t:u}=Y(),{mobile:g}=me(n);return ee(()=>{var m,w;return n.loading&&(!n.items.length||a.loading)?b("tr",{class:"v-data-table-rows-loading",key:"loading"},[b("td",{colspan:l.value.length},[((m=a.loading)==null?void 0:m.call(a))??u(n.loadingText)])]):!n.loading&&!n.items.length&&!n.hideNoData?b("tr",{class:"v-data-table-rows-no-data",key:"no-data"},[b("td",{colspan:l.value.length},[((w=a["no-data"])==null?void 0:w.call(a))??u(n.noDataText)])]):b(X,null,[n.items.map((d,v)=>{var M;if(d.type==="group"){const k={index:v,item:d,columns:l.value,isExpanded:i,toggleExpand:r,isSelected:o,toggleSelect:c,toggleGroup:f,isGroupOpen:h};return a["group-header"]?a["group-header"](k):b(Xa,D({key:`group-header_${d.id}`,item:d},Ee(e,":group-header",()=>k)),a)}const y={index:v,item:d.raw,internalItem:d,columns:l.value,isExpanded:i,toggleExpand:r,isSelected:o,toggleSelect:c},C={...y,props:D({key:`item_${d.key??d.index}`,onClick:s.value?()=>{r(d)}:void 0,index:v,item:d,cellProps:n.cellProps,mobile:g.value},Ee(e,":row",()=>y),typeof n.rowProps=="function"?n.rowProps({item:y.item,index:y.index,internalItem:y.internalItem}):n.rowProps)};return b(X,{key:C.props.key},[a.item?a.item(C):b(an,C.props,a),i(d)&&((M=a["expanded-row"])==null?void 0:M.call(a,y))])})])}),{}}}),nn=_({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},rowProps:[Object,Function],cellProps:[Object,Function],returnObject:Boolean},"DataTable-items");function ln(n,t,e,a){const l=n.returnObject?t:re(t,n.itemValue),s=re(t,n.itemSelectable,!0),r=a.reduce((i,o)=>(o.key!=null&&(i[o.key]=re(t,o.value)),i),{});return{type:"item",key:n.returnObject?re(t,n.itemValue):l,index:e,value:l,selectable:s,columns:r,raw:t}}function sn(n,t,e){return t.map((a,l)=>ln(n,a,l,e))}function rn(n,t){return{items:F(()=>sn(n,n.items,t.value))}}function on(n){let{page:t,itemsPerPage:e,sortBy:a,groupBy:l,search:s}=n;const r=tt("VDataTable"),i=F(()=>({page:t.value,itemsPerPage:e.value,sortBy:a.value,groupBy:l.value,search:s.value}));let o=null;Fe(i,()=>{nt(o,i.value)||(o&&o.search!==i.value.search&&(t.value=1),r.emit("update:options",i.value),o=i.value)},{deep:!0,immediate:!0})}const cn=(n,t,e)=>n==null||t==null?-1:n.toString().toLocaleLowerCase().indexOf(t.toString().toLocaleLowerCase()),un=_({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function dn(n,t,e){var i;const a=[],l=(e==null?void 0:e.default)??cn,s=e!=null&&e.filterKeys?ie(e.filterKeys):!1,r=Object.keys((e==null?void 0:e.customKeyFilter)??{}).length;if(!(n!=null&&n.length))return a;e:for(let o=0;o<n.length;o++){const[c,f=c]=ie(n[o]),h={},u={};let g=-1;if((t||r>0)&&!(e!=null&&e.noFilter)){if(typeof c=="object"){const d=s||Object.keys(f);for(const v of d){const y=re(f,v),C=(i=e==null?void 0:e.customKeyFilter)==null?void 0:i[v];if(g=C?C(y,t,c):l(y,t,c),g!==-1&&g!==!1)C?h[v]=g:u[v]=g;else if((e==null?void 0:e.filterMode)==="every")continue e}}else g=l(c,t,c),g!==-1&&g!==!1&&(u.title=g);const m=Object.keys(u).length,w=Object.keys(h).length;if(!m&&!w||(e==null?void 0:e.filterMode)==="union"&&w!==r&&!m||(e==null?void 0:e.filterMode)==="intersection"&&(w!==r||!m))continue}a.push({index:o,matches:{...u,...h}})}return a}function fn(n,t,e,a){const l=H([]),s=H(new Map),r=F(()=>a!=null&&a.transform?se(t).map(o=>[o,a.transform(o)]):se(t));at(()=>{const o=typeof e=="function"?e():se(e),c=typeof o!="string"&&typeof o!="number"?"":String(o),f=dn(r.value,c,{customKeyFilter:{...n.customKeyFilter,...se(a==null?void 0:a.customKeyFilter)},default:n.customFilter,filterKeys:n.filterKeys,filterMode:n.filterMode,noFilter:n.noFilter}),h=se(t),u=[],g=new Map;f.forEach(m=>{let{index:w,matches:d}=m;const v=h[w];u.push(v),g.set(v.value,d)}),l.value=u,s.value=g});function i(o){return s.value.get(o.value)}return{filteredItems:l,filteredMatches:s,getMatches:i}}const hn=_({...kt(),hideDefaultBody:Boolean,hideDefaultFooter:Boolean,hideDefaultHeader:Boolean,width:[String,Number],search:String,...Ya(),...Wa(),..._a(),...nn(),...Ea(),...Na(),...vt(),...ma()},"DataTable"),mn=_({...Ca(),...hn(),...un(),...rt()},"VDataTable"),Cn=q()({name:"VDataTable",props:mn(),emits:{"update:modelValue":n=>!0,"update:page":n=>!0,"update:itemsPerPage":n=>!0,"update:sortBy":n=>!0,"update:options":n=>!0,"update:groupBy":n=>!0,"update:expanded":n=>!0,"update:currentItems":n=>!0},setup(n,t){let{attrs:e,slots:a}=t;const{groupBy:l}=Ka(n),{sortBy:s,multiSort:r,mustSort:i}=ja(n),{page:o,itemsPerPage:c}=Ta(n),{disableSort:f}=da(n),{columns:h,headers:u,sortFunctions:g,sortRawFunctions:m,filterFunctions:w}=Oa(n,{groupBy:l,showSelect:A(n,"showSelect"),showExpand:A(n,"showExpand")}),{items:d}=rn(n,h),v=A(n,"search"),{filteredItems:y}=fn(n,d,v,{transform:U=>U.columns,customKeyFilter:w}),{toggleSort:C}=Ha({sortBy:s,multiSort:r,mustSort:i,page:o}),{sortByWithGroups:M,opened:k,extractRows:E,isGroupOpen:N,toggleGroup:S}=qa({groupBy:l,sortBy:s,disableSort:f}),{sortedItems:p}=Ua(n,y,M,{transform:U=>({...U.raw,...U.columns}),sortFunctions:g,sortRawFunctions:m}),{flatItems:x}=Ja(p,l,k),P=F(()=>x.value.length),{startIndex:I,stopIndex:$,pageCount:Q,setItemsPerPage:oe}=Ia({page:o,itemsPerPage:c,itemsLength:P}),{paginatedItems:Z}=Aa({items:x,startIndex:I,stopIndex:$,itemsPerPage:c}),ne=F(()=>E(Z.value)),{isSelected:Ft,select:Pt,selectAll:Ct,toggleSelect:Tt,someSelected:It,allSelected:Mt}=Ra(n,{allItems:d,currentPage:ne}),{isExpanded:At,toggleExpand:_t}=en(n);on({page:o,itemsPerPage:c,sortBy:s,groupBy:l,search:v}),xe({VDataTableRows:{hideNoData:A(n,"hideNoData"),noDataText:A(n,"noDataText"),loading:A(n,"loading"),loadingText:A(n,"loadingText")}});const R=F(()=>({page:o.value,itemsPerPage:c.value,sortBy:s.value,pageCount:Q.value,toggleSort:C,setItemsPerPage:oe,someSelected:It.value,allSelected:Mt.value,isSelected:Ft,select:Pt,selectAll:Ct,toggleSelect:Tt,isExpanded:At,toggleExpand:_t,isGroupOpen:N,toggleGroup:S,items:ne.value.map(U=>U.raw),internalItems:ne.value,groupedItems:Z.value,columns:h.value,headers:u.value}));return ee(()=>{const U=Ue.filterProps(n),Dt=Ge.filterProps(n),$t=We.filterProps(n),Vt=ze.filterProps(n);return b(ze,D({class:["v-data-table",{"v-data-table--show-select":n.showSelect,"v-data-table--loading":n.loading},n.class],style:n.style},Vt),{top:()=>{var le;return(le=a.top)==null?void 0:le.call(a,R.value)},default:()=>{var le,Ie,Me,Ae,_e,De;return a.default?a.default(R.value):b(X,null,[(le=a.colgroup)==null?void 0:le.call(a,R.value),!n.hideDefaultHeader&&b("thead",{key:"thead"},[b(Ge,Dt,a)]),(Ie=a.thead)==null?void 0:Ie.call(a,R.value),!n.hideDefaultBody&&b("tbody",null,[(Me=a["body.prepend"])==null?void 0:Me.call(a,R.value),a.body?a.body(R.value):b(We,D(e,$t,{items:Z.value}),a),(Ae=a["body.append"])==null?void 0:Ae.call(a,R.value)]),(_e=a.tbody)==null?void 0:_e.call(a,R.value),(De=a.tfoot)==null?void 0:De.call(a,R.value)])},bottom:()=>a.bottom?a.bottom(R.value):!n.hideDefaultFooter&&b(X,null,[b(ha,null,null),b(Ue,U,{prepend:a["footer.prepend"]})])})}),{}}});export{Cn as V,J as a,Fn as b,He as c,Pn as d,xn as e,kn as m};
