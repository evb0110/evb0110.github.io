var U=Object.defineProperty;var X=(t,e,n)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>X(t,typeof e!="symbol"?e+"":e,n);import{aE as q,c as w,E as O,d as H,r as b,aF as Q}from"./index-CRtWoZT0.js";import{a as Y}from"./axios-CCb-kr4I.js";import{a as v}from"./assets-dJ9gWsmQ.js";import{u as $}from"./index-Bj_eYYmv.js";const Z=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/gu,ee=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/u,te=/(?![\u0701-\u0709]|[\u0730-\u074c])[^\p{M}]/u;class g{constructor(e){m(this,"id",q());m(this,"str");m(this,"_nfd",null);m(this,"_stripped",null);m(this,"_chunks",null);this.str=e}static addFlagIfAbsent(e,n){return e.includes(n)?e:e+n}get nfd(){return this._nfd||this.cacheNFD(),this._nfd}get stripped(){return this._stripped||this.cacheStripped(),this._stripped}get chunks(){return this._chunks||this.cacheChunks(),this._chunks||[]}cacheNFD(){this._nfd||(this._nfd=this.str.normalize("NFD"))}cacheStripped(){var e;this._stripped||(this._stripped=((e=this.nfd)==null?void 0:e.replace(Z,""))||"")}cacheChunks(){this._chunks||(this._chunks=this.str===this.stripped?this.str.split(""):this.makeNFDChunks())}makeNFDChunks(){var r;const e=((r=this.nfd)==null?void 0:r.split(""))||[],n=[];let s=0;n[s]="";for(let i=0;i<e.length;i++)n[s]+=e[i],i+1<e.length&&!ee.test(e[i+1])&&te.test(n[s])&&(s++,n[s]="");return n}splitInclusive(e){e=RegExp(e.source,g.addFlagIfAbsent(e.flags,"g"));const n=Array.from(this.stripped.matchAll(e)),s=[];let r=0;for(const i of n){const o=i[0].length,a=i.index;s.push(this.chunks.slice(r,a).join("")),s.push(this.chunks.slice(a,a+o).join("")),r=a+o}return s.push(this.chunks.slice(r).join("")),s}}const B=(t,e)=>e.some(n=>t instanceof n);let x,R;function ne(){return x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function se(){return R||(R=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M=new WeakMap,C=new WeakMap,I=new WeakMap;function re(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(p(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return I.set(e,t),e}function ie(t){if(M.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});M.set(t,e)}let _={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return M.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function W(t){_=t(_)}function oe(t){return se().includes(t)?function(...e){return t.apply(A(this),e),p(this.request)}:function(...e){return p(t.apply(A(this),e))}}function ae(t){return typeof t=="function"?oe(t):(t instanceof IDBTransaction&&ie(t),B(t,ne())?new Proxy(t,_):t)}function p(t){if(t instanceof IDBRequest)return re(t);if(C.has(t))return C.get(t);const e=ae(t);return e!==t&&(C.set(t,e),I.set(e,t)),e}const A=t=>I.get(t);function ce(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=p(o);return s&&o.addEventListener("upgradeneeded",c=>{s(p(o.result),c.oldVersion,c.newVersion,p(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const ue=["get","getKey","getAll","getAllKeys","count"],le=["put","add","delete","clear"],E=new Map;function T(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(E.get(e))return E.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=le.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||ue.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,r?"readwrite":"readonly");let u=c.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),r&&c.done]))[0]};return E.set(e,i),i}W(t=>({...t,get:(e,n,s)=>T(e,n)||t.get(e,n,s),has:(e,n)=>!!T(e,n)||t.has(e,n)}));const de=["continue","continuePrimaryKey","advance"],F={},L=new WeakMap,K=new WeakMap,he={get(t,e){if(!de.includes(e))return t[e];let n=F[e];return n||(n=F[e]=function(...s){L.set(this,K.get(this)[e](...s))}),n}};async function*fe(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,he);for(K.set(n,e),I.set(n,A(e));e;)yield n,e=await(L.get(n)||e.continue()),L.delete(n)}function N(t,e){return e===Symbol.asyncIterator&&B(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&B(t,[IDBIndex,IDBObjectStore])}W(t=>({...t,get(e,n,s){return N(e,n)?fe:t.get(e,n,s)},has(e,n){return N(e,n)||t.has(e,n)}}));const pe="aramaic-site",f="store",y=ce(pe,1,{upgrade(t){if(!t.objectStoreNames.contains(f))return t.createObjectStore(f)}});class j{static async get(e){return(await y).get(f,e)}static async set(e,n){return(await y).put(f,n,e)}static async delete(e){return(await y).delete(f,e)}static async clear(){return(await y).clear(f)}static async keys(){return(await y).getAllKeys(f)}}const S=(t,e)=>{const n=$(t),s=w({get:()=>{switch(n.value){case"true":return!0;case"false":return!1}},set:r=>{switch(r){case!0:n.value="true";break;case!1:n.value="false";break}}});return O.isBoolean(e)&&(s.value=e),s},me="ʔbgdhYwzḥṭyklmnsʕpṣqršt",ye="AbgdhYwzHTyklmnsCpSqrWt",we="ܐܒܓܕܗܞܘܙܚܛܝܟܠܡܢܣܥܦܨܩܪܫܬ",[V,G,z]=[me,ye,we].map(t=>t.split("")),Ee={translitArr:V,translitAnsiArr:G,originalLettersArr:z},ge={pot:{name:"POT with Western vowels",link:v.potJson.link},pnt:{name:"PNT with Western vowels",link:v.pntJson.link},syr:{name:"Syriac Corpus",link:v.syrJson.link}},Se=H("syriacCorpusStore",()=>{const t=b([]),e=b(""),n=b(!1),s=S("simpleSymbols"),r=S("translit"),i=S("ignoreDiacritics"),o=w(()=>s.value?G:V),a=w(()=>{const l=e.value;return i.value?r.value?o.value.reduce((d,P,D)=>{const k=z[D],h=RegExp("(?<!\\\\)"+P,"gu");return d.replace(h,k)},l):new g(l).stripped:l}),c=w(()=>{if(!e.value)return[];const l=RegExp(a.value,"u");return i.value?t.value.filter(d=>l.test(d.line.stripped)):t.value.filter(d=>l.test(d.line.str))});async function u(l){t.value=[],n.value=!0;const d=l.map(h=>Y.get(ge[h].link)),D=(await Promise.all(d)).flatMap(({data:h})=>h),k=await Ie(D);t.value=k.map(({filename:h,line:J})=>({filename:h,line:new g(J)})),n.value=!1}return{corpus:t,searchString:e,isPreprocessingSyriacCorpus:n,isSimpleSymbols:s,isTranslit:r,doIgnoreDiacritics:i,activeTranslitArr:o,finalSearchString:a,matchingSyriacLines:c,initSyriacCorpus:u}});async function Ie(t){const e=await Q(t),n=await j.get("syriacCorpus")||{},s=n[e];if(s)return s;const r=t.flatMap(({filename:i,text:o})=>o.split(/\n+/).map(O.trim).map(a=>({filename:i,line:a})));return n[e]=r,await j.set("syriacCorpus",n),r}export{j as I,ge as S,S as a,Ee as s,Se as u};
