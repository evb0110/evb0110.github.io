var Ot=Object.defineProperty;var Bt=(n,e,t)=>e in n?Ot(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var O=(n,e,t)=>Bt(n,typeof e!="symbol"?e+"":e,t);import{I as T}from"./IDB-SQL5UDev.js";import{c as Vt}from"./VAvatar-BcS_1dOY.js";import{b4 as Lt,z as q,ar as K,c as C,D as We,aL as zt,b2 as Et,B as Rt,C as Nt,b5 as jt,aK as Ht,aq as Ut,al as Gt,t as I,E as Y,g as w,aR as Wt,av as pe,aE as $e,V as G,I as D,J as _,aT as Ke,K as qe,ab as Qe,ai as Ze,aU as Kt,aV as qt,L as Je,M as Qt,b3 as Xe,ac as Ye,b6 as L,r as H,b7 as Zt,af as Jt,b8 as me,ag as Xt,aD as xe,b9 as Yt,ah as ce,H as ee,am as Oe,aN as Be,ba as ea,aF as ta,e as ke,ae as we,bb as et,ak as te,aj as ae,bc as aa,an as W,w as tt,a9 as na,bd as la,G as re,be as at,bf as fe,bg as ue,bh as ia,A as sa,bi as ra,F as X,bj as oa,bk as Ce,j as Ve,aB as Le,k as ca,bl as ye,bm as se,m as ie,x as ua}from"./index-t7_ix521.js";import{V as nt,f as da,e as fa}from"./VSelect-Bf1-nu77.js";import{V as Pe}from"./VCheckboxBtn-v5KuXLdf.js";import{V as ze,m as ha}from"./VTable-hkO4Jj66.js";function Ee(n,e,t){return Object.keys(n).filter(a=>Lt(a)&&a.endsWith(e)).reduce((a,l)=>(a[l.slice(0,-e.length)]=i=>n[l](i,t(i)),a),{})}class ma{parse(e){const t=e.split(`
`).map(s=>s.trim()),a=this.extractValue(t,"xmin"),l=this.extractValue(t,"xmax"),i=[];let r=0;for(;r<t.length&&!t[r].includes("item []:");)r++;for(;r<t.length;){const s=t.findIndex((u,g)=>g>=r&&u.includes("item [")&&u.includes("]:"));if(s===-1)break;r=s+1;const o=t.findIndex((u,g)=>g>=r&&u.includes("name ="));if(o===-1)continue;const c=this.extractQuotedValue(t[o]),h=t.findIndex((u,g)=>g>=r&&u.includes("intervals: size ="));if(h===-1)continue;const d=[];for(r=h+1;r<t.length;){const u=t.findIndex((f,v)=>v>=r&&f.includes("intervals [")&&f.includes("]:"));if(u===-1||t[u+1]&&t[u+1].includes("item ["))break;r=u+1;const g=t.findIndex((f,v)=>v>=r&&v<r+10&&f.includes("xmin =")),m=t.findIndex((f,v)=>v>=r&&v<r+10&&f.includes("xmax =")),y=t.findIndex((f,v)=>v>=r&&v<r+10&&f.includes("text ="));if(g!==-1&&m!==-1&&y!==-1){const f={xmin:parseFloat(t[g].split("=")[1].trim()),xmax:parseFloat(t[m].split("=")[1].trim()),text:this.extractQuotedValue(t[y])},v=f.text.match(/^\s*\((\d+)\)/);v&&(f.utteranceNumber=parseInt(v[1])),d.push(f)}r=Math.max(g,m,y)+1}c&&i.push({name:c,intervals:d})}return{xmin:a,xmax:l,tiers:i}}extractUtteranceTimings(e){const t=new Map,a=e.tiers.find(i=>i.name==="SENT");if(!a)return t;let l=0;for(const i of a.intervals)!i.text||i.text.trim()===""||(l++,t.set(l,{start:i.xmin,end:i.xmax}));return t}extractValue(e,t){const a=e.find(l=>l.startsWith(t+" ="));return a?parseFloat(a.split("=")[1].trim()):0}extractQuotedValue(e){const t=e.match(/"([^"]*)"/);return t?t[1]:""}}const de=new ma,B="masc-corpus",N="metadata",be="folder-handle",Se="cache-version",Re="2.1";class ga{constructor(){O(this,"isInitialized",!1);O(this,"initializationPromise",null);O(this,"folderHandle",null);O(this,"metadataCache",null);O(this,"basePath","");O(this,"onlineService",null);O(this,"isOnlineMode",!1)}async checkCacheVersion(){return await T.get(B,N,Se)===Re}async setCacheVersion(){await T.set(B,N,Se,Re)}async requestFolderAccess(){try{return this.folderHandle=await window.showDirectoryPicker({mode:"read",startIn:"downloads"}),await T.set(B,be,"handle",this.folderHandle),await this.processMetadata(),await this.setCacheVersion(),this.isInitialized=!0,!0}catch{return!1}}async loadFolderHandle(){try{const e=await T.get(B,be,"handle");if(!e)return!1;this.folderHandle=e;const t=await this.folderHandle.queryPermission({mode:"read"});return t==="granted"?!0:t==="prompt"?await this.folderHandle.requestPermission({mode:"read"})==="granted":!1}catch{return!1}}async getFileFromFolder(e){if(!this.folderHandle)return null;try{const t=e.split("/");let a=this.folderHandle;for(let r=0;r<t.length-1;r++)t[r]&&(a=await a.getDirectoryHandle(t[r]));const l=t[t.length-1];return await(await a.getFileHandle(l)).getFile()}catch{return null}}async detectFolderStructure(){if(await this.getFileFromFolder("MASC_metadata.csv"))this.basePath="";else if(await this.getFileFromFolder("MASC_v1.0/MASC_metadata.csv"))this.basePath="MASC_v1.0/";else throw new Error("Could not find MASC_metadata.csv. Please select the MASC_v1.0 folder.")}async processMetadata(){await this.detectFolderStructure();const e=await this.getFileFromFolder(this.basePath+"MASC_metadata.csv");if(!e)throw new Error("Could not find MASC_metadata.csv");const t=await e.text(),a=this.parseMetadata(t);await T.set(B,N,"speakers",a),await T.set(B,N,"basePath",this.basePath),this.metadataCache=a}parseMetadata(e){var l;const t=e.split(`
`).filter(i=>i.trim()),a=[];for(let i=1;i<t.length;i++){const r=t[i].split(";");r.length>=11&&a.push({serialNumber:parseInt(r[0])||0,textId:((l=r[1])==null?void 0:l.trim())||"",tokens:parseInt(r[2])||0,types:parseInt(r[3])||0,speakerName:r[4]||"",speakerId:r[5]||"",gender:r[6]||"M",age:parseInt(r[7])||0,occupation:r[8]||"",title:r[9]||"",textType:r[10]||""})}return a}async initialize(){if(!this.isInitialized)return this.initializationPromise?this.initializationPromise:(this.initializationPromise=(async()=>{await this.checkCacheVersion()&&(await this.loadFolderHandle()?(this.metadataCache=await T.get(B,N,"speakers"),this.basePath=await T.get(B,N,"basePath")||"",this.isInitialized=!0):await this.clearCache())})(),this.initializationPromise)}async setOnlineMode(e){this.onlineService=e,this.isOnlineMode=!0,this.isInitialized=!0,this.metadataCache=null}async isDataLoaded(){return this.isOnlineMode&&this.onlineService?await this.onlineService.isDataReady():(await this.initialize(),this.isInitialized)}async getMetadata(){if(this.isOnlineMode){const t=await T.get(B,N,"speakers");return t?(this.metadataCache=t,t):[]}if(await this.initialize(),this.metadataCache)return this.metadataCache;const e=await T.get(B,N,"speakers");return e&&(this.metadataCache=e),e||[]}async getTranscription(e,t=!1){if(this.isOnlineMode&&this.onlineService){const r=`${t?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions"}/${e}.txt`,s=await this.onlineService.getTextContent(r);return s?s.charCodeAt(0)===65279||s.startsWith("\uFEFF")?s.substring(1):s:""}if(await this.initialize(),!this.folderHandle)return"";const a=t?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions",l=await this.getFileFromFolder(`${this.basePath}${a}/${e}.txt`);if(l){let i=await l.text();return(i.charCodeAt(0)===65279||i.startsWith("\uFEFF"))&&(i=i.substring(1)),i}return""}async getAudioBlob(e){if(this.isOnlineMode&&this.onlineService){const a=`03a_MASC_audio_files/denoised/${e}.mp3`;return await this.onlineService.getFile(a)}return await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}03a_MASC_audio_files/denoised/${e}.mp3`):null}async getTextGrid(e){if(this.isOnlineMode&&this.onlineService){const a=`03b_MASC_textgrid_files/${e}.TextGrid`;return await this.onlineService.getTextContent(a)||""}if(await this.initialize(),!this.folderHandle)return"";const t=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${e}.TextGrid`);return t?await t.text():""}createAudioUrl(e){return URL.createObjectURL(e)}async searchTranscriptions(e,t=!1){if(await this.initialize(),!this.isInitialized)return[];const a=await this.getMetadata(),l=[];for(const i of a){const r=await this.getTranscription(i.textId,t);if(r&&r.toLowerCase().includes(e.toLowerCase())){const o=r.split(`
`).filter(c=>c.trim()).filter(c=>c.toLowerCase().includes(e.toLowerCase()));l.push({textId:i.textId,speaker:i,matches:o.slice(0,3)})}}return l}async getSpeakerTexts(e){return(await this.getMetadata()).filter(a=>a.speakerId===e)}async getTextsBySpeakerAttributes(e){return(await this.getMetadata()).filter(a=>!(e.gender&&a.gender!==e.gender||e.minAge&&a.age<e.minAge||e.maxAge&&a.age>e.maxAge||e.occupation&&!a.occupation.toLowerCase().includes(e.occupation.toLowerCase())))}async clearCache(){await T.set(B,N,Se,null),await T.set(B,be,"handle",null),this.isInitialized=!1,this.initializationPromise=null,this.folderHandle=null,this.metadataCache=null}async getUtteranceTimings(e){if(this.isOnlineMode&&this.onlineService){const t=await this.getTextGrid(e);if(!t)return null;const a=de.parse(t);return de.extractUtteranceTimings(a)}if(await this.initialize(),!this.folderHandle)return null;try{const t=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${e}.TextGrid`);if(!t)return null;const a=await t.text(),l=de.parse(a);return de.extractUtteranceTimings(l)}catch{return null}}async getDatabaseFile(){return this.isOnlineMode&&this.onlineService?await this.onlineService.getFile("04_MASC_database/aramaic_corpus.db"):(await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}04_MASC_database/aramaic_corpus.db`):null)}}const Z=new ga,xn=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"})),j="masc-corpus",va="https://evb0110.github.io/static/MASC_v1.0/manifest.json",Ne="https://evb0110.github.io/static/MASC_v1.0/",V={metadata:"metadata",textgrids:"textgrids",transcriptions:"transcriptions",lemmatized:"lemmatized",audio:"audio",database:"database",manifest:"manifest"};class wa{constructor(){O(this,"manifest",null);O(this,"localState",null);O(this,"downloadQueue",[]);O(this,"isDownloading",!1);O(this,"abortController",null);O(this,"isDatabaseInitialized",!1);O(this,"initializationInProgress",!1)}async initialize(){if(this.initializationInProgress){console.log("[MASCOnline] Initialization already in progress");return}this.initializationInProgress=!0;try{console.log("[MASCOnline] Initializing service..."),await this.ensureDatabase(),console.log("[MASCOnline] Database ready"),await this.loadLocalState(),console.log("[MASCOnline] Local state loaded");try{await this.fetchManifest(),console.log("[MASCOnline] Manifest loaded")}catch{console.log("[MASCOnline] Could not fetch manifest, will use fallback")}}catch(e){throw e}finally{this.initializationInProgress=!1}}async ensureDatabase(){if(this.isDatabaseInitialized)return;const e={initialized:!0,timestamp:Date.now()};for(const t of Object.values(V))try{await T.set(j,t,"_init",e)}catch{}await new Promise(t=>setTimeout(t,100)),this.isDatabaseInitialized=!0}async getDownloadStatus(){if(this.manifest||await this.fetchManifest(),!this.manifest)return{totalFiles:0,downloadedFiles:0,isComplete:!1,missingCritical:[]};this.localState||await this.loadLocalState();const e=Object.keys(this.manifest.files).length,t=this.localState?Object.values(this.localState.files).filter(l=>l.downloaded).length:0,a=await this.getMissingCriticalFiles();return{totalFiles:e,downloadedFiles:t,isComplete:t===e,missingCritical:a}}async getMissingCriticalFiles(){if(this.manifest||await this.fetchManifest(),!this.manifest)return[];const e=["MASC_metadata.csv","04_MASC_database/aramaic_corpus.db"],t=[];for(const a of e)if(this.manifest.files[a]){const l=this.getStoreForFile(a);await T.get(j,l,a)||t.push(a)}return t}async isDataReady(){try{if(this.localState||await this.loadLocalState(),!this.localState||!this.localState.files)return console.log("[MASCOnline] No local state - data not ready"),!1;const e=Object.values(this.localState.files).filter(a=>a.downloaded).length;return console.log(`[MASCOnline] Downloaded files count: ${e}`),e<100?!1:await T.get(j,V.metadata,"MASC_metadata.csv")!==null}catch{return!0}}isAudioFile(e){const t=e.includes("03a_MASC_audio_files/")||e.includes("03b_MASC_audio_files/")||e.includes("/audio/")||e.includes("_audio_")||e.endsWith(".mp3")||e.endsWith(".wav")||e.endsWith(".m4a")||e.endsWith(".ogg")||e.endsWith(".flac")||e.endsWith(".aac");return t&&!e.includes("03a_MASC_audio_files/")&&!e.includes("03b_MASC_audio_files/")&&console.log(`[MASCOnline] Non-standard audio file detected: ${e}`),t}async getFilesToUpdate(){if(this.manifest||await this.fetchManifest(),!this.manifest)throw new Error("Failed to load manifest");if(!this.localState)return Object.keys(this.manifest.files);const e=[];for(const[t,a]of Object.entries(this.manifest.files)){const l=this.localState.files[t];(!l||!l.downloaded||l.hash!==a.hash)&&e.push(t)}return e}async downloadEssentialFiles(e){var c,h;if(console.log("[MASCOnline] Starting essential files download"),this.manifest||(console.log("[MASCOnline] Loading manifest..."),await this.fetchManifest()),!this.manifest)throw new Error("Failed to load manifest");this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}});const t=await this.getFilesToUpdate(),a=t.filter(d=>this.isAudioFile(d));console.log(`[MASCOnline] Found ${a.length} audio files to exclude`),console.log("[MASCOnline] Sample audio files:",a.slice(0,3));const l=t.filter(d=>!this.isAudioFile(d)),i=l.filter(d=>d.toLowerCase().includes("audio"));if(i.length>0&&console.warn(`[MASCOnline] WARNING: Found files with "audio" in path that weren't filtered:`,i),console.log(`[MASCOnline] Essential files to download: ${l.length}`),console.log("[MASCOnline] Essential files include:",l.slice(0,5)),l.length===0){console.log("[MASCOnline] No essential files to download");return}const r=l.reduce((d,u)=>{var g;return d+(((g=this.manifest.files[u])==null?void 0:g.size)||0)},0);console.log(`[MASCOnline] Total essential files size: ${(r/1024/1024).toFixed(2)}MB`),this.downloadQueue=[...l],this.isDownloading=!0,this.abortController=new AbortController;const s={totalFiles:l.length,downloadedFiles:0,totalBytes:r,downloadedBytes:0,currentFile:"",currentFileProgress:0,errors:[]},o=Date.now();try{e(s);const d=this.groupFilesByType(l);console.log("[MASCOnline] Grouped files by type:",Object.keys(d)),"audio"in d&&console.error("[MASCOnline] ERROR: Audio group found in essential files!",d.audio);for(const[u,g]of Object.entries(d)){if(console.log(`[MASCOnline] Downloading ${g.length} ${u} files`),u==="audio"){console.error("[MASCOnline] SKIPPING audio group that shouldn't exist!");continue}if(u!=="database")for(let y=0;y<g.length;y+=10){const f=g.slice(y,y+10);if((c=this.abortController)!=null&&c.signal.aborted)throw new Error("Download cancelled");const v=f.map(async x=>{try{const A=this.manifest.files[x].size;await this.downloadFile(x,k=>{}),s.downloadedFiles++,s.downloadedBytes+=A,this.localState.files[x]||(this.localState.files[x]={downloaded:!1,hash:""}),this.localState.files[x].downloaded=!0,this.localState.files[x].hash=this.manifest.files[x].hash,e(s)}catch(A){throw console.error(`[MASCOnline] Failed to download ${x}:`,A),s.errors.push(`Failed to download ${x}: ${A}`),s.downloadedFiles++,e(s),A}});await Promise.all(v);const b=(Date.now()-o)/1e3;if(b>0){s.speed=s.downloadedBytes/b;const x=s.totalBytes-s.downloadedBytes;s.timeRemaining=x/s.speed}s.currentFile=`Completed ${Math.min(y+10,g.length)}/${g.length} ${u} files`,e(s),await this.saveLocalState(),await new Promise(x=>setTimeout(x,100))}else for(const m of g){if((h=this.abortController)!=null&&h.signal.aborted)throw new Error("Download cancelled");try{s.currentFile=m;const y=this.manifest.files[m].size;e(s),await this.downloadFile(m,v=>{s.currentFileProgress=v,e(s)}),s.downloadedFiles++,s.downloadedBytes+=y,s.currentFileProgress=100;const f=(Date.now()-o)/1e3;if(f>0){s.speed=s.downloadedBytes/f;const v=s.totalBytes-s.downloadedBytes;s.timeRemaining=v/s.speed}this.localState.files[m]||(this.localState.files[m]={downloaded:!1,hash:""}),this.localState.files[m].downloaded=!0,this.localState.files[m].hash=this.manifest.files[m].hash,e(s),await new Promise(v=>setTimeout(v,50))}catch(y){console.error(`[MASCOnline] Failed to download ${m}:`,y),s.errors.push(`Failed to download ${m}: ${y}`),s.downloadedFiles++,e(s)}}}await this.saveLocalState(),console.log("[MASCOnline] Essential files download complete")}finally{this.isDownloading=!1,this.abortController=null}}async downloadAllFiles(e){var r,s;this.manifest||await this.fetchManifest();const t=await this.getFilesToUpdate();if(t.length===0)return;this.downloadQueue=[...t],this.isDownloading=!0,this.abortController=new AbortController;const a=this.calculateTotalSize(t),l={totalFiles:t.length,downloadedFiles:0,totalBytes:a,downloadedBytes:0,currentFile:"",currentFileProgress:0,errors:[]},i=Date.now();try{e(l);const o=this.groupFilesByType(t);for(const[c,h]of Object.entries(o))if(c==="txt"||c==="json")for(let u=0;u<h.length;u+=10){const g=h.slice(u,u+10);if((r=this.abortController)!=null&&r.signal.aborted)throw new Error("Download cancelled");const m=g.map(async f=>{try{const v=this.manifest.files[f].size;await this.downloadFile(f,b=>{}),l.downloadedFiles++,l.downloadedBytes+=v,this.localState.files[f]||(this.localState.files[f]={downloaded:!1}),this.localState.files[f].downloaded=!0,this.localState.files[f].hash=this.manifest.files[f].hash,e(l)}catch(v){throw console.error(`[MASCOnline] Failed to download ${f}:`,v),l.errors.push(`Failed to download ${f}: ${v}`),l.downloadedFiles++,e(l),v}});await Promise.all(m);const y=(Date.now()-i)/1e3;if(y>0){l.speed=l.downloadedBytes/y;const f=l.totalBytes-l.downloadedBytes;l.timeRemaining=f/l.speed}l.currentFile=`Completed ${Math.min(u+10,h.length)}/${h.length} ${c} files`,e(l),await this.saveLocalState(),await new Promise(f=>setTimeout(f,100))}else for(const d of h){if((s=this.abortController)!=null&&s.signal.aborted)throw new Error("Download cancelled");try{l.currentFile=d;const u=this.manifest.files[d].size;e(l),await this.downloadFile(d,m=>{l.currentFileProgress=m,e(l)}),l.downloadedFiles++,l.downloadedBytes+=u,l.currentFileProgress=100;const g=(Date.now()-i)/1e3;if(g>0){l.speed=l.downloadedBytes/g;const m=l.totalBytes-l.downloadedBytes;l.timeRemaining=m/l.speed}this.localState.files[d]||(this.localState.files[d]={downloaded:!1}),this.localState.files[d].downloaded=!0,this.localState.files[d].hash=this.manifest.files[d].hash,e(l),await new Promise(m=>setTimeout(m,50))}catch(u){l.errors.push(`Failed to download ${d}: ${u}`),l.downloadedFiles++,e(l)}}await this.saveLocalState()}finally{this.isDownloading=!1,this.abortController=null}}async downloadAllAudioFiles(e){var s;if(console.log("[MASCOnline] Starting audio files download"),this.manifest||await this.fetchManifest(),!this.manifest)throw new Error("Failed to load manifest");this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}});const a=(await this.getFilesToUpdate()).filter(o=>this.isAudioFile(o));if(console.log(`[MASCOnline] Audio files to download: ${a.length}`),a.length===0){console.log("[MASCOnline] No audio files to download");return}const l=a.reduce((o,c)=>{var h;return o+(((h=this.manifest.files[c])==null?void 0:h.size)||0)},0);console.log(`[MASCOnline] Total audio files size: ${(l/1024/1024).toFixed(2)}MB`),this.downloadQueue=[...a],this.isDownloading=!0,this.abortController=new AbortController;const i={totalFiles:a.length,downloadedFiles:0,totalBytes:l,downloadedBytes:0,currentFile:"",currentFileProgress:0,errors:[]},r=Date.now();try{e(i);for(const o of a){if((s=this.abortController)!=null&&s.signal.aborted)throw new Error("Download cancelled");try{i.currentFile=o;const c=this.manifest.files[o].size;e(i),await this.downloadFile(o,d=>{i.currentFileProgress=d,e(i)}),i.downloadedFiles++,i.downloadedBytes+=c,i.currentFileProgress=100;const h=(Date.now()-r)/1e3;if(h>0){i.speed=i.downloadedBytes/h;const d=i.totalBytes-i.downloadedBytes;i.timeRemaining=d/i.speed}this.localState.files[o]||(this.localState.files[o]={downloaded:!1,hash:""}),this.localState.files[o].downloaded=!0,this.localState.files[o].hash=this.manifest.files[o].hash,e(i),await new Promise(d=>setTimeout(d,50))}catch(c){console.error(`[MASCOnline] Failed to download ${o}:`,c),i.errors.push(`Failed to download ${o}: ${c}`),i.downloadedFiles++,e(i)}}await this.saveLocalState(),console.log("[MASCOnline] Audio files download complete")}finally{this.isDownloading=!1,this.abortController=null}}async getAudioDownloadStatus(){var i,r;if(this.manifest||await this.fetchManifest(),!this.manifest)return{totalAudioFiles:0,downloadedAudioFiles:0,totalSize:0,downloadedSize:0};this.localState||await this.loadLocalState();let e=0,t=0,a=0,l=0;for(const[s,o]of Object.entries(this.manifest.files))this.isAudioFile(s)&&(e++,a+=o.size,(r=(i=this.localState)==null?void 0:i.files[s])!=null&&r.downloaded&&(t++,l+=o.size));return{totalAudioFiles:e,downloadedAudioFiles:t,totalSize:a,downloadedSize:l}}async checkAudioForText(e){var a,l;if(this.manifest||await this.fetchManifest(),!this.manifest)return{exists:!1,downloaded:!1};const t=[`03a_MASC_audio_files/denoised/${e}.mp3`,`03b_MASC_audio_files/${e}.mp3`];for(const i of t)if(this.manifest.files[i])return{exists:!0,downloaded:((l=(a=this.localState)==null?void 0:a.files[i])==null?void 0:l.downloaded)||!1,path:i,size:this.manifest.files[i].size};return{exists:!1,downloaded:!1}}cancelDownload(){this.abortController&&(this.abortController.abort(),this.isDownloading=!1)}async clearAllData(){const e=Object.values(V);for(const t of e)try{await indexedDB.deleteDatabase(j);break}catch{}this.localState=null}async getFile(e){const t=this.getStoreForFile(e),a=await T.get(j,t,e);if(!a)return console.log(`[MASCOnline] File not found locally: ${e}`),null;const l=new Blob([a.content],{type:a.type});return new File([l],a.name,{type:a.type})}async getManifest(){return this.manifest||await this.fetchManifest(),this.manifest}async getTextContent(e){const t=this.getStoreForFile(e),a=await T.get(j,t,e);return a?typeof a.content=="string"?a.content:new TextDecoder().decode(a.content):(console.log(`[MASCOnline] File not found locally: ${e}`),null)}async checkForUpdates(){try{const e=this.manifest;return await this.fetchManifest(),!e||e.version!==this.manifest.version?!0:(await this.getFilesToUpdate()).length>0}catch{return!1}}async performBackgroundUpdate(e){const t=await this.getFilesToUpdate();if(t.length!==0){e==null||e(`Updating ${t.length} files...`);for(const a of t)try{await this.downloadFile(a),e==null||e(`Updated ${a}`)}catch{}await this.saveLocalState(),e==null||e("Update complete")}}async downloadSingleFile(e){try{return this.manifest||await this.fetchManifest(),!this.manifest||!this.manifest.files[e]?!1:(await this.downloadFile(e),this.localState||await this.loadLocalState(),this.localState&&(this.localState.files[e]||(this.localState.files[e]={downloaded:!1,hash:""}),this.localState.files[e].downloaded=!0,this.localState.files[e].hash=this.manifest.files[e].hash,await this.saveLocalState()),!0)}catch{return!1}}async fetchManifest(){if(typeof window>"u"||!window.fetch)throw new Error("Fetch API not available");try{const e=new AbortController,t=setTimeout(()=>{console.log("[MASCOnline] Manifest fetch timeout after 2 seconds"),e.abort()},2e3),a=await fetch(va,{signal:e.signal});if(clearTimeout(t),!a.ok)throw new Error(`Failed to fetch manifest: ${a.status} ${a.statusText}`);const l=await a.text();try{this.manifest=JSON.parse(l)}catch{throw new Error("Invalid manifest JSON")}}catch(e){if(e.message&&e.message.includes("CORS"),e.name==="AbortError")throw new Error("Manifest fetch timed out after 10 seconds");await this.fetchManifestAlternative()}}async fetchManifestAlternative(){try{const e=await fetch("/masc-manifest.json");if(e.ok){this.manifest=await e.json();return}}catch{}try{const e=await fetch("/.devkit/manifest.json");if(e.ok){this.manifest=await e.json();return}}catch{}this.manifest={version:"1.0.0",generated:new Date().toISOString(),baseUrl:Ne,totalSize:919127219,totalFiles:889,files:{"speakers.json":{size:5e4,hash:"dummy",lastModified:new Date().toISOString()},"04_MASC_database/aramaic_corpus.db":{size:1e7,hash:"dummy",lastModified:new Date().toISOString()}}}}async loadLocalState(){const e=await T.get(j,V.manifest,"localState");e&&(this.localState=e)}async saveLocalState(){this.manifest&&(this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.version=this.manifest.version,await T.set(j,V.manifest,"localState",this.localState))}async downloadFile(e,t){var r,s,o;if((r=this.abortController)!=null&&r.signal.aborted)throw new Error("Download cancelled");const a=Ne+e,l=(s=this.manifest)==null?void 0:s.files[e],i=l&&l.size<5e4;try{const c=await fetch(a,{signal:(o=this.abortController)==null?void 0:o.signal,mode:"cors",credentials:"omit"});if(!c.ok)throw new Error(`Failed to download ${e}: ${c.statusText}`);let h;if(i){const m=await c.arrayBuffer();h=new Uint8Array(m),t&&t(100)}else{const m=Number(c.headers.get("content-length")),y=c.body.getReader(),f=[];let v=0;for(;;){const{done:x,value:A}=await y.read();if(x)break;f.push(A),v+=A.length,t&&m&&t(v/m*100)}h=new Uint8Array(v);let b=0;for(const x of f)h.set(x,b),b+=x.length}const d=this.getStoreForFile(e),u={name:e.split("/").pop(),content:h,type:this.getMimeType(e)};let g=3;for(;g>0;)try{await T.set(j,d,e,u);break}catch(m){if(g--,g>0)await new Promise(y=>setTimeout(y,500));else throw m}this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.files[e]={downloaded:!0,hash:this.manifest.files[e].hash,downloadedAt:new Date().toISOString()}}catch(c){throw c.name==="AbortError"?new Error("Download cancelled"):c}}getStoreForFile(e){return e.includes("MASC_textgrid")||e.includes("textgrid_files")?V.textgrids:e.includes("MASC_lemmatized")?V.lemmatized:e.includes("MASC_transcriptions")?V.transcriptions:e.includes("MASC_audio")||e.includes("audio_files")?V.audio:e.includes("MASC_database")||e.endsWith(".db")?V.database:(e.endsWith(".json"),V.metadata)}getMimeType(e){var a;switch((a=e.split(".").pop())==null?void 0:a.toLowerCase()){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"txt":return"text/plain";case"json":return"application/json";case"db":return"application/x-sqlite3";case"textgrid":return"text/plain";default:return"application/octet-stream"}}calculateTotalSize(e){return this.manifest?e.reduce((t,a)=>{var l;return t+(((l=this.manifest.files[a])==null?void 0:l.size)||0)},0):0}groupFilesByType(e){const t={metadata:[],transcriptions:[],lemmatized:[],textgrids:[],database:[],other:[]};for(const a of e)a.endsWith(".json")||a.endsWith(".csv")?t.metadata.push(a):a.includes("MASC_transcriptions")?t.transcriptions.push(a):a.includes("MASC_lemmatized")?t.lemmatized.push(a):a.includes("textgrid")||a.includes("TextGrid")?t.textgrids.push(a):a.endsWith(".db")?t.database.push(a):(t.other.push(a),console.log(`[MASCOnline] File categorized as 'other': ${a}`));return Object.fromEntries(Object.entries(t).filter(([a,l])=>l.length>0))}}const Fn=new wa;class ya{parseText(e){if(!e||!e.trim())return[];const t=[],a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,r=!1;for(;(i=a.exec(e))!==null;){r=!0;const s=parseInt(i[1]),o=i[2].trim(),c=this.parseUtteranceTokens(o);t.push({number:s,tokens:c,raw:o})}if(!r)for(;(i=l.exec(e))!==null;){const s=parseInt(i[1]),o=i[2].trim(),c=this.parseUtteranceTokens(o);t.push({number:s,tokens:c,raw:o})}return t}parseUtteranceTokens(e){const t=[];let a=0,l=e;for(;l.trim();){let i=!1;const r=l.match(/^\s*<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/);if(r){const u=r[0],g=r[1].trim(),m=l.length>u.length&&/\s/.test(l[u.length]),y=g.match(/^(\S+?)<([^>]+)>$/);if(y){const[,f,v]=y,b={surface:f,annotation:v===f?void 0:v,position:a++,raw:u.trim(),isArabic:!0,arabicContent:f,spaceAfter:m};this.parseAnnotationContent(v,b),t.push(b)}else t.push({surface:g,position:a++,raw:u.trim(),isArabic:!0,arabicContent:g,spaceAfter:m});l=l.substring(u.length),i=!0;continue}let s="",o=!1,c=0,h=!1;for(;c<l.length;){const u=l[c];if(u==="<")o=!0;else if(u===">"){o=!1,s+=u,c++,c<l.length&&/\s/.test(l[c])&&(h=!0);break}if(!o&&/\s/.test(u)&&s.length>0&&!s.includes("<")){h=!0;break}s+=u,c++}if(!s||s.trim()===""){l=l.substring(1);continue}const d=s.match(/^(\S+?)<([^>]+)>-(\S+?)(?:<([^>]+)>)?$/);if(d){const[u,g,m,y,f]=d;t.push({surface:g+"-"+y,annotation:f,position:a++,raw:u,prefix:{surface:g,morphology:m},lemma:f?f.split(" ")[0]:void 0,spaceAfter:h}),i=!0}else if(s.includes("<")&&s.endsWith(">")){const u=s.trim(),g=u.match(/^([^<]+)<([^>]+)>$/);if(g){const[,m,y]=g,f={surface:m.trim(),annotation:y===m.trim()?void 0:y,position:a++,raw:u,spaceAfter:h};this.parseAnnotationContent(y,f),t.push(f),i=!0}}i||t.push({surface:s,position:a++,raw:s,spaceAfter:h}),l=l.substring(c).trimStart()}return t}parseAnnotationContent(e,t){const a=e.split(/\s+/);if(a.length===0)return;const l=a[0];if(l.includes("/")){const i=l.split("/").map(r=>r.trim()).filter(r=>r);i.length>0&&(t.lemma=i[0],i.length>1&&(t.variants=i.slice(1)))}else t.lemma=l;a.length>1&&(t.morphology=a.slice(1))}extractSurfaceForms(e){return this.parseText(e).map(a=>{const l=a.tokens.map(i=>i.surface);return`(${a.number}) ${l.join(" ")}`}).join(" ")}getTokenSummary(e){const t=[];return e.lemma&&t.push(`Lemma: ${e.lemma}`),e.variants&&e.variants.length>0&&t.push(`Variants: ${e.variants.join(", ")}`),e.morphology&&e.morphology.length>0&&t.push(`Morphology: ${e.morphology.join(" ")}`),e.prefix&&t.push(`Prefix: ${e.prefix.surface} (${e.prefix.morphology})`),e.isArabic&&t.push("Arabic"),t.join(`
`)}}const ba=new ya;class Sa{parseTranscription(e){const t=[];if(!e)return t;const a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,r=!1;for(;(i=a.exec(e))!==null;){r=!0;const s=parseInt(i[1]),o=i[2].trim();t.push({number:s,text:o,tokens:this.tokenizePlainText(o,s)})}if(!r)for(;(i=l.exec(e))!==null;){const s=parseInt(i[1]),o=i[2].trim();t.push({number:s,text:o,tokens:this.tokenizePlainText(o,s)})}return t}parseLemmatizedTranscription(e){const t=[];if(!e)return t;const a=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,l=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,r=!1;for(;(i=a.exec(e))!==null;){r=!0;const s=parseInt(i[1]),o=i[2].trim(),c=this.extractSurfaceForms(o);t.push({number:s,text:c,tokens:this.tokenizeLemmatizedText(o,s)})}if(!r)for(;(i=l.exec(e))!==null;){const s=parseInt(i[1]),o=i[2].trim(),c=this.extractSurfaceForms(o);t.push({number:s,text:c,tokens:this.tokenizeLemmatizedText(o,s)})}return t}parseAnnotatedTranscription(e){return ba.parseText(e)}tokenizePlainText(e,t){const a=[],l=e.split(/(\s+)/).filter(r=>r.trim());let i=0;for(const r of l)r.trim()&&(a.push({surface:r,position:i,utteranceNumber:t}),i++);return a}tokenizeLemmatizedText(e,t){const a=[];if(!e||!e.trim())return a;try{const i=this.extractSurfaceForms(e).split(/\s+/).filter(s=>s.trim());let r=0;for(const s of i)if(s.trim()){const o={surface:s,position:r,utteranceNumber:t},c=e.match(new RegExp(`${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}<([^>]+)>`));if(c){const d=c[1].split(" ");o.lemma=d[0].split("/")[0],d.length>1&&(o.morphology=d.slice(1))}a.push(o),r++}}catch{e.replace(/<[^>]*>/g," ").split(/\s+/).filter(r=>r.trim()).forEach((r,s)=>{a.push({surface:r,position:s,utteranceNumber:t})})}return a}async search(e,t={searchIn:"surface"}){var r;const a=[];let i=await Z.getMetadata();(r=t.speakerFilter)!=null&&r.length&&(i=i.filter(s=>t.speakerFilter.includes(s.speakerId))),t.genderFilter&&(i=i.filter(s=>s.gender===t.genderFilter)),t.ageRange&&(i=i.filter(s=>s.age>=t.ageRange[0]&&s.age<=t.ageRange[1]));for(const s of i){const o=t.searchIn!=="surface",c=await Z.getTranscription(s.textId,o);if(!c)continue;const h=o?this.parseLemmatizedTranscription(c):this.parseTranscription(c);for(const d of h){const u=this.findMatches(d.tokens,e,t);if(u.length>0){const g=this.getContext(d,u[0].position);a.push({textId:s.textId,speaker:s,utteranceNumber:d.number,utteranceText:d.text,matchedTokens:u,context:g})}}}return a}findMatches(e,t,a){const l=[],i=a.caseSensitive?t:t.toLowerCase();for(const r of e){let s="";a.searchIn==="surface"||a.searchIn==="both"?s=a.caseSensitive?r.surface:r.surface.toLowerCase():a.searchIn==="lemma"&&r.lemma&&(s=a.caseSensitive?r.lemma:r.lemma.toLowerCase());let o=!1;if(a.regex)try{o=new RegExp(i).test(s)}catch{o=s.includes(i)}else a.wholeWord?o=s===i:o=s.includes(i);o&&l.push(r)}return l}getContext(e,t,a=5){const l=e.tokens,i=l[t],r=l.slice(Math.max(0,t-a),t),s=l.slice(t+1,t+a+1);return{before:r.map(o=>o.surface).join(" "),match:i.surface,after:s.map(o=>o.surface).join(" ")}}async generateConcordance(e){return e.map(t=>({textId:t.textId,speaker:t.speaker,left:t.context.before,keyword:t.context.match,right:t.context.after,utteranceNumber:t.utteranceNumber,audioTimestamp:t.audioTimestamp}))}extractSurfaceForms(e){if(!e||!e.includes("<"))return e.trim();try{let t=e;const a=/<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/g;t=t.replace(a,(s,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const l=/<ar>\s*(.*?)\s*<\/ar>/g;t=t.replace(l,(s,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const i=/<(\w+)>\s*([^<]*?)\s*<\/\1>/g;t=t.replace(i," $2 ");const r=/(\S+?)<[^>]*>/g;return t=t.replace(r,"$1"),t=t.replace(/<[^>]*>/g," "),t=t.replace(/>[^<]*</g," "),t=t.replace(/^[>\s]+|[<\s]+$/g,""),t=t.replace(/\s+/g," ").trim(),t}catch{let a=e.replace(/(\S+?)<[^>]*>/g,"$1").replace(/<[^>]*>/g," ");return a=a.replace(/^[>\s]+|[<\s]+$/g,"").replace(/\s+/g," ").trim(),a}}async getWordFrequency(e={countBy:"surface"}){var i;const t=new Map;let l=await Z.getMetadata();(i=e.speakerFilter)!=null&&i.length&&(l=l.filter(r=>e.speakerFilter.includes(r.speakerId)));for(const r of l){const s=e.countBy==="lemma",o=await Z.getTranscription(r.textId,s);if(!o)continue;const c=s?this.parseLemmatizedTranscription(o):this.parseTranscription(o);for(const h of c)for(const d of h.tokens){const u=e.countBy==="lemma"&&d.lemma?d.lemma:d.surface;t.set(u,(t.get(u)||0)+1)}}if(e.minFrequency)for(const[r,s]of t.entries())s<e.minFrequency&&t.delete(r);return t}async getCollocations(e,t={window:3,minFrequency:2,measure:"frequency"}){const a=new Map,l=await Z.getMetadata();for(const i of l){const r=await Z.getTranscription(i.textId,!1);if(!r)continue;const s=this.parseTranscription(r);for(const o of s){const c=o.tokens;for(let h=0;h<c.length;h++)if(c[h].surface.toLowerCase().includes(e.toLowerCase())){for(let d=Math.max(0,h-t.window);d<=Math.min(c.length-1,h+t.window);d++)if(d!==h){const u=c[d].surface;a.set(u,(a.get(u)||0)+1)}}}}for(const[i,r]of a.entries())r<t.minFrequency&&a.delete(i);return a}exportResults(e,t){switch(t){case"csv":const a=["Text ID","Speaker","Gender","Age","Utterance","Left Context","Match","Right Context"],l=e.map(i=>[i.textId,i.speaker.speakerName,i.speaker.gender,i.speaker.age,i.utteranceNumber,i.context.before,i.context.match,i.context.after]);return[a,...l].map(i=>i.join("	")).join(`
`);case"json":return JSON.stringify(e,null,2);case"txt":return e.map(i=>`${i.textId} (${i.speaker.speakerName}): ...${i.context.before} [[${i.context.match}]] ${i.context.after}...`).join(`

`);default:return""}}generateCitation(e){const t=e.speaker;return`${t.speakerName} (${t.gender}, age ${t.age}). Text ${e.textId}, utterance ${e.utteranceNumber}. Modern Aramaic Spoken Corpus (MASC) v1.0.`}}const kn=new Sa,pa=Vt("v-alert-title"),xa=["success","info","warning","error"],Fa=_({border:{type:[Boolean,String],validator:n=>typeof n=="boolean"||["top","end","bottom","start"].includes(n)},borderColor:String,closable:Boolean,closeIcon:{type:L,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:n=>xa.includes(n)},...Ye(),...Xe(),...Qt(),...Je(),...qt(),...Kt(),...Ze(),...Qe(),...qe(),...Ke({variant:"flat"})},"VAlert"),Cn=q()({name:"VAlert",props:Fa(),emits:{"click:close":n=>!0,"update:modelValue":n=>!0},setup(n,e){let{emit:t,slots:a}=e;const l=K(n,"modelValue"),i=C(()=>{if(n.icon!==!1)return n.type?n.icon??`$${n.type}`:n.icon}),r=C(()=>({color:n.color??n.type,variant:n.variant})),{themeClasses:s}=We(n),{colorClasses:o,colorStyles:c,variantClasses:h}=zt(r),{densityClasses:d}=Et(n),{dimensionStyles:u}=Rt(n),{elevationClasses:g}=Nt(n),{locationStyles:m}=jt(n),{positionClasses:y}=Ht(n),{roundedClasses:f}=Ut(n),{textColorClasses:v,textColorStyles:b}=Gt(I(n,"borderColor")),{t:x}=Y(),A=C(()=>({"aria-label":x(n.closeLabel),onClick(k){l.value=!1,t("click:close",k)}}));return()=>{const k=!!(a.prepend||i.value),z=!!(a.title||n.title),R=!!(a.close||n.closable);return l.value&&w(n.tag,{class:["v-alert",n.border&&{"v-alert--border":!!n.border,[`v-alert--border-${n.border===!0?"start":n.border}`]:!0},{"v-alert--prominent":n.prominent},s.value,o.value,d.value,g.value,y.value,f.value,h.value,n.class],style:[c.value,u.value,m.value,n.style],role:"alert"},{default:()=>{var p,S;return[Wt(!1,"v-alert"),n.border&&w("div",{key:"border",class:["v-alert__border",v.value],style:b.value},null),k&&w("div",{key:"prepend",class:"v-alert__prepend"},[a.prepend?w($e,{key:"prepend-defaults",disabled:!i.value,defaults:{VIcon:{density:n.density,icon:i.value,size:n.prominent?44:28}}},a.prepend):w(pe,{key:"prepend-icon",density:n.density,icon:i.value,size:n.prominent?44:28},null)]),w("div",{class:"v-alert__content"},[z&&w(pa,{key:"title"},{default:()=>{var F;return[((F=a.title)==null?void 0:F.call(a))??n.title]}}),((p=a.text)==null?void 0:p.call(a))??n.text,(S=a.default)==null?void 0:S.call(a)]),a.append&&w("div",{key:"append",class:"v-alert__append"},[a.append()]),R&&w("div",{key:"close",class:"v-alert__close"},[a.close?w($e,{key:"close-defaults",defaults:{VBtn:{icon:n.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var F;return[(F=a.close)==null?void 0:F.call(a,{props:A.value})]}}):w(G,D({key:"close-btn",icon:n.closeIcon,size:"x-small",variant:"text"},A.value),null)])]}})}}});function ka(){const n=H([]);Zt(()=>n.value=[]);function e(t,a){n.value[a]=t}return{refs:n,updateRef:e}}const Ca=_({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:n=>n.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:n=>n%1===0},totalVisible:[Number,String],firstIcon:{type:L,default:"$first"},prevIcon:{type:L,default:"$prev"},nextIcon:{type:L,default:"$next"},lastIcon:{type:L,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...ta(),...Ye(),...Xe(),...Je(),...Ze(),...ea(),...Qe({tag:"nav"}),...qe(),...Ke({variant:"text"})},"VPagination"),je=q()({name:"VPagination",props:Ca(),emits:{"update:modelValue":n=>!0,first:n=>!0,prev:n=>!0,next:n=>!0,last:n=>!0},setup(n,e){let{slots:t,emit:a}=e;const l=K(n,"modelValue"),{t:i,n:r}=Y(),{isRtl:s}=Jt(),{themeClasses:o}=We(n),{width:c}=me(),h=Xt(-1);xe(void 0,{scoped:!0});const{resizeRef:d}=Yt(p=>{if(!p.length)return;const{target:S,contentRect:F}=p[0],P=S.querySelector(".v-pagination__list > *");if(!P)return;const M=F.width,$=P.offsetWidth+parseFloat(getComputedStyle(P).marginRight)*2;h.value=y(M,$)}),u=C(()=>parseInt(n.length,10)),g=C(()=>parseInt(n.start,10)),m=C(()=>n.totalVisible!=null?parseInt(n.totalVisible,10):h.value>=0?h.value:y(c.value,58));function y(p,S){const F=n.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((p-S*F)/S).toFixed(2)))}const f=C(()=>{if(u.value<=0||isNaN(u.value)||u.value>Number.MAX_SAFE_INTEGER)return[];if(m.value<=0)return[];if(m.value===1)return[l.value];if(u.value<=m.value)return ce(u.value,g.value);const p=m.value%2===0,S=p?m.value/2:Math.floor(m.value/2),F=p?S:S+1,P=u.value-S;if(F-l.value>=0)return[...ce(Math.max(1,m.value-1),g.value),n.ellipsis,u.value];if(l.value-P>=(p?1:0)){const M=m.value-1,$=u.value-M+g.value;return[g.value,n.ellipsis,...ce(M,$)]}else{const M=Math.max(1,m.value-3),$=M===1?l.value:l.value-Math.ceil(M/2)+g.value;return[g.value,n.ellipsis,...ce(M,$),n.ellipsis,u.value]}});function v(p,S,F){p.preventDefault(),l.value=S,F&&a(F,S)}const{refs:b,updateRef:x}=ka();xe({VPaginationBtn:{color:I(n,"color"),border:I(n,"border"),density:I(n,"density"),size:I(n,"size"),variant:I(n,"variant"),rounded:I(n,"rounded"),elevation:I(n,"elevation")}});const A=C(()=>f.value.map((p,S)=>{const F=P=>x(P,S);if(typeof p=="string")return{isActive:!1,key:`ellipsis-${S}`,page:p,props:{ref:F,ellipsis:!0,icon:!0,disabled:!0}};{const P=p===l.value;return{isActive:P,key:p,page:r(p),props:{ref:F,ellipsis:!1,icon:!0,disabled:!!n.disabled||+n.length<2,color:P?n.activeColor:n.color,"aria-current":P,"aria-label":i(P?n.currentPageAriaLabel:n.pageAriaLabel,p),onClick:M=>v(M,p)}}}})),k=C(()=>{const p=!!n.disabled||l.value<=g.value,S=!!n.disabled||l.value>=g.value+u.value-1;return{first:n.showFirstLastPage?{icon:s.value?n.lastIcon:n.firstIcon,onClick:F=>v(F,g.value,"first"),disabled:p,"aria-label":i(n.firstAriaLabel),"aria-disabled":p}:void 0,prev:{icon:s.value?n.nextIcon:n.prevIcon,onClick:F=>v(F,l.value-1,"prev"),disabled:p,"aria-label":i(n.previousAriaLabel),"aria-disabled":p},next:{icon:s.value?n.prevIcon:n.nextIcon,onClick:F=>v(F,l.value+1,"next"),disabled:S,"aria-label":i(n.nextAriaLabel),"aria-disabled":S},last:n.showFirstLastPage?{icon:s.value?n.firstIcon:n.lastIcon,onClick:F=>v(F,g.value+u.value-1,"last"),disabled:S,"aria-label":i(n.lastAriaLabel),"aria-disabled":S}:void 0}});function z(){var S;const p=l.value-g.value;(S=b.value[p])==null||S.$el.focus()}function R(p){p.key===Oe.left&&!n.disabled&&l.value>+n.start?(l.value=l.value-1,Be(z)):p.key===Oe.right&&!n.disabled&&l.value<g.value+u.value-1&&(l.value=l.value+1,Be(z))}return ee(()=>w(n.tag,{ref:d,class:["v-pagination",o.value,n.class],style:n.style,role:"navigation","aria-label":i(n.ariaLabel),onKeydown:R,"data-test":"v-pagination-root"},{default:()=>[w("ul",{class:"v-pagination__list"},[n.showFirstLastPage&&w("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[t.first?t.first(k.value.first):w(G,D({_as:"VPaginationBtn"},k.value.first),null)]),w("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[t.prev?t.prev(k.value.prev):w(G,D({_as:"VPaginationBtn"},k.value.prev),null)]),A.value.map((p,S)=>w("li",{key:p.key,class:["v-pagination__item",{"v-pagination__item--is-active":p.isActive}],"data-test":"v-pagination-item"},[t.item?t.item(p):w(G,D({_as:"VPaginationBtn"},p.props),{default:()=>[p.page]})])),w("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[t.next?t.next(k.value.next):w(G,D({_as:"VPaginationBtn"},k.value.next),null)]),n.showFirstLastPage&&w("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[t.last?t.last(k.value.last):w(G,D({_as:"VPaginationBtn"},k.value.last),null)])])]})),{}}}),Pa=_({page:{type:[Number,String],default:1},itemsPerPage:{type:[Number,String],default:10}},"DataTable-paginate"),lt=Symbol.for("vuetify:data-table-pagination");function Aa(n){const e=K(n,"page",void 0,a=>+(a??1)),t=K(n,"itemsPerPage",void 0,a=>+(a??10));return{page:e,itemsPerPage:t}}function Ma(n){const{page:e,itemsPerPage:t,itemsLength:a}=n,l=C(()=>t.value===-1?0:t.value*(e.value-1)),i=C(()=>t.value===-1?a.value:Math.min(a.value,l.value+t.value)),r=C(()=>t.value===-1||a.value===0?1:Math.ceil(a.value/t.value));ke([e,r],()=>{e.value>r.value&&(e.value=r.value)});function s(u){t.value=u,e.value=1}function o(){e.value=we(e.value+1,1,r.value)}function c(){e.value=we(e.value-1,1,r.value)}function h(u){e.value=we(u,1,r.value)}const d={page:e,itemsPerPage:t,startIndex:l,stopIndex:i,pageCount:r,itemsLength:a,nextPage:o,prevPage:c,setPage:h,setItemsPerPage:s};return ae(lt,d),d}function Ta(){const n=te(lt);if(!n)throw new Error("Missing pagination!");return n}function Ia(n){const e=et("usePaginatedItems"),{items:t,startIndex:a,stopIndex:l,itemsPerPage:i}=n,r=C(()=>i.value<=0?t.value:t.value.slice(a.value,l.value));return ke(r,s=>{e.emit("update:currentItems",s)}),{paginatedItems:r}}const it=_({prevIcon:{type:L,default:"$prev"},nextIcon:{type:L,default:"$next"},firstIcon:{type:L,default:"$first"},lastIcon:{type:L,default:"$last"},itemsPerPageText:{type:String,default:"$vuetify.dataFooter.itemsPerPageText"},pageText:{type:String,default:"$vuetify.dataFooter.pageText"},firstPageLabel:{type:String,default:"$vuetify.dataFooter.firstPage"},prevPageLabel:{type:String,default:"$vuetify.dataFooter.prevPage"},nextPageLabel:{type:String,default:"$vuetify.dataFooter.nextPage"},lastPageLabel:{type:String,default:"$vuetify.dataFooter.lastPage"},itemsPerPageOptions:{type:Array,default:()=>[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}]},showCurrentPage:Boolean},"VDataTableFooter"),He=q()({name:"VDataTableFooter",props:it(),setup(n,e){let{slots:t}=e;const{t:a}=Y(),{page:l,pageCount:i,startIndex:r,stopIndex:s,itemsLength:o,itemsPerPage:c,setItemsPerPage:h}=Ta(),d=C(()=>n.itemsPerPageOptions.map(u=>typeof u=="number"?{value:u,title:u===-1?a("$vuetify.dataFooter.itemsPerPageAll"):String(u)}:{...u,title:isNaN(Number(u.title))?a(u.title):u.title}));return ee(()=>{var g;const u=je.filterProps(n);return w("div",{class:"v-data-table-footer"},[(g=t.prepend)==null?void 0:g.call(t),w("div",{class:"v-data-table-footer__items-per-page"},[w("span",null,[a(n.itemsPerPageText)]),w(nt,{items:d.value,modelValue:c.value,"onUpdate:modelValue":m=>h(Number(m)),density:"compact",variant:"outlined","hide-details":!0},null)]),w("div",{class:"v-data-table-footer__info"},[w("div",null,[a(n.pageText,o.value?r.value+1:0,s.value,o.value)])]),w("div",{class:"v-data-table-footer__pagination"},[w(je,D({modelValue:l.value,"onUpdate:modelValue":m=>l.value=m,density:"comfortable","first-aria-label":n.firstPageLabel,"last-aria-label":n.lastPageLabel,length:i.value,"next-aria-label":n.nextPageLabel,"previous-aria-label":n.prevPageLabel,rounded:!0,"show-first-last-page":!0,"total-visible":n.showCurrentPage?1:0,variant:"plain"},u),null)])])}),{}}}),he=aa({align:{type:String,default:"start"},fixed:Boolean,fixedOffset:[Number,String],height:[Number,String],lastFixed:Boolean,noPadding:Boolean,tag:String,width:[Number,String],maxWidth:[Number,String],nowrap:Boolean},(n,e)=>{let{slots:t}=e;const a=n.tag??"td";return w(a,{class:["v-data-table__td",{"v-data-table-column--fixed":n.fixed,"v-data-table-column--last-fixed":n.lastFixed,"v-data-table-column--no-padding":n.noPadding,"v-data-table-column--nowrap":n.nowrap},`v-data-table-column--align-${n.align}`],style:{height:W(n.height),width:W(n.width),maxWidth:W(n.maxWidth),left:W(n.fixedOffset||null)}},{default:()=>{var l;return[(l=t.default)==null?void 0:l.call(t)]}})}),_a=_({headers:Array},"DataTable-header"),st=Symbol.for("vuetify:data-table-headers"),rt={title:"",sortable:!1},Da={...rt,width:48};function $a(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).map(t=>({element:t,priority:0}));return{enqueue:(t,a)=>{let l=!1;for(let i=0;i<e.length;i++)if(e[i].priority>a){e.splice(i,0,{element:t,priority:a}),l=!0;break}l||e.push({element:t,priority:a})},size:()=>e.length,count:()=>{let t=0;if(!e.length)return 0;const a=Math.floor(e[0].priority);for(let l=0;l<e.length;l++)Math.floor(e[l].priority)===a&&(t+=1);return t},dequeue:()=>e.shift()}}function Fe(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(!n.children)e.push(n);else for(const t of n.children)Fe(t,e);return e}function ot(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;for(const t of n)t.key&&e.add(t.key),t.children&&ot(t.children,e);return e}function Oa(n){if(n.key){if(n.key==="data-table-group")return rt;if(["data-table-expand","data-table-select"].includes(n.key))return Da}}function Ae(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return n.children?Math.max(e,...n.children.map(t=>Ae(t,e+1))):e}function Ba(n){let e=!1;function t(i){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i)if(r&&(i.fixed=!0),i.fixed)if(i.children)for(let s=i.children.length-1;s>=0;s--)t(i.children[s],!0);else e?isNaN(+i.width)&&la(`Multiple fixed columns should have a static width (key: ${i.key})`):i.lastFixed=!0,e=!0;else if(i.children)for(let s=i.children.length-1;s>=0;s--)t(i.children[s]);else e=!1}for(let i=n.length-1;i>=0;i--)t(n[i]);function a(i){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!i)return r;if(i.children){i.fixedOffset=r;for(const s of i.children)r=a(s,r)}else i.fixed&&(i.fixedOffset=r,r+=parseFloat(i.width||"0")||0);return r}let l=0;for(const i of n)l=a(i,l)}function Va(n,e){const t=[];let a=0;const l=$a(n);for(;l.size()>0;){let r=l.count();const s=[];let o=1;for(;r>0;){const{element:c,priority:h}=l.dequeue(),d=e-a-Ae(c);if(s.push({...c,rowspan:d??1,colspan:c.children?Fe(c).length:1}),c.children)for(const u of c.children){const g=h%1+o/Math.pow(10,a+2);l.enqueue(u,a+d+g)}o+=1,r-=1}a+=1,t.push(s)}return{columns:n.map(r=>Fe(r)).flat(),headers:t}}function ct(n){const e=[];for(const t of n){const a={...Oa(t),...t},l=a.key??(typeof a.value=="string"?a.value:null),i=a.value??l??null,r={...a,key:l,value:i,sortable:a.sortable??(a.key!=null||!!a.sort),children:a.children?ct(a.children):void 0};e.push(r)}return e}function La(n,e){const t=H([]),a=H([]),l=H({}),i=H({}),r=H({});tt(()=>{var y,f,v;const c=(n.headers||Object.keys(n.items[0]??{}).map(b=>({key:b,title:na(b)}))).slice(),h=ot(c);(y=e==null?void 0:e.groupBy)!=null&&y.value.length&&!h.has("data-table-group")&&c.unshift({key:"data-table-group",title:"Group"}),(f=e==null?void 0:e.showSelect)!=null&&f.value&&!h.has("data-table-select")&&c.unshift({key:"data-table-select"}),(v=e==null?void 0:e.showExpand)!=null&&v.value&&!h.has("data-table-expand")&&c.push({key:"data-table-expand"});const d=ct(c);Ba(d);const u=Math.max(...d.map(b=>Ae(b)))+1,g=Va(d,u);t.value=g.headers,a.value=g.columns;const m=g.headers.flat(1);for(const b of m)b.key&&(b.sortable&&(b.sort&&(l.value[b.key]=b.sort),b.sortRaw&&(i.value[b.key]=b.sortRaw)),b.filter&&(r.value[b.key]=b.filter))});const s={headers:t,columns:a,sortFunctions:l,sortRawFunctions:i,filterFunctions:r};return ae(st,s),s}function ge(){const n=te(st);if(!n)throw new Error("Missing headers!");return n}const za={showSelectAll:!1,allSelected:()=>[],select:n=>{var a;let{items:e,value:t}=n;return new Set(t?[(a=e[0])==null?void 0:a.value]:[])},selectAll:n=>{let{selected:e}=n;return e}},ut={showSelectAll:!0,allSelected:n=>{let{currentPage:e}=n;return e},select:n=>{let{items:e,value:t,selected:a}=n;for(const l of e)t?a.add(l.value):a.delete(l.value);return a},selectAll:n=>{let{value:e,currentPage:t,selected:a}=n;return ut.select({items:t,value:e,selected:a})}},dt={showSelectAll:!0,allSelected:n=>{let{allItems:e}=n;return e},select:n=>{let{items:e,value:t,selected:a}=n;for(const l of e)t?a.add(l.value):a.delete(l.value);return a},selectAll:n=>{let{value:e,allItems:t,selected:a}=n;return dt.select({items:t,value:e,selected:a})}},Ea=_({showSelect:Boolean,selectStrategy:{type:[String,Object],default:"page"},modelValue:{type:Array,default:()=>[]},valueComparator:{type:Function,default:at}},"DataTable-select"),ft=Symbol.for("vuetify:data-table-selection");function Ra(n,e){let{allItems:t,currentPage:a}=e;const l=K(n,"modelValue",n.modelValue,v=>new Set(re(v).map(b=>{var x;return((x=t.value.find(A=>n.valueComparator(b,A.value)))==null?void 0:x.value)??b})),v=>[...v.values()]),i=C(()=>t.value.filter(v=>v.selectable)),r=C(()=>a.value.filter(v=>v.selectable)),s=C(()=>{if(typeof n.selectStrategy=="object")return n.selectStrategy;switch(n.selectStrategy){case"single":return za;case"all":return dt;case"page":default:return ut}});function o(v){return re(v).every(b=>l.value.has(b.value))}function c(v){return re(v).some(b=>l.value.has(b.value))}function h(v,b){const x=s.value.select({items:v,value:b,selected:new Set(l.value)});l.value=x}function d(v){h([v],!o([v]))}function u(v){const b=s.value.selectAll({value:v,allItems:i.value,currentPage:r.value,selected:new Set(l.value)});l.value=b}const g=C(()=>l.value.size>0),m=C(()=>{const v=s.value.allSelected({allItems:i.value,currentPage:r.value});return!!v.length&&o(v)}),y=C(()=>s.value.showSelectAll),f={toggleSelect:d,select:h,selectAll:u,isSelected:o,isSomeSelected:c,someSelected:g,allSelected:m,showSelectAll:y};return ae(ft,f),f}function ve(){const n=te(ft);if(!n)throw new Error("Missing selection!");return n}const Na=_({sortBy:{type:Array,default:()=>[]},customKeySort:Object,multiSort:Boolean,mustSort:Boolean},"DataTable-sort"),ht=Symbol.for("vuetify:data-table-sort");function ja(n){const e=K(n,"sortBy"),t=I(n,"mustSort"),a=I(n,"multiSort");return{sortBy:e,mustSort:t,multiSort:a}}function Ha(n){const{sortBy:e,mustSort:t,multiSort:a,page:l}=n,i=o=>{if(o.key==null)return;let c=e.value.map(d=>({...d}))??[];const h=c.find(d=>d.key===o.key);h?h.order==="desc"?t.value?h.order="asc":c=c.filter(d=>d.key!==o.key):h.order="desc":a.value?c=[...c,{key:o.key,order:"asc"}]:c=[{key:o.key,order:"asc"}],e.value=c,l&&(l.value=1)};function r(o){return!!e.value.find(c=>c.key===o.key)}const s={sortBy:e,toggleSort:i,isSorted:r};return ae(ht,s),s}function mt(){const n=te(ht);if(!n)throw new Error("Missing sort!");return n}function Ua(n,e,t,a){const l=Y();return{sortedItems:C(()=>{var r,s;return t.value.length?Ga(e.value,t.value,l.current.value,{transform:a==null?void 0:a.transform,sortFunctions:{...n.customKeySort,...(r=a==null?void 0:a.sortFunctions)==null?void 0:r.value},sortRawFunctions:(s=a==null?void 0:a.sortRawFunctions)==null?void 0:s.value}):e.value})}}function Ga(n,e,t,a){const l=new Intl.Collator(t,{sensitivity:"accent",usage:"sort"});return n.map(r=>[r,a!=null&&a.transform?a.transform(r):r]).sort((r,s)=>{var o,c;for(let h=0;h<e.length;h++){let d=!1;const u=e[h].key,g=e[h].order??"asc";if(g===!1)continue;let m=fe(r[1],u),y=fe(s[1],u),f=r[0].raw,v=s[0].raw;if(g==="desc"&&([m,y]=[y,m],[f,v]=[v,f]),(o=a==null?void 0:a.sortRawFunctions)!=null&&o[u]){const b=a.sortRawFunctions[u](f,v);if(b==null)continue;if(d=!0,b)return b}if((c=a==null?void 0:a.sortFunctions)!=null&&c[u]){const b=a.sortFunctions[u](m,y);if(b==null)continue;if(d=!0,b)return b}if(!d){if(m instanceof Date&&y instanceof Date)return m.getTime()-y.getTime();if([m,y]=[m,y].map(b=>b!=null?b.toString().toLocaleLowerCase():b),m!==y)return ue(m)&&ue(y)?0:ue(m)?-1:ue(y)?1:!isNaN(m)&&!isNaN(y)?Number(m)-Number(y):l.compare(m,y)}}return 0}).map(r=>{let[s]=r;return s})}const gt=_({color:String,sticky:Boolean,disableSort:Boolean,multiSort:Boolean,sortAscIcon:{type:L,default:"$sortAsc"},sortDescIcon:{type:L,default:"$sortDesc"},headerProps:{type:Object},...Ce(),...oa()},"VDataTableHeaders"),Ue=q()({name:"VDataTableHeaders",props:gt(),setup(n,e){let{slots:t}=e;const{t:a}=Y(),{toggleSort:l,sortBy:i,isSorted:r}=mt(),{someSelected:s,allSelected:o,selectAll:c,showSelectAll:h}=ve(),{columns:d,headers:u}=ge(),{loaderClasses:g}=ia(n);function m(p,S){if(!(!n.sticky&&!p.fixed))return{position:"sticky",left:p.fixed?W(p.fixedOffset):void 0,top:n.sticky?`calc(var(--v-table-header-height) * ${S})`:void 0}}function y(p){const S=i.value.find(F=>F.key===p.key);return S?S.order==="asc"?n.sortAscIcon:n.sortDescIcon:n.sortAscIcon}const{backgroundColorClasses:f,backgroundColorStyles:v}=sa(n,"color"),{displayClasses:b,mobile:x}=me(n),A=C(()=>({headers:u.value,columns:d.value,toggleSort:l,isSorted:r,sortBy:i.value,someSelected:s.value,allSelected:o.value,selectAll:c,getSortIcon:y})),k=C(()=>["v-data-table__th",{"v-data-table__th--sticky":n.sticky},b.value,g.value]),z=p=>{let{column:S,x:F,y:P}=p;const M=S.key==="data-table-select"||S.key==="data-table-expand",$=D(n.headerProps??{},S.headerProps??{});return w(he,D({tag:"th",align:S.align,class:[{"v-data-table__th--sortable":S.sortable&&!n.disableSort,"v-data-table__th--sorted":r(S),"v-data-table__th--fixed":S.fixed},...k.value],style:{width:W(S.width),minWidth:W(S.minWidth),maxWidth:W(S.maxWidth),...m(S,P)},colspan:S.colspan,rowspan:S.rowspan,onClick:S.sortable?()=>l(S):void 0,fixed:S.fixed,nowrap:S.nowrap,lastFixed:S.lastFixed,noPadding:M},$),{default:()=>{var J;const Q=`header.${S.key}`,oe={column:S,selectAll:c,isSorted:r,toggleSort:l,sortBy:i.value,someSelected:s.value,allSelected:o.value,getSortIcon:y};return t[Q]?t[Q](oe):S.key==="data-table-select"?((J=t["header.data-table-select"])==null?void 0:J.call(t,oe))??(h.value&&w(Pe,{modelValue:o.value,indeterminate:s.value&&!o.value,"onUpdate:modelValue":c},null)):w("div",{class:"v-data-table-header__content"},[w("span",null,[S.title]),S.sortable&&!n.disableSort&&w(pe,{key:"icon",class:"v-data-table-header__sort-icon",icon:y(S)},null),n.multiSort&&r(S)&&w("div",{key:"badge",class:["v-data-table-header__sort-badge",...f.value],style:v.value},[i.value.findIndex(ne=>ne.key===S.key)+1])])}})},R=()=>{const p=D(n.headerProps??{}??{}),S=C(()=>d.value.filter(P=>(P==null?void 0:P.sortable)&&!n.disableSort)),F=C(()=>{if(d.value.find(M=>M.key==="data-table-select")!=null)return o.value?"$checkboxOn":s.value?"$checkboxIndeterminate":"$checkboxOff"});return w(he,D({tag:"th",class:[...k.value],colspan:u.value.length+1},p),{default:()=>[w("div",{class:"v-data-table-header__content"},[w(nt,{chips:!0,class:"v-data-table__td-sort-select",clearable:!0,density:"default",items:S.value,label:a("$vuetify.dataTable.sortBy"),multiple:n.multiSort,variant:"underlined","onClick:clear":()=>i.value=[],appendIcon:F.value,"onClick:append":()=>c(!o.value)},{...t,chip:P=>{var M;return w(da,{onClick:(M=P.item.raw)!=null&&M.sortable?()=>l(P.item.raw):void 0,onMousedown:$=>{$.preventDefault(),$.stopPropagation()}},{default:()=>[P.item.title,w(pe,{class:["v-data-table__td-sort-icon",r(P.item.raw)&&"v-data-table__td-sort-icon-active"],icon:y(P.item.raw),size:"small"},null)]})}})])]})};ee(()=>x.value?w("tr",null,[w(R,null,null)]):w(X,null,[t.headers?t.headers(A.value):u.value.map((p,S)=>w("tr",null,[p.map((F,P)=>w(z,{column:F,x:P,y:S},null))])),n.loading&&w("tr",{class:"v-data-table-progress"},[w("th",{colspan:d.value.length},[w(ra,{name:"v-data-table-progress",absolute:!0,active:!0,color:typeof n.loading=="boolean"?void 0:n.loading,indeterminate:!0},{default:t.loader})])])]))}}),Wa=_({groupBy:{type:Array,default:()=>[]}},"DataTable-group"),vt=Symbol.for("vuetify:data-table-group");function Ka(n){return{groupBy:K(n,"groupBy")}}function qa(n){const{disableSort:e,groupBy:t,sortBy:a}=n,l=H(new Set),i=C(()=>t.value.map(h=>({...h,order:h.order??!1})).concat(e!=null&&e.value?[]:a.value));function r(h){return l.value.has(h.id)}function s(h){const d=new Set(l.value);r(h)?d.delete(h.id):d.add(h.id),l.value=d}function o(h){function d(u){const g=[];for(const m of u.items)"type"in m&&m.type==="group"?g.push(...d(m)):g.push(m);return g}return d({items:h})}const c={sortByWithGroups:i,toggleGroup:s,opened:l,groupBy:t,extractRows:o,isGroupOpen:r};return ae(vt,c),c}function wt(){const n=te(vt);if(!n)throw new Error("Missing group!");return n}function Qa(n,e){if(!n.length)return[];const t=new Map;for(const a of n){const l=fe(a.raw,e);t.has(l)||t.set(l,[]),t.get(l).push(a)}return t}function yt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"root";if(!e.length)return[];const l=Qa(n,e[0]),i=[],r=e.slice(1);return l.forEach((s,o)=>{const c=e[0],h=`${a}_${c}_${o}`;i.push({depth:t,id:h,key:c,value:o,items:r.length?yt(s,r,t+1,h):s,type:"group"})}),i}function bt(n,e){const t=[];for(const a of n)"type"in a&&a.type==="group"?(a.value!=null&&t.push(a),(e.has(a.id)||a.value==null)&&t.push(...bt(a.items,e))):t.push(a);return t}function Za(n,e,t){return{flatItems:C(()=>{if(!e.value.length)return n.value;const l=yt(n.value,e.value.map(i=>i.key));return bt(l,t.value)})}}const Ja=_({item:{type:Object,required:!0}},"VDataTableGroupHeaderRow"),Xa=q()({name:"VDataTableGroupHeaderRow",props:Ja(),setup(n,e){let{slots:t}=e;const{isGroupOpen:a,toggleGroup:l,extractRows:i}=wt(),{isSelected:r,isSomeSelected:s,select:o}=ve(),{columns:c}=ge(),h=C(()=>i([n.item]));return()=>w("tr",{class:"v-data-table-group-header-row",style:{"--v-data-table-group-header-row-depth":n.item.depth}},[c.value.map(d=>{var u,g;if(d.key==="data-table-group"){const m=a(n.item)?"$expand":"$next",y=()=>l(n.item);return((u=t["data-table-group"])==null?void 0:u.call(t,{item:n.item,count:h.value.length,props:{icon:m,onClick:y}}))??w(he,{class:"v-data-table-group-header-row__column"},{default:()=>[w(G,{size:"small",variant:"text",icon:m,onClick:y},null),w("span",null,[n.item.value]),w("span",null,[Ve("("),h.value.length,Ve(")")])]})}if(d.key==="data-table-select"){const m=r(h.value),y=s(h.value)&&!m,f=v=>o(h.value,v);return((g=t["data-table-select"])==null?void 0:g.call(t,{props:{modelValue:m,indeterminate:y,"onUpdate:modelValue":f}}))??w("td",null,[w(Pe,{modelValue:m,indeterminate:y,"onUpdate:modelValue":f},null)])}return w("td",null,null)})])}}),Ya=_({expandOnClick:Boolean,showExpand:Boolean,expanded:{type:Array,default:()=>[]}},"DataTable-expand"),St=Symbol.for("vuetify:datatable:expanded");function en(n){const e=I(n,"expandOnClick"),t=K(n,"expanded",n.expanded,s=>new Set(s),s=>[...s.values()]);function a(s,o){const c=new Set(t.value);o?c.add(s.value):c.delete(s.value),t.value=c}function l(s){return t.value.has(s.value)}function i(s){a(s,!l(s))}const r={expand:a,expanded:t,expandOnClick:e,isExpanded:l,toggleExpand:i};return ae(St,r),r}function pt(){const n=te(St);if(!n)throw new Error("foo");return n}const tn=_({index:Number,item:Object,cellProps:[Object,Function],onClick:ye(),onContextmenu:ye(),onDblclick:ye(),...Ce()},"VDataTableRow"),an=q()({name:"VDataTableRow",props:tn(),setup(n,e){let{slots:t}=e;const{displayClasses:a,mobile:l}=me(n,"v-data-table__tr"),{isSelected:i,toggleSelect:r,someSelected:s,allSelected:o,selectAll:c}=ve(),{isExpanded:h,toggleExpand:d}=pt(),{toggleSort:u,sortBy:g,isSorted:m}=mt(),{columns:y}=ge();ee(()=>w("tr",{class:["v-data-table__tr",{"v-data-table__tr--clickable":!!(n.onClick||n.onContextmenu||n.onDblclick)},a.value],onClick:n.onClick,onContextmenu:n.onContextmenu,onDblclick:n.onDblclick},[n.item&&y.value.map((f,v)=>{const b=n.item,x=`item.${f.key}`,A=`header.${f.key}`,k={index:n.index,item:b.raw,internalItem:b,value:fe(b.columns,f.key),column:f,isSelected:i,toggleSelect:r,isExpanded:h,toggleExpand:d},z={column:f,selectAll:c,isSorted:m,toggleSort:u,sortBy:g.value,someSelected:s.value,allSelected:o.value,getSortIcon:()=>""},R=typeof n.cellProps=="function"?n.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value,column:f}):n.cellProps,p=typeof f.cellProps=="function"?f.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value}):f.cellProps;return w(he,D({align:f.align,class:{"v-data-table__td--expanded-row":f.key==="data-table-expand","v-data-table__td--select-row":f.key==="data-table-select"},fixed:f.fixed,fixedOffset:f.fixedOffset,lastFixed:f.lastFixed,maxWidth:l.value?void 0:f.maxWidth,noPadding:f.key==="data-table-select"||f.key==="data-table-expand",nowrap:f.nowrap,width:l.value?void 0:f.width},R,p),{default:()=>{var F,P,M,$,Q;if(t[x]&&!l.value)return(F=t[x])==null?void 0:F.call(t,k);if(f.key==="data-table-select")return((P=t["item.data-table-select"])==null?void 0:P.call(t,k))??w(Pe,{disabled:!b.selectable,modelValue:i([b]),onClick:Le(()=>r(b),["stop"])},null);if(f.key==="data-table-expand")return((M=t["item.data-table-expand"])==null?void 0:M.call(t,k))??w(G,{icon:h(b)?"$collapse":"$expand",size:"small",variant:"text",onClick:Le(()=>d(b),["stop"])},null);const S=ca(k.value);return l.value?w(X,null,[w("div",{class:"v-data-table__td-title"},[(($=t[A])==null?void 0:$.call(t,z))??f.title]),w("div",{class:"v-data-table__td-value"},[((Q=t[x])==null?void 0:Q.call(t,k))??S])]):S}})})]))}}),xt=_({loading:[Boolean,String],loadingText:{type:String,default:"$vuetify.dataIterator.loadingText"},hideNoData:Boolean,items:{type:Array,default:()=>[]},noDataText:{type:String,default:"$vuetify.noDataText"},rowProps:[Object,Function],cellProps:[Object,Function],...Ce()},"VDataTableRows"),Ge=q()({name:"VDataTableRows",inheritAttrs:!1,props:xt(),setup(n,e){let{attrs:t,slots:a}=e;const{columns:l}=ge(),{expandOnClick:i,toggleExpand:r,isExpanded:s}=pt(),{isSelected:o,toggleSelect:c}=ve(),{toggleGroup:h,isGroupOpen:d}=wt(),{t:u}=Y(),{mobile:g}=me(n);return ee(()=>{var m,y;return n.loading&&(!n.items.length||a.loading)?w("tr",{class:"v-data-table-rows-loading",key:"loading"},[w("td",{colspan:l.value.length},[((m=a.loading)==null?void 0:m.call(a))??u(n.loadingText)])]):!n.loading&&!n.items.length&&!n.hideNoData?w("tr",{class:"v-data-table-rows-no-data",key:"no-data"},[w("td",{colspan:l.value.length},[((y=a["no-data"])==null?void 0:y.call(a))??u(n.noDataText)])]):w(X,null,[n.items.map((f,v)=>{var A;if(f.type==="group"){const k={index:v,item:f,columns:l.value,isExpanded:s,toggleExpand:r,isSelected:o,toggleSelect:c,toggleGroup:h,isGroupOpen:d};return a["group-header"]?a["group-header"](k):w(Xa,D({key:`group-header_${f.id}`,item:f},Ee(t,":group-header",()=>k)),a)}const b={index:v,item:f.raw,internalItem:f,columns:l.value,isExpanded:s,toggleExpand:r,isSelected:o,toggleSelect:c},x={...b,props:D({key:`item_${f.key??f.index}`,onClick:i.value?()=>{r(f)}:void 0,index:v,item:f,cellProps:n.cellProps,mobile:g.value},Ee(t,":row",()=>b),typeof n.rowProps=="function"?n.rowProps({item:b.item,index:b.index,internalItem:b.internalItem}):n.rowProps)};return w(X,{key:x.props.key},[a.item?a.item(x):w(an,x.props,a),s(f)&&((A=a["expanded-row"])==null?void 0:A.call(a,b))])})])}),{}}}),nn=_({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},rowProps:[Object,Function],cellProps:[Object,Function],returnObject:Boolean},"DataTable-items");function ln(n,e,t,a){const l=n.returnObject?e:se(e,n.itemValue),i=se(e,n.itemSelectable,!0),r=a.reduce((s,o)=>(o.key!=null&&(s[o.key]=se(e,o.value)),s),{});return{type:"item",key:n.returnObject?se(e,n.itemValue):l,index:t,value:l,selectable:i,columns:r,raw:e}}function sn(n,e,t){return e.map((a,l)=>ln(n,a,l,t))}function rn(n,e){return{items:C(()=>sn(n,n.items,e.value))}}function on(n){let{page:e,itemsPerPage:t,sortBy:a,groupBy:l,search:i}=n;const r=et("VDataTable"),s=C(()=>({page:e.value,itemsPerPage:t.value,sortBy:a.value,groupBy:l.value,search:i.value}));let o=null;ke(s,()=>{at(o,s.value)||(o&&o.search!==s.value.search&&(e.value=1),r.emit("update:options",s.value),o=s.value)},{deep:!0,immediate:!0})}const cn=(n,e,t)=>n==null||e==null?-1:n.toString().toLocaleLowerCase().indexOf(e.toString().toLocaleLowerCase()),un=_({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function dn(n,e,t){var s;const a=[],l=(t==null?void 0:t.default)??cn,i=t!=null&&t.filterKeys?re(t.filterKeys):!1,r=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(n!=null&&n.length))return a;e:for(let o=0;o<n.length;o++){const[c,h=c]=re(n[o]),d={},u={};let g=-1;if((e||r>0)&&!(t!=null&&t.noFilter)){if(typeof c=="object"){const f=i||Object.keys(h);for(const v of f){const b=se(h,v),x=(s=t==null?void 0:t.customKeyFilter)==null?void 0:s[v];if(g=x?x(b,e,c):l(b,e,c),g!==-1&&g!==!1)x?d[v]=g:u[v]=g;else if((t==null?void 0:t.filterMode)==="every")continue e}}else g=l(c,e,c),g!==-1&&g!==!1&&(u.title=g);const m=Object.keys(u).length,y=Object.keys(d).length;if(!m&&!y||(t==null?void 0:t.filterMode)==="union"&&y!==r&&!m||(t==null?void 0:t.filterMode)==="intersection"&&(y!==r||!m))continue}a.push({index:o,matches:{...u,...d}})}return a}function fn(n,e,t,a){const l=H([]),i=H(new Map),r=C(()=>a!=null&&a.transform?ie(e).map(o=>[o,a.transform(o)]):ie(e));tt(()=>{const o=typeof t=="function"?t():ie(t),c=typeof o!="string"&&typeof o!="number"?"":String(o),h=dn(r.value,c,{customKeyFilter:{...n.customKeyFilter,...ie(a==null?void 0:a.customKeyFilter)},default:n.customFilter,filterKeys:n.filterKeys,filterMode:n.filterMode,noFilter:n.noFilter}),d=ie(e),u=[],g=new Map;h.forEach(m=>{let{index:y,matches:f}=m;const v=d[y];u.push(v),g.set(v.value,f)}),l.value=u,i.value=g});function s(o){return i.value.get(o.value)}return{filteredItems:l,filteredMatches:i,getMatches:s}}const hn=_({...xt(),hideDefaultBody:Boolean,hideDefaultFooter:Boolean,hideDefaultHeader:Boolean,width:[String,Number],search:String,...Ya(),...Wa(),..._a(),...nn(),...Ea(),...Na(),...gt(),...ha()},"DataTable"),mn=_({...Pa(),...hn(),...un(),...it()},"VDataTable"),Pn=q()({name:"VDataTable",props:mn(),emits:{"update:modelValue":n=>!0,"update:page":n=>!0,"update:itemsPerPage":n=>!0,"update:sortBy":n=>!0,"update:options":n=>!0,"update:groupBy":n=>!0,"update:expanded":n=>!0,"update:currentItems":n=>!0},setup(n,e){let{attrs:t,slots:a}=e;const{groupBy:l}=Ka(n),{sortBy:i,multiSort:r,mustSort:s}=ja(n),{page:o,itemsPerPage:c}=Aa(n),{disableSort:h}=ua(n),{columns:d,headers:u,sortFunctions:g,sortRawFunctions:m,filterFunctions:y}=La(n,{groupBy:l,showSelect:I(n,"showSelect"),showExpand:I(n,"showExpand")}),{items:f}=rn(n,d),v=I(n,"search"),{filteredItems:b}=fn(n,f,v,{transform:U=>U.columns,customKeyFilter:y}),{toggleSort:x}=Ha({sortBy:i,multiSort:r,mustSort:s,page:o}),{sortByWithGroups:A,opened:k,extractRows:z,isGroupOpen:R,toggleGroup:p}=qa({groupBy:l,sortBy:i,disableSort:h}),{sortedItems:S}=Ua(n,b,A,{transform:U=>({...U.raw,...U.columns}),sortFunctions:g,sortRawFunctions:m}),{flatItems:F}=Za(S,l,k),P=C(()=>F.value.length),{startIndex:M,stopIndex:$,pageCount:Q,setItemsPerPage:oe}=Ma({page:o,itemsPerPage:c,itemsLength:P}),{paginatedItems:J}=Ia({items:F,startIndex:M,stopIndex:$,itemsPerPage:c}),ne=C(()=>z(J.value)),{isSelected:Ft,select:kt,selectAll:Ct,toggleSelect:Pt,someSelected:At,allSelected:Mt}=Ra(n,{allItems:f,currentPage:ne}),{isExpanded:Tt,toggleExpand:It}=en(n);on({page:o,itemsPerPage:c,sortBy:i,groupBy:l,search:v}),xe({VDataTableRows:{hideNoData:I(n,"hideNoData"),noDataText:I(n,"noDataText"),loading:I(n,"loading"),loadingText:I(n,"loadingText")}});const E=C(()=>({page:o.value,itemsPerPage:c.value,sortBy:i.value,pageCount:Q.value,toggleSort:x,setItemsPerPage:oe,someSelected:At.value,allSelected:Mt.value,isSelected:Ft,select:kt,selectAll:Ct,toggleSelect:Pt,isExpanded:Tt,toggleExpand:It,isGroupOpen:R,toggleGroup:p,items:ne.value.map(U=>U.raw),internalItems:ne.value,groupedItems:J.value,columns:d.value,headers:u.value}));return ee(()=>{const U=He.filterProps(n),_t=Ue.filterProps(n),Dt=Ge.filterProps(n),$t=ze.filterProps(n);return w(ze,D({class:["v-data-table",{"v-data-table--show-select":n.showSelect,"v-data-table--loading":n.loading},n.class],style:n.style},$t),{top:()=>{var le;return(le=a.top)==null?void 0:le.call(a,E.value)},default:()=>{var le,Me,Te,Ie,_e,De;return a.default?a.default(E.value):w(X,null,[(le=a.colgroup)==null?void 0:le.call(a,E.value),!n.hideDefaultHeader&&w("thead",{key:"thead"},[w(Ue,_t,a)]),(Me=a.thead)==null?void 0:Me.call(a,E.value),!n.hideDefaultBody&&w("tbody",null,[(Te=a["body.prepend"])==null?void 0:Te.call(a,E.value),a.body?a.body(E.value):w(Ge,D(t,Dt,{items:J.value}),a),(Ie=a["body.append"])==null?void 0:Ie.call(a,E.value)]),(_e=a.tbody)==null?void 0:_e.call(a,E.value),(De=a.tfoot)==null?void 0:De.call(a,E.value)])},bottom:()=>a.bottom?a.bottom(E.value):!n.hideDefaultFooter&&w(X,null,[w(fa,null,null),w(He,U,{prepend:a["footer.prepend"]})])})}),{}}});export{Pn as V,Z as a,kn as b,je as c,Cn as d,xn as e,Fn as m};
