var $t=Object.defineProperty;var Lt=(a,t,e)=>t in a?$t(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var $=(a,t,e)=>Lt(a,typeof t!="symbol"?t+"":t,e);import{I as T}from"./IDB-CUIdphEQ.js";import{c as Bt}from"./VAvatar-Bure-jDt.js";import{b4 as Ot,z as q,ar as K,c as P,D as We,aL as zt,b2 as Et,B as Rt,C as Nt,b5 as jt,aK as Ht,aq as Ut,al as Gt,t as A,E as Y,g as b,aR as Wt,av as Se,aE as Ve,V as G,I as D,J as M,aT as Ke,K as qe,ab as Qe,ai as Je,aU as Kt,aV as qt,L as Ze,M as Qt,b3 as Xe,ac as Ye,b6 as z,r as H,b7 as Jt,af as Zt,b8 as me,ag as Xt,aD as xe,b9 as Yt,ah as ce,H as ee,am as $e,aN as Le,ba as ea,aF as ta,e as Pe,ae as be,bb as et,ak as te,aj as ae,bc as aa,an as W,w as tt,a9 as na,bd as sa,G as re,be as at,bf as fe,bg as ue,bh as ia,A as la,bi as ra,F as X,bj as oa,bk as Fe,j as Be,aB as Oe,k as ca,bl as ye,bm as le,m as ie,x as ua}from"./index-DGANnDqU.js";import{V as nt,f as da,e as fa}from"./VSelect-PlSDLsrv.js";import{V as Ce}from"./VCheckboxBtn-DQQ-4u1L.js";import{V as ze,m as ha}from"./VTable-Cvf9BfXf.js";function Ee(a,t,e){return Object.keys(a).filter(n=>Ot(n)&&n.endsWith(t)).reduce((n,s)=>(n[s.slice(0,-t.length)]=i=>a[s](i,e(i)),n),{})}class ma{parse(t){const e=t.split(`
`).map(r=>r.trim()),n=this.extractValue(e,"xmin"),s=this.extractValue(e,"xmax"),i=[];let l=0;for(;l<e.length&&!e[l].includes("item []:");)l++;for(;l<e.length;){const r=e.findIndex((u,m)=>m>=l&&u.includes("item [")&&u.includes("]:"));if(r===-1)break;l=r+1;const o=e.findIndex((u,m)=>m>=l&&u.includes("name ="));if(o===-1)continue;const c=this.extractQuotedValue(e[o]),f=e.findIndex((u,m)=>m>=l&&u.includes("intervals: size ="));if(f===-1)continue;const h=[];for(l=f+1;l<e.length;){const u=e.findIndex((d,v)=>v>=l&&d.includes("intervals [")&&d.includes("]:"));if(u===-1||e[u+1]&&e[u+1].includes("item ["))break;l=u+1;const m=e.findIndex((d,v)=>v>=l&&v<l+10&&d.includes("xmin =")),g=e.findIndex((d,v)=>v>=l&&v<l+10&&d.includes("xmax =")),w=e.findIndex((d,v)=>v>=l&&v<l+10&&d.includes("text ="));if(m!==-1&&g!==-1&&w!==-1){const d={xmin:parseFloat(e[m].split("=")[1].trim()),xmax:parseFloat(e[g].split("=")[1].trim()),text:this.extractQuotedValue(e[w])},v=d.text.match(/^\s*\((\d+)\)/);v&&(d.utteranceNumber=parseInt(v[1])),h.push(d)}l=Math.max(m,g,w)+1}c&&i.push({name:c,intervals:h})}return{xmin:n,xmax:s,tiers:i}}extractUtteranceTimings(t){const e=new Map,n=t.tiers.find(i=>i.name==="SENT");if(!n)return e;let s=0;for(const i of n.intervals)!i.text||i.text.trim()===""||(s++,e.set(s,{start:i.xmin,end:i.xmax}));return e}extractValue(t,e){const n=t.find(s=>s.startsWith(e+" ="));return n?parseFloat(n.split("=")[1].trim()):0}extractQuotedValue(t){const e=t.match(/"([^"]*)"/);return e?e[1]:""}}const de=new ma,B="masc-corpus",j="metadata",we="folder-handle",pe="cache-version",Re="2.1";class ga{constructor(){$(this,"isInitialized",!1);$(this,"initializationPromise",null);$(this,"folderHandle",null);$(this,"metadataCache",null);$(this,"basePath","");$(this,"onlineService",null);$(this,"isOnlineMode",!1)}async checkCacheVersion(){return await T.get(B,j,pe)===Re}async setCacheVersion(){await T.set(B,j,pe,Re)}async requestFolderAccess(){try{return this.folderHandle=await window.showDirectoryPicker({mode:"read",startIn:"downloads"}),await T.set(B,we,"handle",this.folderHandle),await this.processMetadata(),await this.setCacheVersion(),this.isInitialized=!0,!0}catch{return!1}}async loadFolderHandle(){try{const t=await T.get(B,we,"handle");if(!t)return!1;this.folderHandle=t;const e=await this.folderHandle.queryPermission({mode:"read"});return e==="granted"?!0:e==="prompt"?await this.folderHandle.requestPermission({mode:"read"})==="granted":!1}catch{return!1}}async getFileFromFolder(t){if(!this.folderHandle)return null;try{const e=t.split("/");let n=this.folderHandle;for(let l=0;l<e.length-1;l++)e[l]&&(n=await n.getDirectoryHandle(e[l]));const s=e[e.length-1];return await(await n.getFileHandle(s)).getFile()}catch{return null}}async detectFolderStructure(){if(await this.getFileFromFolder("MASC_metadata.csv"))this.basePath="";else if(await this.getFileFromFolder("MASC_v1.0/MASC_metadata.csv"))this.basePath="MASC_v1.0/";else throw new Error("Could not find MASC_metadata.csv. Please select the MASC_v1.0 folder.")}async processMetadata(){await this.detectFolderStructure();const t=await this.getFileFromFolder(this.basePath+"MASC_metadata.csv");if(!t)throw new Error("Could not find MASC_metadata.csv");const e=await t.text(),n=this.parseMetadata(e);await T.set(B,j,"speakers",n),await T.set(B,j,"basePath",this.basePath),this.metadataCache=n}parseMetadata(t){var s;const e=t.split(`
`).filter(i=>i.trim()),n=[];for(let i=1;i<e.length;i++){const l=e[i].split(";");l.length>=11&&n.push({serialNumber:parseInt(l[0])||0,textId:((s=l[1])==null?void 0:s.trim())||"",tokens:parseInt(l[2])||0,types:parseInt(l[3])||0,speakerName:l[4]||"",speakerId:l[5]||"",gender:l[6]||"M",age:parseInt(l[7])||0,occupation:l[8]||"",title:l[9]||"",textType:l[10]||""})}return n}async initialize(){if(!this.isInitialized)return this.initializationPromise?this.initializationPromise:(this.initializationPromise=(async()=>{await this.checkCacheVersion()&&(await this.loadFolderHandle()?(this.metadataCache=await T.get(B,j,"speakers"),this.basePath=await T.get(B,j,"basePath")||"",this.isInitialized=!0):await this.clearCache())})(),this.initializationPromise)}async setOnlineMode(t){this.onlineService=t,this.isOnlineMode=!0,this.isInitialized=!0,this.metadataCache=null}async isDataLoaded(){return this.isOnlineMode&&this.onlineService?await this.onlineService.isDataReady():(await this.initialize(),this.isInitialized)}async getMetadata(){if(this.isOnlineMode){const e=await T.get(B,j,"speakers");return e?(this.metadataCache=e,e):[]}if(await this.initialize(),this.metadataCache)return this.metadataCache;const t=await T.get(B,j,"speakers");return t&&(this.metadataCache=t),t||[]}async getTranscription(t,e=!1){if(this.isOnlineMode&&this.onlineService){const l=`${e?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions"}/${t}.txt`,r=await this.onlineService.getTextContent(l);return r?r.charCodeAt(0)===65279||r.startsWith("\uFEFF")?r.substring(1):r:""}if(await this.initialize(),!this.folderHandle)return"";const n=e?"02_MASC_lemmatized_transcriptions":"01_MASC_transcriptions",s=await this.getFileFromFolder(`${this.basePath}${n}/${t}.txt`);if(s){let i=await s.text();return(i.charCodeAt(0)===65279||i.startsWith("\uFEFF"))&&(i=i.substring(1)),i}return""}async getAudioBlob(t){if(this.isOnlineMode&&this.onlineService){const n=`03a_MASC_audio_files/denoised/${t}.mp3`;return await this.onlineService.getFile(n)}return await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}03a_MASC_audio_files/denoised/${t}.mp3`):null}async getTextGrid(t){if(this.isOnlineMode&&this.onlineService){const n=`03b_MASC_textgrid_files/${t}.TextGrid`;return await this.onlineService.getTextContent(n)||""}if(await this.initialize(),!this.folderHandle)return"";const e=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${t}.TextGrid`);return e?await e.text():""}createAudioUrl(t){return URL.createObjectURL(t)}async searchTranscriptions(t,e=!1){if(await this.initialize(),!this.isInitialized)return[];const n=await this.getMetadata(),s=[];for(const i of n){const l=await this.getTranscription(i.textId,e);if(l&&l.toLowerCase().includes(t.toLowerCase())){const o=l.split(`
`).filter(c=>c.trim()).filter(c=>c.toLowerCase().includes(t.toLowerCase()));s.push({textId:i.textId,speaker:i,matches:o.slice(0,3)})}}return s}async getSpeakerTexts(t){return(await this.getMetadata()).filter(n=>n.speakerId===t)}async getTextsBySpeakerAttributes(t){return(await this.getMetadata()).filter(n=>!(t.gender&&n.gender!==t.gender||t.minAge&&n.age<t.minAge||t.maxAge&&n.age>t.maxAge||t.occupation&&!n.occupation.toLowerCase().includes(t.occupation.toLowerCase())))}async clearCache(){await T.set(B,j,pe,null),await T.set(B,we,"handle",null),this.isInitialized=!1,this.initializationPromise=null,this.folderHandle=null,this.metadataCache=null}async getUtteranceTimings(t){if(this.isOnlineMode&&this.onlineService){const e=await this.getTextGrid(t);if(!e)return null;const n=de.parse(e);return de.extractUtteranceTimings(n)}if(await this.initialize(),!this.folderHandle)return null;try{const e=await this.getFileFromFolder(`${this.basePath}03b_MASC_textgrid_files/${t}.TextGrid`);if(!e)return null;const n=await e.text(),s=de.parse(n);return de.extractUtteranceTimings(s)}catch{return null}}async getDatabaseFile(){return this.isOnlineMode&&this.onlineService?await this.onlineService.getFile("04_MASC_database/aramaic_corpus.db"):(await this.initialize(),this.folderHandle?await this.getFileFromFolder(`${this.basePath}04_MASC_database/aramaic_corpus.db`):null)}}const J=new ga,xn=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"})),O="masc-corpus",va="https://evb0110.github.io/static/MASC_v1.0/manifest.json",Ne="https://evb0110.github.io/static/MASC_v1.0/",L={metadata:"metadata",textgrids:"textgrids",transcriptions:"transcriptions",lemmatized:"lemmatized",audio:"audio",database:"database",manifest:"manifest"};class ba{constructor(){$(this,"manifest",null);$(this,"localState",null);$(this,"downloadQueue",[]);$(this,"isDownloading",!1);$(this,"abortController",null);$(this,"isDatabaseInitialized",!1);$(this,"initializationInProgress",!1)}async initialize(){if(!this.initializationInProgress){this.initializationInProgress=!0;try{await this.ensureDatabase(),await this.fetchManifest(),await this.loadLocalState()}catch(t){throw t}finally{this.initializationInProgress=!1}}}async ensureDatabase(){if(this.isDatabaseInitialized)return;const t={initialized:!0,timestamp:Date.now()};for(const e of Object.values(L))try{await T.set(O,e,"_init",t)}catch{}await new Promise(e=>setTimeout(e,100)),this.isDatabaseInitialized=!0}async getDownloadStatus(){if(this.manifest||await this.fetchManifest(),!this.manifest)return{totalFiles:0,downloadedFiles:0,isComplete:!1,missingCritical:[]};this.localState||await this.loadLocalState();const t=Object.keys(this.manifest.files).length,e=this.localState?Object.values(this.localState.files).filter(s=>s.downloaded).length:0,n=await this.getMissingCriticalFiles();return{totalFiles:t,downloadedFiles:e,isComplete:e===t,missingCritical:n}}async getMissingCriticalFiles(){if(this.manifest||await this.fetchManifest(),!this.manifest)return[];const t=["MASC_metadata.csv","04_MASC_database/aramaic_corpus.db"],e=[];for(const n of t)if(this.manifest.files[n]){const s=this.getStoreForFile(n);await T.get(O,s,n)||e.push(n)}return e}async isDataReady(){try{if(!await T.get(O,L.metadata,"_init"))return!1;const e=await T.get(O,L.audio,"_init");return this.localState||await this.loadLocalState(),!this.localState||!this.localState.files?!0:Object.values(this.localState.files).filter(s=>s.downloaded).length>0}catch{return!0}}async getFilesToUpdate(){if(this.manifest||await this.fetchManifest(),!this.manifest)throw new Error("Failed to load manifest");if(!this.localState)return Object.keys(this.manifest.files);const t=[];for(const[e,n]of Object.entries(this.manifest.files)){const s=this.localState.files[e];(!s||!s.downloaded||s.hash!==n.hash)&&t.push(e)}return t}async downloadAllFiles(t){var l,r;this.manifest||await this.fetchManifest();const e=await this.getFilesToUpdate();if(e.length===0)return;this.downloadQueue=[...e],this.isDownloading=!0,this.abortController=new AbortController;const n=this.calculateTotalSize(e),s={totalFiles:e.length,downloadedFiles:0,totalBytes:n,downloadedBytes:0,currentFile:"",currentFileProgress:0,errors:[]},i=Date.now();try{t(s);const o=this.groupFilesByType(e);for(const[c,f]of Object.entries(o))if(c==="txt"||c==="json")for(let u=0;u<f.length;u+=10){const m=f.slice(u,u+10);if((l=this.abortController)!=null&&l.signal.aborted)throw new Error("Download cancelled");const g=m.map(async d=>{try{const v=this.manifest.files[d].size;await this.downloadFile(d,y=>{}),s.downloadedFiles++,s.downloadedBytes+=v,this.localState.files[d]||(this.localState.files[d]={downloaded:!1}),this.localState.files[d].downloaded=!0,this.localState.files[d].hash=this.manifest.files[d].hash}catch(v){throw s.errors.push(`Failed to download ${d}: ${v}`),s.downloadedFiles++,v}});await Promise.all(g);const w=(Date.now()-i)/1e3;if(w>0){s.speed=s.downloadedBytes/w;const d=s.totalBytes-s.downloadedBytes;s.timeRemaining=d/s.speed}s.currentFile=`Completed ${Math.min(u+10,f.length)}/${f.length} ${c} files`,t(s),await this.saveLocalState(),await new Promise(d=>setTimeout(d,100))}else for(const h of f){if((r=this.abortController)!=null&&r.signal.aborted)throw new Error("Download cancelled");try{s.currentFile=h;const u=this.manifest.files[h].size;t(s),await this.downloadFile(h,g=>{s.currentFileProgress=g,t(s)}),s.downloadedFiles++,s.downloadedBytes+=u,s.currentFileProgress=100;const m=(Date.now()-i)/1e3;if(m>0){s.speed=s.downloadedBytes/m;const g=s.totalBytes-s.downloadedBytes;s.timeRemaining=g/s.speed}this.localState.files[h]||(this.localState.files[h]={downloaded:!1}),this.localState.files[h].downloaded=!0,this.localState.files[h].hash=this.manifest.files[h].hash,t(s),await new Promise(g=>setTimeout(g,50))}catch(u){s.errors.push(`Failed to download ${h}: ${u}`),s.downloadedFiles++,t(s)}}await this.saveLocalState()}finally{this.isDownloading=!1,this.abortController=null}}cancelDownload(){this.abortController&&(this.abortController.abort(),this.isDownloading=!1)}async clearAllData(){const t=Object.values(L);for(const e of t)try{await indexedDB.deleteDatabase(O);break}catch{}this.localState=null}async getFile(t){const e=this.getStoreForFile(t),n=await T.get(O,e,t);if(!n){if(await this.downloadSingleFile(t)){const l=await T.get(O,e,t);if(l){const r=new Blob([l.content],{type:l.type});return new File([r],l.name,{type:l.type})}}return null}const s=new Blob([n.content],{type:n.type});return new File([s],n.name,{type:n.type})}async getManifest(){return this.manifest||await this.fetchManifest(),this.manifest}async getTextContent(t){const e=this.getStoreForFile(t),n=await T.get(O,e,t);if(!n){if(await this.downloadSingleFile(t)){const l=await T.get(O,e,t);if(l)return typeof l.content=="string"?l.content:new TextDecoder().decode(l.content)}return null}return typeof n.content=="string"?n.content:new TextDecoder().decode(n.content)}async checkForUpdates(){try{const t=this.manifest;return await this.fetchManifest(),!t||t.version!==this.manifest.version?!0:(await this.getFilesToUpdate()).length>0}catch{return!1}}async performBackgroundUpdate(t){const e=await this.getFilesToUpdate();if(e.length!==0){t==null||t(`Updating ${e.length} files...`);for(const n of e)try{await this.downloadFile(n),t==null||t(`Updated ${n}`)}catch{}await this.saveLocalState(),t==null||t("Update complete")}}async downloadSingleFile(t){try{return this.manifest||await this.fetchManifest(),!this.manifest||!this.manifest.files[t]?!1:(await this.downloadFile(t),this.localState||await this.loadLocalState(),this.localState&&(this.localState.files[t]||(this.localState.files[t]={downloaded:!1,hash:""}),this.localState.files[t].downloaded=!0,this.localState.files[t].hash=this.manifest.files[t].hash,await this.saveLocalState()),!0)}catch{return!1}}async fetchManifest(){if(typeof window>"u"||!window.fetch)throw new Error("Fetch API not available");try{const t=new AbortController,e=setTimeout(()=>{t.abort()},1e4),n=await fetch(va,{signal:t.signal});if(clearTimeout(e),!n.ok)throw new Error(`Failed to fetch manifest: ${n.status} ${n.statusText}`);const s=await n.text();try{this.manifest=JSON.parse(s)}catch{throw new Error("Invalid manifest JSON")}}catch(t){if(t.message&&t.message.includes("CORS"),t.name==="AbortError")throw new Error("Manifest fetch timed out after 10 seconds");await this.fetchManifestAlternative()}}async fetchManifestAlternative(){try{const t=await fetch("/masc-manifest.json");if(t.ok){this.manifest=await t.json();return}}catch{}try{const t=await fetch("/.devkit/manifest.json");if(t.ok){this.manifest=await t.json();return}}catch{}this.manifest={version:"1.0.0",generated:new Date().toISOString(),baseUrl:Ne,totalSize:919127219,totalFiles:889,files:{"speakers.json":{size:5e4,hash:"dummy",lastModified:new Date().toISOString()},"04_MASC_database/aramaic_corpus.db":{size:1e7,hash:"dummy",lastModified:new Date().toISOString()}}}}async loadLocalState(){const t=await T.get(O,L.manifest,"localState");t&&(this.localState=t)}async saveLocalState(){this.manifest&&(this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.version=this.manifest.version,await T.set(O,L.manifest,"localState",this.localState))}async downloadFile(t,e){var l,r,o;if((l=this.abortController)!=null&&l.signal.aborted)throw new Error("Download cancelled");const n=Ne+t,s=(r=this.manifest)==null?void 0:r.files[t],i=s&&s.size<5e4;try{const c=await fetch(n,{signal:(o=this.abortController)==null?void 0:o.signal,mode:"cors",credentials:"omit"});if(!c.ok)throw new Error(`Failed to download ${t}: ${c.statusText}`);let f;if(i){const g=await c.arrayBuffer();f=new Uint8Array(g),e&&e(100)}else{const g=Number(c.headers.get("content-length")),w=c.body.getReader(),d=[];let v=0;for(;;){const{done:C,value:_}=await w.read();if(C)break;d.push(_),v+=_.length,e&&g&&e(v/g*100)}f=new Uint8Array(v);let y=0;for(const C of d)f.set(C,y),y+=C.length}const h=this.getStoreForFile(t),u={name:t.split("/").pop(),content:f,type:this.getMimeType(t)};let m=3;for(;m>0;)try{await T.set(O,h,t,u);break}catch(g){if(m--,m>0)await new Promise(w=>setTimeout(w,500));else throw g}this.localState||(this.localState={version:this.manifest.version,downloadedAt:new Date().toISOString(),files:{}}),this.localState.files[t]={downloaded:!0,hash:this.manifest.files[t].hash,downloadedAt:new Date().toISOString()}}catch(c){throw c.name==="AbortError"?new Error("Download cancelled"):c}}getStoreForFile(t){return t.includes("MASC_textgrid")||t.includes("textgrid_files")?L.textgrids:t.includes("MASC_lemmatized")?L.lemmatized:t.includes("MASC_transcriptions")?L.transcriptions:t.includes("MASC_audio")||t.includes("audio_files")?L.audio:t.includes("MASC_database")||t.endsWith(".db")?L.database:(t.endsWith(".json"),L.metadata)}getMimeType(t){var n;switch((n=t.split(".").pop())==null?void 0:n.toLowerCase()){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"txt":return"text/plain";case"json":return"application/json";case"db":return"application/x-sqlite3";case"textgrid":return"text/plain";default:return"application/octet-stream"}}calculateTotalSize(t){return this.manifest?t.reduce((e,n)=>{var s;return e+(((s=this.manifest.files[n])==null?void 0:s.size)||0)},0):0}groupFilesByType(t){const e={metadata:[],transcriptions:[],lemmatized:[],textgrids:[],database:[],audio:[]};for(const n of t)n.endsWith(".json")?e.metadata.push(n):n.includes("MASC_transcriptions")?e.transcriptions.push(n):n.includes("MASC_lemmatized")?e.lemmatized.push(n):n.includes("textgrid")?e.textgrids.push(n):n.endsWith(".db")?e.database.push(n):n.includes("audio")?e.audio.push(n):e.metadata.push(n);return Object.fromEntries(Object.entries(e).filter(([n,s])=>s.length>0))}}const kn=new ba;class ya{parseText(t){if(!t||!t.trim())return[];const e=[],n=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,s=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,l=!1;for(;(i=n.exec(t))!==null;){l=!0;const r=parseInt(i[1]),o=i[2].trim(),c=this.parseUtteranceTokens(o);e.push({number:r,tokens:c,raw:o})}if(!l)for(;(i=s.exec(t))!==null;){const r=parseInt(i[1]),o=i[2].trim(),c=this.parseUtteranceTokens(o);e.push({number:r,tokens:c,raw:o})}return e}parseUtteranceTokens(t){const e=[];let n=0,s=t;for(;s.trim();){let i=!1;const l=s.match(/^\s*<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/);if(l){const u=l[0],m=l[1].trim(),g=s.length>u.length&&/\s/.test(s[u.length]),w=m.match(/^(\S+?)<([^>]+)>$/);if(w){const[,d,v]=w,y={surface:d,annotation:v===d?void 0:v,position:n++,raw:u.trim(),isArabic:!0,arabicContent:d,spaceAfter:g};this.parseAnnotationContent(v,y),e.push(y)}else e.push({surface:m,position:n++,raw:u.trim(),isArabic:!0,arabicContent:m,spaceAfter:g});s=s.substring(u.length),i=!0;continue}let r="",o=!1,c=0,f=!1;for(;c<s.length;){const u=s[c];if(u==="<")o=!0;else if(u===">"){o=!1,r+=u,c++,c<s.length&&/\s/.test(s[c])&&(f=!0);break}if(!o&&/\s/.test(u)&&r.length>0&&!r.includes("<")){f=!0;break}r+=u,c++}if(!r||r.trim()===""){s=s.substring(1);continue}const h=r.match(/^(\S+?)<([^>]+)>-(\S+?)(?:<([^>]+)>)?$/);if(h){const[u,m,g,w,d]=h;e.push({surface:m+"-"+w,annotation:d,position:n++,raw:u,prefix:{surface:m,morphology:g},lemma:d?d.split(" ")[0]:void 0,spaceAfter:f}),i=!0}else if(r.includes("<")&&r.endsWith(">")){const u=r.trim(),m=u.match(/^([^<]+)<([^>]+)>$/);if(m){const[,g,w]=m,d={surface:g.trim(),annotation:w===g.trim()?void 0:w,position:n++,raw:u,spaceAfter:f};this.parseAnnotationContent(w,d),e.push(d),i=!0}}i||e.push({surface:r,position:n++,raw:r,spaceAfter:f}),s=s.substring(c).trimStart()}return e}parseAnnotationContent(t,e){const n=t.split(/\s+/);if(n.length===0)return;const s=n[0];if(s.includes("/")){const i=s.split("/").map(l=>l.trim()).filter(l=>l);i.length>0&&(e.lemma=i[0],i.length>1&&(e.variants=i.slice(1)))}else e.lemma=s;n.length>1&&(e.morphology=n.slice(1))}extractSurfaceForms(t){return this.parseText(t).map(n=>{const s=n.tokens.map(i=>i.surface);return`(${n.number}) ${s.join(" ")}`}).join(" ")}getTokenSummary(t){const e=[];return t.lemma&&e.push(`Lemma: ${t.lemma}`),t.variants&&t.variants.length>0&&e.push(`Variants: ${t.variants.join(", ")}`),t.morphology&&t.morphology.length>0&&e.push(`Morphology: ${t.morphology.join(" ")}`),t.prefix&&e.push(`Prefix: ${t.prefix.surface} (${t.prefix.morphology})`),t.isArabic&&e.push("Arabic"),e.join(`
`)}}const wa=new ya;class pa{parseTranscription(t){const e=[];if(!t)return e;const n=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,s=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,l=!1;for(;(i=n.exec(t))!==null;){l=!0;const r=parseInt(i[1]),o=i[2].trim();e.push({number:r,text:o,tokens:this.tokenizePlainText(o,r)})}if(!l)for(;(i=s.exec(t))!==null;){const r=parseInt(i[1]),o=i[2].trim();e.push({number:r,text:o,tokens:this.tokenizePlainText(o,r)})}return e}parseLemmatizedTranscription(t){const e=[];if(!t)return e;const n=/\((\d+)\)\s*((?:(?!\(\d+\)).)*)/gs,s=/^(\d+)\s*>\s*(.+?)(?=^\d+\s*>|$)/gm;let i,l=!1;for(;(i=n.exec(t))!==null;){l=!0;const r=parseInt(i[1]),o=i[2].trim(),c=this.extractSurfaceForms(o);e.push({number:r,text:c,tokens:this.tokenizeLemmatizedText(o,r)})}if(!l)for(;(i=s.exec(t))!==null;){const r=parseInt(i[1]),o=i[2].trim(),c=this.extractSurfaceForms(o);e.push({number:r,text:c,tokens:this.tokenizeLemmatizedText(o,r)})}return e}parseAnnotatedTranscription(t){return wa.parseText(t)}tokenizePlainText(t,e){const n=[],s=t.split(/(\s+)/).filter(l=>l.trim());let i=0;for(const l of s)l.trim()&&(n.push({surface:l,position:i,utteranceNumber:e}),i++);return n}tokenizeLemmatizedText(t,e){const n=[];if(!t||!t.trim())return n;try{const i=this.extractSurfaceForms(t).split(/\s+/).filter(r=>r.trim());let l=0;for(const r of i)if(r.trim()){const o={surface:r,position:l,utteranceNumber:e},c=t.match(new RegExp(`${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}<([^>]+)>`));if(c){const h=c[1].split(" ");o.lemma=h[0].split("/")[0],h.length>1&&(o.morphology=h.slice(1))}n.push(o),l++}}catch{t.replace(/<[^>]*>/g," ").split(/\s+/).filter(l=>l.trim()).forEach((l,r)=>{n.push({surface:l,position:r,utteranceNumber:e})})}return n}async search(t,e={searchIn:"surface"}){var l;const n=[];let i=await J.getMetadata();(l=e.speakerFilter)!=null&&l.length&&(i=i.filter(r=>e.speakerFilter.includes(r.speakerId))),e.genderFilter&&(i=i.filter(r=>r.gender===e.genderFilter)),e.ageRange&&(i=i.filter(r=>r.age>=e.ageRange[0]&&r.age<=e.ageRange[1]));for(const r of i){const o=e.searchIn!=="surface",c=await J.getTranscription(r.textId,o);if(!c)continue;const f=o?this.parseLemmatizedTranscription(c):this.parseTranscription(c);for(const h of f){const u=this.findMatches(h.tokens,t,e);if(u.length>0){const m=this.getContext(h,u[0].position);n.push({textId:r.textId,speaker:r,utteranceNumber:h.number,utteranceText:h.text,matchedTokens:u,context:m})}}}return n}findMatches(t,e,n){const s=[],i=n.caseSensitive?e:e.toLowerCase();for(const l of t){let r="";n.searchIn==="surface"||n.searchIn==="both"?r=n.caseSensitive?l.surface:l.surface.toLowerCase():n.searchIn==="lemma"&&l.lemma&&(r=n.caseSensitive?l.lemma:l.lemma.toLowerCase());let o=!1;if(n.regex)try{o=new RegExp(i).test(r)}catch{o=r.includes(i)}else n.wholeWord?o=r===i:o=r.includes(i);o&&s.push(l)}return s}getContext(t,e,n=5){const s=t.tokens,i=s[e],l=s.slice(Math.max(0,e-n),e),r=s.slice(e+1,e+n+1);return{before:l.map(o=>o.surface).join(" "),match:i.surface,after:r.map(o=>o.surface).join(" ")}}async generateConcordance(t){return t.map(e=>({textId:e.textId,speaker:e.speaker,left:e.context.before,keyword:e.context.match,right:e.context.after,utteranceNumber:e.utteranceNumber,audioTimestamp:e.audioTimestamp}))}extractSurfaceForms(t){if(!t||!t.includes("<"))return t.trim();try{let e=t;const n=/<ar<\[annotation\]>>\s*(.*?)\s*<\/ar<\[annotation\]>>/g;e=e.replace(n,(r,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const s=/<ar>\s*(.*?)\s*<\/ar>/g;e=e.replace(s,(r,o)=>{const c=o.match(/^(\S+?)<[^>]+>$/);return c?" "+c[1]+" ":" "+o.trim()+" "});const i=/<(\w+)>\s*([^<]*?)\s*<\/\1>/g;e=e.replace(i," $2 ");const l=/(\S+?)<[^>]*>/g;return e=e.replace(l,"$1"),e=e.replace(/<[^>]*>/g," "),e=e.replace(/>[^<]*</g," "),e=e.replace(/^[>\s]+|[<\s]+$/g,""),e=e.replace(/\s+/g," ").trim(),e}catch{let n=t.replace(/(\S+?)<[^>]*>/g,"$1").replace(/<[^>]*>/g," ");return n=n.replace(/^[>\s]+|[<\s]+$/g,"").replace(/\s+/g," ").trim(),n}}async getWordFrequency(t={countBy:"surface"}){var i;const e=new Map;let s=await J.getMetadata();(i=t.speakerFilter)!=null&&i.length&&(s=s.filter(l=>t.speakerFilter.includes(l.speakerId)));for(const l of s){const r=t.countBy==="lemma",o=await J.getTranscription(l.textId,r);if(!o)continue;const c=r?this.parseLemmatizedTranscription(o):this.parseTranscription(o);for(const f of c)for(const h of f.tokens){const u=t.countBy==="lemma"&&h.lemma?h.lemma:h.surface;e.set(u,(e.get(u)||0)+1)}}if(t.minFrequency)for(const[l,r]of e.entries())r<t.minFrequency&&e.delete(l);return e}async getCollocations(t,e={window:3,minFrequency:2,measure:"frequency"}){const n=new Map,s=await J.getMetadata();for(const i of s){const l=await J.getTranscription(i.textId,!1);if(!l)continue;const r=this.parseTranscription(l);for(const o of r){const c=o.tokens;for(let f=0;f<c.length;f++)if(c[f].surface.toLowerCase().includes(t.toLowerCase())){for(let h=Math.max(0,f-e.window);h<=Math.min(c.length-1,f+e.window);h++)if(h!==f){const u=c[h].surface;n.set(u,(n.get(u)||0)+1)}}}}for(const[i,l]of n.entries())l<e.minFrequency&&n.delete(i);return n}exportResults(t,e){switch(e){case"csv":const n=["Text ID","Speaker","Gender","Age","Utterance","Left Context","Match","Right Context"],s=t.map(i=>[i.textId,i.speaker.speakerName,i.speaker.gender,i.speaker.age,i.utteranceNumber,i.context.before,i.context.match,i.context.after]);return[n,...s].map(i=>i.join("	")).join(`
`);case"json":return JSON.stringify(t,null,2);case"txt":return t.map(i=>`${i.textId} (${i.speaker.speakerName}): ...${i.context.before} [[${i.context.match}]] ${i.context.after}...`).join(`

`);default:return""}}generateCitation(t){const e=t.speaker;return`${e.speakerName} (${e.gender}, age ${e.age}). Text ${t.textId}, utterance ${t.utteranceNumber}. Modern Aramaic Spoken Corpus (MASC) v1.0.`}}const Pn=new pa,Sa=Bt("v-alert-title"),xa=["success","info","warning","error"],ka=M({border:{type:[Boolean,String],validator:a=>typeof a=="boolean"||["top","end","bottom","start"].includes(a)},borderColor:String,closable:Boolean,closeIcon:{type:z,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:a=>xa.includes(a)},...Ye(),...Xe(),...Qt(),...Ze(),...qt(),...Kt(),...Je(),...Qe(),...qe(),...Ke({variant:"flat"})},"VAlert"),Fn=q()({name:"VAlert",props:ka(),emits:{"click:close":a=>!0,"update:modelValue":a=>!0},setup(a,t){let{emit:e,slots:n}=t;const s=K(a,"modelValue"),i=P(()=>{if(a.icon!==!1)return a.type?a.icon??`$${a.type}`:a.icon}),l=P(()=>({color:a.color??a.type,variant:a.variant})),{themeClasses:r}=We(a),{colorClasses:o,colorStyles:c,variantClasses:f}=zt(l),{densityClasses:h}=Et(a),{dimensionStyles:u}=Rt(a),{elevationClasses:m}=Nt(a),{locationStyles:g}=jt(a),{positionClasses:w}=Ht(a),{roundedClasses:d}=Ut(a),{textColorClasses:v,textColorStyles:y}=Gt(A(a,"borderColor")),{t:C}=Y(),_=P(()=>({"aria-label":C(a.closeLabel),onClick(k){s.value=!1,e("click:close",k)}}));return()=>{const k=!!(n.prepend||i.value),E=!!(n.title||a.title),N=!!(n.close||a.closable);return s.value&&b(a.tag,{class:["v-alert",a.border&&{"v-alert--border":!!a.border,[`v-alert--border-${a.border===!0?"start":a.border}`]:!0},{"v-alert--prominent":a.prominent},r.value,o.value,h.value,m.value,w.value,d.value,f.value,a.class],style:[c.value,u.value,g.value,a.style],role:"alert"},{default:()=>{var S,p;return[Wt(!1,"v-alert"),a.border&&b("div",{key:"border",class:["v-alert__border",v.value],style:y.value},null),k&&b("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?b(Ve,{key:"prepend-defaults",disabled:!i.value,defaults:{VIcon:{density:a.density,icon:i.value,size:a.prominent?44:28}}},n.prepend):b(Se,{key:"prepend-icon",density:a.density,icon:i.value,size:a.prominent?44:28},null)]),b("div",{class:"v-alert__content"},[E&&b(Sa,{key:"title"},{default:()=>{var x;return[((x=n.title)==null?void 0:x.call(n))??a.title]}}),((S=n.text)==null?void 0:S.call(n))??a.text,(p=n.default)==null?void 0:p.call(n)]),n.append&&b("div",{key:"append",class:"v-alert__append"},[n.append()]),N&&b("div",{key:"close",class:"v-alert__close"},[n.close?b(Ve,{key:"close-defaults",defaults:{VBtn:{icon:a.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var x;return[(x=n.close)==null?void 0:x.call(n,{props:_.value})]}}):b(G,D({key:"close-btn",icon:a.closeIcon,size:"x-small",variant:"text"},_.value),null)])]}})}}});function Pa(){const a=H([]);Jt(()=>a.value=[]);function t(e,n){a.value[n]=e}return{refs:a,updateRef:t}}const Fa=M({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:a=>a.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:a=>a%1===0},totalVisible:[Number,String],firstIcon:{type:z,default:"$first"},prevIcon:{type:z,default:"$prev"},nextIcon:{type:z,default:"$next"},lastIcon:{type:z,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...ta(),...Ye(),...Xe(),...Ze(),...Je(),...ea(),...Qe({tag:"nav"}),...qe(),...Ke({variant:"text"})},"VPagination"),je=q()({name:"VPagination",props:Fa(),emits:{"update:modelValue":a=>!0,first:a=>!0,prev:a=>!0,next:a=>!0,last:a=>!0},setup(a,t){let{slots:e,emit:n}=t;const s=K(a,"modelValue"),{t:i,n:l}=Y(),{isRtl:r}=Zt(),{themeClasses:o}=We(a),{width:c}=me(),f=Xt(-1);xe(void 0,{scoped:!0});const{resizeRef:h}=Yt(S=>{if(!S.length)return;const{target:p,contentRect:x}=S[0],F=p.querySelector(".v-pagination__list > *");if(!F)return;const I=x.width,V=F.offsetWidth+parseFloat(getComputedStyle(F).marginRight)*2;f.value=w(I,V)}),u=P(()=>parseInt(a.length,10)),m=P(()=>parseInt(a.start,10)),g=P(()=>a.totalVisible!=null?parseInt(a.totalVisible,10):f.value>=0?f.value:w(c.value,58));function w(S,p){const x=a.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((S-p*x)/p).toFixed(2)))}const d=P(()=>{if(u.value<=0||isNaN(u.value)||u.value>Number.MAX_SAFE_INTEGER)return[];if(g.value<=0)return[];if(g.value===1)return[s.value];if(u.value<=g.value)return ce(u.value,m.value);const S=g.value%2===0,p=S?g.value/2:Math.floor(g.value/2),x=S?p:p+1,F=u.value-p;if(x-s.value>=0)return[...ce(Math.max(1,g.value-1),m.value),a.ellipsis,u.value];if(s.value-F>=(S?1:0)){const I=g.value-1,V=u.value-I+m.value;return[m.value,a.ellipsis,...ce(I,V)]}else{const I=Math.max(1,g.value-3),V=I===1?s.value:s.value-Math.ceil(I/2)+m.value;return[m.value,a.ellipsis,...ce(I,V),a.ellipsis,u.value]}});function v(S,p,x){S.preventDefault(),s.value=p,x&&n(x,p)}const{refs:y,updateRef:C}=Pa();xe({VPaginationBtn:{color:A(a,"color"),border:A(a,"border"),density:A(a,"density"),size:A(a,"size"),variant:A(a,"variant"),rounded:A(a,"rounded"),elevation:A(a,"elevation")}});const _=P(()=>d.value.map((S,p)=>{const x=F=>C(F,p);if(typeof S=="string")return{isActive:!1,key:`ellipsis-${p}`,page:S,props:{ref:x,ellipsis:!0,icon:!0,disabled:!0}};{const F=S===s.value;return{isActive:F,key:S,page:l(S),props:{ref:x,ellipsis:!1,icon:!0,disabled:!!a.disabled||+a.length<2,color:F?a.activeColor:a.color,"aria-current":F,"aria-label":i(F?a.currentPageAriaLabel:a.pageAriaLabel,S),onClick:I=>v(I,S)}}}})),k=P(()=>{const S=!!a.disabled||s.value<=m.value,p=!!a.disabled||s.value>=m.value+u.value-1;return{first:a.showFirstLastPage?{icon:r.value?a.lastIcon:a.firstIcon,onClick:x=>v(x,m.value,"first"),disabled:S,"aria-label":i(a.firstAriaLabel),"aria-disabled":S}:void 0,prev:{icon:r.value?a.nextIcon:a.prevIcon,onClick:x=>v(x,s.value-1,"prev"),disabled:S,"aria-label":i(a.previousAriaLabel),"aria-disabled":S},next:{icon:r.value?a.prevIcon:a.nextIcon,onClick:x=>v(x,s.value+1,"next"),disabled:p,"aria-label":i(a.nextAriaLabel),"aria-disabled":p},last:a.showFirstLastPage?{icon:r.value?a.firstIcon:a.lastIcon,onClick:x=>v(x,m.value+u.value-1,"last"),disabled:p,"aria-label":i(a.lastAriaLabel),"aria-disabled":p}:void 0}});function E(){var p;const S=s.value-m.value;(p=y.value[S])==null||p.$el.focus()}function N(S){S.key===$e.left&&!a.disabled&&s.value>+a.start?(s.value=s.value-1,Le(E)):S.key===$e.right&&!a.disabled&&s.value<m.value+u.value-1&&(s.value=s.value+1,Le(E))}return ee(()=>b(a.tag,{ref:h,class:["v-pagination",o.value,a.class],style:a.style,role:"navigation","aria-label":i(a.ariaLabel),onKeydown:N,"data-test":"v-pagination-root"},{default:()=>[b("ul",{class:"v-pagination__list"},[a.showFirstLastPage&&b("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[e.first?e.first(k.value.first):b(G,D({_as:"VPaginationBtn"},k.value.first),null)]),b("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[e.prev?e.prev(k.value.prev):b(G,D({_as:"VPaginationBtn"},k.value.prev),null)]),_.value.map((S,p)=>b("li",{key:S.key,class:["v-pagination__item",{"v-pagination__item--is-active":S.isActive}],"data-test":"v-pagination-item"},[e.item?e.item(S):b(G,D({_as:"VPaginationBtn"},S.props),{default:()=>[S.page]})])),b("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[e.next?e.next(k.value.next):b(G,D({_as:"VPaginationBtn"},k.value.next),null)]),a.showFirstLastPage&&b("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[e.last?e.last(k.value.last):b(G,D({_as:"VPaginationBtn"},k.value.last),null)])])]})),{}}}),Ca=M({page:{type:[Number,String],default:1},itemsPerPage:{type:[Number,String],default:10}},"DataTable-paginate"),st=Symbol.for("vuetify:data-table-pagination");function Ta(a){const t=K(a,"page",void 0,n=>+(n??1)),e=K(a,"itemsPerPage",void 0,n=>+(n??10));return{page:t,itemsPerPage:e}}function Ia(a){const{page:t,itemsPerPage:e,itemsLength:n}=a,s=P(()=>e.value===-1?0:e.value*(t.value-1)),i=P(()=>e.value===-1?n.value:Math.min(n.value,s.value+e.value)),l=P(()=>e.value===-1||n.value===0?1:Math.ceil(n.value/e.value));Pe([t,l],()=>{t.value>l.value&&(t.value=l.value)});function r(u){e.value=u,t.value=1}function o(){t.value=be(t.value+1,1,l.value)}function c(){t.value=be(t.value-1,1,l.value)}function f(u){t.value=be(u,1,l.value)}const h={page:t,itemsPerPage:e,startIndex:s,stopIndex:i,pageCount:l,itemsLength:n,nextPage:o,prevPage:c,setPage:f,setItemsPerPage:r};return ae(st,h),h}function _a(){const a=te(st);if(!a)throw new Error("Missing pagination!");return a}function Aa(a){const t=et("usePaginatedItems"),{items:e,startIndex:n,stopIndex:s,itemsPerPage:i}=a,l=P(()=>i.value<=0?e.value:e.value.slice(n.value,s.value));return Pe(l,r=>{t.emit("update:currentItems",r)}),{paginatedItems:l}}const it=M({prevIcon:{type:z,default:"$prev"},nextIcon:{type:z,default:"$next"},firstIcon:{type:z,default:"$first"},lastIcon:{type:z,default:"$last"},itemsPerPageText:{type:String,default:"$vuetify.dataFooter.itemsPerPageText"},pageText:{type:String,default:"$vuetify.dataFooter.pageText"},firstPageLabel:{type:String,default:"$vuetify.dataFooter.firstPage"},prevPageLabel:{type:String,default:"$vuetify.dataFooter.prevPage"},nextPageLabel:{type:String,default:"$vuetify.dataFooter.nextPage"},lastPageLabel:{type:String,default:"$vuetify.dataFooter.lastPage"},itemsPerPageOptions:{type:Array,default:()=>[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}]},showCurrentPage:Boolean},"VDataTableFooter"),He=q()({name:"VDataTableFooter",props:it(),setup(a,t){let{slots:e}=t;const{t:n}=Y(),{page:s,pageCount:i,startIndex:l,stopIndex:r,itemsLength:o,itemsPerPage:c,setItemsPerPage:f}=_a(),h=P(()=>a.itemsPerPageOptions.map(u=>typeof u=="number"?{value:u,title:u===-1?n("$vuetify.dataFooter.itemsPerPageAll"):String(u)}:{...u,title:isNaN(Number(u.title))?n(u.title):u.title}));return ee(()=>{var m;const u=je.filterProps(a);return b("div",{class:"v-data-table-footer"},[(m=e.prepend)==null?void 0:m.call(e),b("div",{class:"v-data-table-footer__items-per-page"},[b("span",null,[n(a.itemsPerPageText)]),b(nt,{items:h.value,modelValue:c.value,"onUpdate:modelValue":g=>f(Number(g)),density:"compact",variant:"outlined","hide-details":!0},null)]),b("div",{class:"v-data-table-footer__info"},[b("div",null,[n(a.pageText,o.value?l.value+1:0,r.value,o.value)])]),b("div",{class:"v-data-table-footer__pagination"},[b(je,D({modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,density:"comfortable","first-aria-label":a.firstPageLabel,"last-aria-label":a.lastPageLabel,length:i.value,"next-aria-label":a.nextPageLabel,"previous-aria-label":a.prevPageLabel,rounded:!0,"show-first-last-page":!0,"total-visible":a.showCurrentPage?1:0,variant:"plain"},u),null)])])}),{}}}),he=aa({align:{type:String,default:"start"},fixed:Boolean,fixedOffset:[Number,String],height:[Number,String],lastFixed:Boolean,noPadding:Boolean,tag:String,width:[Number,String],maxWidth:[Number,String],nowrap:Boolean},(a,t)=>{let{slots:e}=t;const n=a.tag??"td";return b(n,{class:["v-data-table__td",{"v-data-table-column--fixed":a.fixed,"v-data-table-column--last-fixed":a.lastFixed,"v-data-table-column--no-padding":a.noPadding,"v-data-table-column--nowrap":a.nowrap},`v-data-table-column--align-${a.align}`],style:{height:W(a.height),width:W(a.width),maxWidth:W(a.maxWidth),left:W(a.fixedOffset||null)}},{default:()=>{var s;return[(s=e.default)==null?void 0:s.call(e)]}})}),Ma=M({headers:Array},"DataTable-header"),lt=Symbol.for("vuetify:data-table-headers"),rt={title:"",sortable:!1},Da={...rt,width:48};function Va(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).map(e=>({element:e,priority:0}));return{enqueue:(e,n)=>{let s=!1;for(let i=0;i<t.length;i++)if(t[i].priority>n){t.splice(i,0,{element:e,priority:n}),s=!0;break}s||t.push({element:e,priority:n})},size:()=>t.length,count:()=>{let e=0;if(!t.length)return 0;const n=Math.floor(t[0].priority);for(let s=0;s<t.length;s++)Math.floor(t[s].priority)===n&&(e+=1);return e},dequeue:()=>t.shift()}}function ke(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(!a.children)t.push(a);else for(const e of a.children)ke(e,t);return t}function ot(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;for(const e of a)e.key&&t.add(e.key),e.children&&ot(e.children,t);return t}function $a(a){if(a.key){if(a.key==="data-table-group")return rt;if(["data-table-expand","data-table-select"].includes(a.key))return Da}}function Te(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return a.children?Math.max(t,...a.children.map(e=>Te(e,t+1))):t}function La(a){let t=!1;function e(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i)if(l&&(i.fixed=!0),i.fixed)if(i.children)for(let r=i.children.length-1;r>=0;r--)e(i.children[r],!0);else t?isNaN(+i.width)&&sa(`Multiple fixed columns should have a static width (key: ${i.key})`):i.lastFixed=!0,t=!0;else if(i.children)for(let r=i.children.length-1;r>=0;r--)e(i.children[r]);else t=!1}for(let i=a.length-1;i>=0;i--)e(a[i]);function n(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!i)return l;if(i.children){i.fixedOffset=l;for(const r of i.children)l=n(r,l)}else i.fixed&&(i.fixedOffset=l,l+=parseFloat(i.width||"0")||0);return l}let s=0;for(const i of a)s=n(i,s)}function Ba(a,t){const e=[];let n=0;const s=Va(a);for(;s.size()>0;){let l=s.count();const r=[];let o=1;for(;l>0;){const{element:c,priority:f}=s.dequeue(),h=t-n-Te(c);if(r.push({...c,rowspan:h??1,colspan:c.children?ke(c).length:1}),c.children)for(const u of c.children){const m=f%1+o/Math.pow(10,n+2);s.enqueue(u,n+h+m)}o+=1,l-=1}n+=1,e.push(r)}return{columns:a.map(l=>ke(l)).flat(),headers:e}}function ct(a){const t=[];for(const e of a){const n={...$a(e),...e},s=n.key??(typeof n.value=="string"?n.value:null),i=n.value??s??null,l={...n,key:s,value:i,sortable:n.sortable??(n.key!=null||!!n.sort),children:n.children?ct(n.children):void 0};t.push(l)}return t}function Oa(a,t){const e=H([]),n=H([]),s=H({}),i=H({}),l=H({});tt(()=>{var w,d,v;const c=(a.headers||Object.keys(a.items[0]??{}).map(y=>({key:y,title:na(y)}))).slice(),f=ot(c);(w=t==null?void 0:t.groupBy)!=null&&w.value.length&&!f.has("data-table-group")&&c.unshift({key:"data-table-group",title:"Group"}),(d=t==null?void 0:t.showSelect)!=null&&d.value&&!f.has("data-table-select")&&c.unshift({key:"data-table-select"}),(v=t==null?void 0:t.showExpand)!=null&&v.value&&!f.has("data-table-expand")&&c.push({key:"data-table-expand"});const h=ct(c);La(h);const u=Math.max(...h.map(y=>Te(y)))+1,m=Ba(h,u);e.value=m.headers,n.value=m.columns;const g=m.headers.flat(1);for(const y of g)y.key&&(y.sortable&&(y.sort&&(s.value[y.key]=y.sort),y.sortRaw&&(i.value[y.key]=y.sortRaw)),y.filter&&(l.value[y.key]=y.filter))});const r={headers:e,columns:n,sortFunctions:s,sortRawFunctions:i,filterFunctions:l};return ae(lt,r),r}function ge(){const a=te(lt);if(!a)throw new Error("Missing headers!");return a}const za={showSelectAll:!1,allSelected:()=>[],select:a=>{var n;let{items:t,value:e}=a;return new Set(e?[(n=t[0])==null?void 0:n.value]:[])},selectAll:a=>{let{selected:t}=a;return t}},ut={showSelectAll:!0,allSelected:a=>{let{currentPage:t}=a;return t},select:a=>{let{items:t,value:e,selected:n}=a;for(const s of t)e?n.add(s.value):n.delete(s.value);return n},selectAll:a=>{let{value:t,currentPage:e,selected:n}=a;return ut.select({items:e,value:t,selected:n})}},dt={showSelectAll:!0,allSelected:a=>{let{allItems:t}=a;return t},select:a=>{let{items:t,value:e,selected:n}=a;for(const s of t)e?n.add(s.value):n.delete(s.value);return n},selectAll:a=>{let{value:t,allItems:e,selected:n}=a;return dt.select({items:e,value:t,selected:n})}},Ea=M({showSelect:Boolean,selectStrategy:{type:[String,Object],default:"page"},modelValue:{type:Array,default:()=>[]},valueComparator:{type:Function,default:at}},"DataTable-select"),ft=Symbol.for("vuetify:data-table-selection");function Ra(a,t){let{allItems:e,currentPage:n}=t;const s=K(a,"modelValue",a.modelValue,v=>new Set(re(v).map(y=>{var C;return((C=e.value.find(_=>a.valueComparator(y,_.value)))==null?void 0:C.value)??y})),v=>[...v.values()]),i=P(()=>e.value.filter(v=>v.selectable)),l=P(()=>n.value.filter(v=>v.selectable)),r=P(()=>{if(typeof a.selectStrategy=="object")return a.selectStrategy;switch(a.selectStrategy){case"single":return za;case"all":return dt;case"page":default:return ut}});function o(v){return re(v).every(y=>s.value.has(y.value))}function c(v){return re(v).some(y=>s.value.has(y.value))}function f(v,y){const C=r.value.select({items:v,value:y,selected:new Set(s.value)});s.value=C}function h(v){f([v],!o([v]))}function u(v){const y=r.value.selectAll({value:v,allItems:i.value,currentPage:l.value,selected:new Set(s.value)});s.value=y}const m=P(()=>s.value.size>0),g=P(()=>{const v=r.value.allSelected({allItems:i.value,currentPage:l.value});return!!v.length&&o(v)}),w=P(()=>r.value.showSelectAll),d={toggleSelect:h,select:f,selectAll:u,isSelected:o,isSomeSelected:c,someSelected:m,allSelected:g,showSelectAll:w};return ae(ft,d),d}function ve(){const a=te(ft);if(!a)throw new Error("Missing selection!");return a}const Na=M({sortBy:{type:Array,default:()=>[]},customKeySort:Object,multiSort:Boolean,mustSort:Boolean},"DataTable-sort"),ht=Symbol.for("vuetify:data-table-sort");function ja(a){const t=K(a,"sortBy"),e=A(a,"mustSort"),n=A(a,"multiSort");return{sortBy:t,mustSort:e,multiSort:n}}function Ha(a){const{sortBy:t,mustSort:e,multiSort:n,page:s}=a,i=o=>{if(o.key==null)return;let c=t.value.map(h=>({...h}))??[];const f=c.find(h=>h.key===o.key);f?f.order==="desc"?e.value?f.order="asc":c=c.filter(h=>h.key!==o.key):f.order="desc":n.value?c=[...c,{key:o.key,order:"asc"}]:c=[{key:o.key,order:"asc"}],t.value=c,s&&(s.value=1)};function l(o){return!!t.value.find(c=>c.key===o.key)}const r={sortBy:t,toggleSort:i,isSorted:l};return ae(ht,r),r}function mt(){const a=te(ht);if(!a)throw new Error("Missing sort!");return a}function Ua(a,t,e,n){const s=Y();return{sortedItems:P(()=>{var l,r;return e.value.length?Ga(t.value,e.value,s.current.value,{transform:n==null?void 0:n.transform,sortFunctions:{...a.customKeySort,...(l=n==null?void 0:n.sortFunctions)==null?void 0:l.value},sortRawFunctions:(r=n==null?void 0:n.sortRawFunctions)==null?void 0:r.value}):t.value})}}function Ga(a,t,e,n){const s=new Intl.Collator(e,{sensitivity:"accent",usage:"sort"});return a.map(l=>[l,n!=null&&n.transform?n.transform(l):l]).sort((l,r)=>{var o,c;for(let f=0;f<t.length;f++){let h=!1;const u=t[f].key,m=t[f].order??"asc";if(m===!1)continue;let g=fe(l[1],u),w=fe(r[1],u),d=l[0].raw,v=r[0].raw;if(m==="desc"&&([g,w]=[w,g],[d,v]=[v,d]),(o=n==null?void 0:n.sortRawFunctions)!=null&&o[u]){const y=n.sortRawFunctions[u](d,v);if(y==null)continue;if(h=!0,y)return y}if((c=n==null?void 0:n.sortFunctions)!=null&&c[u]){const y=n.sortFunctions[u](g,w);if(y==null)continue;if(h=!0,y)return y}if(!h){if(g instanceof Date&&w instanceof Date)return g.getTime()-w.getTime();if([g,w]=[g,w].map(y=>y!=null?y.toString().toLocaleLowerCase():y),g!==w)return ue(g)&&ue(w)?0:ue(g)?-1:ue(w)?1:!isNaN(g)&&!isNaN(w)?Number(g)-Number(w):s.compare(g,w)}}return 0}).map(l=>{let[r]=l;return r})}const gt=M({color:String,sticky:Boolean,disableSort:Boolean,multiSort:Boolean,sortAscIcon:{type:z,default:"$sortAsc"},sortDescIcon:{type:z,default:"$sortDesc"},headerProps:{type:Object},...Fe(),...oa()},"VDataTableHeaders"),Ue=q()({name:"VDataTableHeaders",props:gt(),setup(a,t){let{slots:e}=t;const{t:n}=Y(),{toggleSort:s,sortBy:i,isSorted:l}=mt(),{someSelected:r,allSelected:o,selectAll:c,showSelectAll:f}=ve(),{columns:h,headers:u}=ge(),{loaderClasses:m}=ia(a);function g(S,p){if(!(!a.sticky&&!S.fixed))return{position:"sticky",left:S.fixed?W(S.fixedOffset):void 0,top:a.sticky?`calc(var(--v-table-header-height) * ${p})`:void 0}}function w(S){const p=i.value.find(x=>x.key===S.key);return p?p.order==="asc"?a.sortAscIcon:a.sortDescIcon:a.sortAscIcon}const{backgroundColorClasses:d,backgroundColorStyles:v}=la(a,"color"),{displayClasses:y,mobile:C}=me(a),_=P(()=>({headers:u.value,columns:h.value,toggleSort:s,isSorted:l,sortBy:i.value,someSelected:r.value,allSelected:o.value,selectAll:c,getSortIcon:w})),k=P(()=>["v-data-table__th",{"v-data-table__th--sticky":a.sticky},y.value,m.value]),E=S=>{let{column:p,x,y:F}=S;const I=p.key==="data-table-select"||p.key==="data-table-expand",V=D(a.headerProps??{},p.headerProps??{});return b(he,D({tag:"th",align:p.align,class:[{"v-data-table__th--sortable":p.sortable&&!a.disableSort,"v-data-table__th--sorted":l(p),"v-data-table__th--fixed":p.fixed},...k.value],style:{width:W(p.width),minWidth:W(p.minWidth),maxWidth:W(p.maxWidth),...g(p,F)},colspan:p.colspan,rowspan:p.rowspan,onClick:p.sortable?()=>s(p):void 0,fixed:p.fixed,nowrap:p.nowrap,lastFixed:p.lastFixed,noPadding:I},V),{default:()=>{var Z;const Q=`header.${p.key}`,oe={column:p,selectAll:c,isSorted:l,toggleSort:s,sortBy:i.value,someSelected:r.value,allSelected:o.value,getSortIcon:w};return e[Q]?e[Q](oe):p.key==="data-table-select"?((Z=e["header.data-table-select"])==null?void 0:Z.call(e,oe))??(f.value&&b(Ce,{modelValue:o.value,indeterminate:r.value&&!o.value,"onUpdate:modelValue":c},null)):b("div",{class:"v-data-table-header__content"},[b("span",null,[p.title]),p.sortable&&!a.disableSort&&b(Se,{key:"icon",class:"v-data-table-header__sort-icon",icon:w(p)},null),a.multiSort&&l(p)&&b("div",{key:"badge",class:["v-data-table-header__sort-badge",...d.value],style:v.value},[i.value.findIndex(ne=>ne.key===p.key)+1])])}})},N=()=>{const S=D(a.headerProps??{}??{}),p=P(()=>h.value.filter(F=>(F==null?void 0:F.sortable)&&!a.disableSort)),x=P(()=>{if(h.value.find(I=>I.key==="data-table-select")!=null)return o.value?"$checkboxOn":r.value?"$checkboxIndeterminate":"$checkboxOff"});return b(he,D({tag:"th",class:[...k.value],colspan:u.value.length+1},S),{default:()=>[b("div",{class:"v-data-table-header__content"},[b(nt,{chips:!0,class:"v-data-table__td-sort-select",clearable:!0,density:"default",items:p.value,label:n("$vuetify.dataTable.sortBy"),multiple:a.multiSort,variant:"underlined","onClick:clear":()=>i.value=[],appendIcon:x.value,"onClick:append":()=>c(!o.value)},{...e,chip:F=>{var I;return b(da,{onClick:(I=F.item.raw)!=null&&I.sortable?()=>s(F.item.raw):void 0,onMousedown:V=>{V.preventDefault(),V.stopPropagation()}},{default:()=>[F.item.title,b(Se,{class:["v-data-table__td-sort-icon",l(F.item.raw)&&"v-data-table__td-sort-icon-active"],icon:w(F.item.raw),size:"small"},null)]})}})])]})};ee(()=>C.value?b("tr",null,[b(N,null,null)]):b(X,null,[e.headers?e.headers(_.value):u.value.map((S,p)=>b("tr",null,[S.map((x,F)=>b(E,{column:x,x:F,y:p},null))])),a.loading&&b("tr",{class:"v-data-table-progress"},[b("th",{colspan:h.value.length},[b(ra,{name:"v-data-table-progress",absolute:!0,active:!0,color:typeof a.loading=="boolean"?void 0:a.loading,indeterminate:!0},{default:e.loader})])])]))}}),Wa=M({groupBy:{type:Array,default:()=>[]}},"DataTable-group"),vt=Symbol.for("vuetify:data-table-group");function Ka(a){return{groupBy:K(a,"groupBy")}}function qa(a){const{disableSort:t,groupBy:e,sortBy:n}=a,s=H(new Set),i=P(()=>e.value.map(f=>({...f,order:f.order??!1})).concat(t!=null&&t.value?[]:n.value));function l(f){return s.value.has(f.id)}function r(f){const h=new Set(s.value);l(f)?h.delete(f.id):h.add(f.id),s.value=h}function o(f){function h(u){const m=[];for(const g of u.items)"type"in g&&g.type==="group"?m.push(...h(g)):m.push(g);return m}return h({items:f})}const c={sortByWithGroups:i,toggleGroup:r,opened:s,groupBy:e,extractRows:o,isGroupOpen:l};return ae(vt,c),c}function bt(){const a=te(vt);if(!a)throw new Error("Missing group!");return a}function Qa(a,t){if(!a.length)return[];const e=new Map;for(const n of a){const s=fe(n.raw,t);e.has(s)||e.set(s,[]),e.get(s).push(n)}return e}function yt(a,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"root";if(!t.length)return[];const s=Qa(a,t[0]),i=[],l=t.slice(1);return s.forEach((r,o)=>{const c=t[0],f=`${n}_${c}_${o}`;i.push({depth:e,id:f,key:c,value:o,items:l.length?yt(r,l,e+1,f):r,type:"group"})}),i}function wt(a,t){const e=[];for(const n of a)"type"in n&&n.type==="group"?(n.value!=null&&e.push(n),(t.has(n.id)||n.value==null)&&e.push(...wt(n.items,t))):e.push(n);return e}function Ja(a,t,e){return{flatItems:P(()=>{if(!t.value.length)return a.value;const s=yt(a.value,t.value.map(i=>i.key));return wt(s,e.value)})}}const Za=M({item:{type:Object,required:!0}},"VDataTableGroupHeaderRow"),Xa=q()({name:"VDataTableGroupHeaderRow",props:Za(),setup(a,t){let{slots:e}=t;const{isGroupOpen:n,toggleGroup:s,extractRows:i}=bt(),{isSelected:l,isSomeSelected:r,select:o}=ve(),{columns:c}=ge(),f=P(()=>i([a.item]));return()=>b("tr",{class:"v-data-table-group-header-row",style:{"--v-data-table-group-header-row-depth":a.item.depth}},[c.value.map(h=>{var u,m;if(h.key==="data-table-group"){const g=n(a.item)?"$expand":"$next",w=()=>s(a.item);return((u=e["data-table-group"])==null?void 0:u.call(e,{item:a.item,count:f.value.length,props:{icon:g,onClick:w}}))??b(he,{class:"v-data-table-group-header-row__column"},{default:()=>[b(G,{size:"small",variant:"text",icon:g,onClick:w},null),b("span",null,[a.item.value]),b("span",null,[Be("("),f.value.length,Be(")")])]})}if(h.key==="data-table-select"){const g=l(f.value),w=r(f.value)&&!g,d=v=>o(f.value,v);return((m=e["data-table-select"])==null?void 0:m.call(e,{props:{modelValue:g,indeterminate:w,"onUpdate:modelValue":d}}))??b("td",null,[b(Ce,{modelValue:g,indeterminate:w,"onUpdate:modelValue":d},null)])}return b("td",null,null)})])}}),Ya=M({expandOnClick:Boolean,showExpand:Boolean,expanded:{type:Array,default:()=>[]}},"DataTable-expand"),pt=Symbol.for("vuetify:datatable:expanded");function en(a){const t=A(a,"expandOnClick"),e=K(a,"expanded",a.expanded,r=>new Set(r),r=>[...r.values()]);function n(r,o){const c=new Set(e.value);o?c.add(r.value):c.delete(r.value),e.value=c}function s(r){return e.value.has(r.value)}function i(r){n(r,!s(r))}const l={expand:n,expanded:e,expandOnClick:t,isExpanded:s,toggleExpand:i};return ae(pt,l),l}function St(){const a=te(pt);if(!a)throw new Error("foo");return a}const tn=M({index:Number,item:Object,cellProps:[Object,Function],onClick:ye(),onContextmenu:ye(),onDblclick:ye(),...Fe()},"VDataTableRow"),an=q()({name:"VDataTableRow",props:tn(),setup(a,t){let{slots:e}=t;const{displayClasses:n,mobile:s}=me(a,"v-data-table__tr"),{isSelected:i,toggleSelect:l,someSelected:r,allSelected:o,selectAll:c}=ve(),{isExpanded:f,toggleExpand:h}=St(),{toggleSort:u,sortBy:m,isSorted:g}=mt(),{columns:w}=ge();ee(()=>b("tr",{class:["v-data-table__tr",{"v-data-table__tr--clickable":!!(a.onClick||a.onContextmenu||a.onDblclick)},n.value],onClick:a.onClick,onContextmenu:a.onContextmenu,onDblclick:a.onDblclick},[a.item&&w.value.map((d,v)=>{const y=a.item,C=`item.${d.key}`,_=`header.${d.key}`,k={index:a.index,item:y.raw,internalItem:y,value:fe(y.columns,d.key),column:d,isSelected:i,toggleSelect:l,isExpanded:f,toggleExpand:h},E={column:d,selectAll:c,isSorted:g,toggleSort:u,sortBy:m.value,someSelected:r.value,allSelected:o.value,getSortIcon:()=>""},N=typeof a.cellProps=="function"?a.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value,column:d}):a.cellProps,S=typeof d.cellProps=="function"?d.cellProps({index:k.index,item:k.item,internalItem:k.internalItem,value:k.value}):d.cellProps;return b(he,D({align:d.align,class:{"v-data-table__td--expanded-row":d.key==="data-table-expand","v-data-table__td--select-row":d.key==="data-table-select"},fixed:d.fixed,fixedOffset:d.fixedOffset,lastFixed:d.lastFixed,maxWidth:s.value?void 0:d.maxWidth,noPadding:d.key==="data-table-select"||d.key==="data-table-expand",nowrap:d.nowrap,width:s.value?void 0:d.width},N,S),{default:()=>{var x,F,I,V,Q;if(e[C]&&!s.value)return(x=e[C])==null?void 0:x.call(e,k);if(d.key==="data-table-select")return((F=e["item.data-table-select"])==null?void 0:F.call(e,k))??b(Ce,{disabled:!y.selectable,modelValue:i([y]),onClick:Oe(()=>l(y),["stop"])},null);if(d.key==="data-table-expand")return((I=e["item.data-table-expand"])==null?void 0:I.call(e,k))??b(G,{icon:f(y)?"$collapse":"$expand",size:"small",variant:"text",onClick:Oe(()=>h(y),["stop"])},null);const p=ca(k.value);return s.value?b(X,null,[b("div",{class:"v-data-table__td-title"},[((V=e[_])==null?void 0:V.call(e,E))??d.title]),b("div",{class:"v-data-table__td-value"},[((Q=e[C])==null?void 0:Q.call(e,k))??p])]):p}})})]))}}),xt=M({loading:[Boolean,String],loadingText:{type:String,default:"$vuetify.dataIterator.loadingText"},hideNoData:Boolean,items:{type:Array,default:()=>[]},noDataText:{type:String,default:"$vuetify.noDataText"},rowProps:[Object,Function],cellProps:[Object,Function],...Fe()},"VDataTableRows"),Ge=q()({name:"VDataTableRows",inheritAttrs:!1,props:xt(),setup(a,t){let{attrs:e,slots:n}=t;const{columns:s}=ge(),{expandOnClick:i,toggleExpand:l,isExpanded:r}=St(),{isSelected:o,toggleSelect:c}=ve(),{toggleGroup:f,isGroupOpen:h}=bt(),{t:u}=Y(),{mobile:m}=me(a);return ee(()=>{var g,w;return a.loading&&(!a.items.length||n.loading)?b("tr",{class:"v-data-table-rows-loading",key:"loading"},[b("td",{colspan:s.value.length},[((g=n.loading)==null?void 0:g.call(n))??u(a.loadingText)])]):!a.loading&&!a.items.length&&!a.hideNoData?b("tr",{class:"v-data-table-rows-no-data",key:"no-data"},[b("td",{colspan:s.value.length},[((w=n["no-data"])==null?void 0:w.call(n))??u(a.noDataText)])]):b(X,null,[a.items.map((d,v)=>{var _;if(d.type==="group"){const k={index:v,item:d,columns:s.value,isExpanded:r,toggleExpand:l,isSelected:o,toggleSelect:c,toggleGroup:f,isGroupOpen:h};return n["group-header"]?n["group-header"](k):b(Xa,D({key:`group-header_${d.id}`,item:d},Ee(e,":group-header",()=>k)),n)}const y={index:v,item:d.raw,internalItem:d,columns:s.value,isExpanded:r,toggleExpand:l,isSelected:o,toggleSelect:c},C={...y,props:D({key:`item_${d.key??d.index}`,onClick:i.value?()=>{l(d)}:void 0,index:v,item:d,cellProps:a.cellProps,mobile:m.value},Ee(e,":row",()=>y),typeof a.rowProps=="function"?a.rowProps({item:y.item,index:y.index,internalItem:y.internalItem}):a.rowProps)};return b(X,{key:C.props.key},[n.item?n.item(C):b(an,C.props,n),r(d)&&((_=n["expanded-row"])==null?void 0:_.call(n,y))])})])}),{}}}),nn=M({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},rowProps:[Object,Function],cellProps:[Object,Function],returnObject:Boolean},"DataTable-items");function sn(a,t,e,n){const s=a.returnObject?t:le(t,a.itemValue),i=le(t,a.itemSelectable,!0),l=n.reduce((r,o)=>(o.key!=null&&(r[o.key]=le(t,o.value)),r),{});return{type:"item",key:a.returnObject?le(t,a.itemValue):s,index:e,value:s,selectable:i,columns:l,raw:t}}function ln(a,t,e){return t.map((n,s)=>sn(a,n,s,e))}function rn(a,t){return{items:P(()=>ln(a,a.items,t.value))}}function on(a){let{page:t,itemsPerPage:e,sortBy:n,groupBy:s,search:i}=a;const l=et("VDataTable"),r=P(()=>({page:t.value,itemsPerPage:e.value,sortBy:n.value,groupBy:s.value,search:i.value}));let o=null;Pe(r,()=>{at(o,r.value)||(o&&o.search!==r.value.search&&(t.value=1),l.emit("update:options",r.value),o=r.value)},{deep:!0,immediate:!0})}const cn=(a,t,e)=>a==null||t==null?-1:a.toString().toLocaleLowerCase().indexOf(t.toString().toLocaleLowerCase()),un=M({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function dn(a,t,e){var r;const n=[],s=(e==null?void 0:e.default)??cn,i=e!=null&&e.filterKeys?re(e.filterKeys):!1,l=Object.keys((e==null?void 0:e.customKeyFilter)??{}).length;if(!(a!=null&&a.length))return n;e:for(let o=0;o<a.length;o++){const[c,f=c]=re(a[o]),h={},u={};let m=-1;if((t||l>0)&&!(e!=null&&e.noFilter)){if(typeof c=="object"){const d=i||Object.keys(f);for(const v of d){const y=le(f,v),C=(r=e==null?void 0:e.customKeyFilter)==null?void 0:r[v];if(m=C?C(y,t,c):s(y,t,c),m!==-1&&m!==!1)C?h[v]=m:u[v]=m;else if((e==null?void 0:e.filterMode)==="every")continue e}}else m=s(c,t,c),m!==-1&&m!==!1&&(u.title=m);const g=Object.keys(u).length,w=Object.keys(h).length;if(!g&&!w||(e==null?void 0:e.filterMode)==="union"&&w!==l&&!g||(e==null?void 0:e.filterMode)==="intersection"&&(w!==l||!g))continue}n.push({index:o,matches:{...u,...h}})}return n}function fn(a,t,e,n){const s=H([]),i=H(new Map),l=P(()=>n!=null&&n.transform?ie(t).map(o=>[o,n.transform(o)]):ie(t));tt(()=>{const o=typeof e=="function"?e():ie(e),c=typeof o!="string"&&typeof o!="number"?"":String(o),f=dn(l.value,c,{customKeyFilter:{...a.customKeyFilter,...ie(n==null?void 0:n.customKeyFilter)},default:a.customFilter,filterKeys:a.filterKeys,filterMode:a.filterMode,noFilter:a.noFilter}),h=ie(t),u=[],m=new Map;f.forEach(g=>{let{index:w,matches:d}=g;const v=h[w];u.push(v),m.set(v.value,d)}),s.value=u,i.value=m});function r(o){return i.value.get(o.value)}return{filteredItems:s,filteredMatches:i,getMatches:r}}const hn=M({...xt(),hideDefaultBody:Boolean,hideDefaultFooter:Boolean,hideDefaultHeader:Boolean,width:[String,Number],search:String,...Ya(),...Wa(),...Ma(),...nn(),...Ea(),...Na(),...gt(),...ha()},"DataTable"),mn=M({...Ca(),...hn(),...un(),...it()},"VDataTable"),Cn=q()({name:"VDataTable",props:mn(),emits:{"update:modelValue":a=>!0,"update:page":a=>!0,"update:itemsPerPage":a=>!0,"update:sortBy":a=>!0,"update:options":a=>!0,"update:groupBy":a=>!0,"update:expanded":a=>!0,"update:currentItems":a=>!0},setup(a,t){let{attrs:e,slots:n}=t;const{groupBy:s}=Ka(a),{sortBy:i,multiSort:l,mustSort:r}=ja(a),{page:o,itemsPerPage:c}=Ta(a),{disableSort:f}=ua(a),{columns:h,headers:u,sortFunctions:m,sortRawFunctions:g,filterFunctions:w}=Oa(a,{groupBy:s,showSelect:A(a,"showSelect"),showExpand:A(a,"showExpand")}),{items:d}=rn(a,h),v=A(a,"search"),{filteredItems:y}=fn(a,d,v,{transform:U=>U.columns,customKeyFilter:w}),{toggleSort:C}=Ha({sortBy:i,multiSort:l,mustSort:r,page:o}),{sortByWithGroups:_,opened:k,extractRows:E,isGroupOpen:N,toggleGroup:S}=qa({groupBy:s,sortBy:i,disableSort:f}),{sortedItems:p}=Ua(a,y,_,{transform:U=>({...U.raw,...U.columns}),sortFunctions:m,sortRawFunctions:g}),{flatItems:x}=Ja(p,s,k),F=P(()=>x.value.length),{startIndex:I,stopIndex:V,pageCount:Q,setItemsPerPage:oe}=Ia({page:o,itemsPerPage:c,itemsLength:F}),{paginatedItems:Z}=Aa({items:x,startIndex:I,stopIndex:V,itemsPerPage:c}),ne=P(()=>E(Z.value)),{isSelected:kt,select:Pt,selectAll:Ft,toggleSelect:Ct,someSelected:Tt,allSelected:It}=Ra(a,{allItems:d,currentPage:ne}),{isExpanded:_t,toggleExpand:At}=en(a);on({page:o,itemsPerPage:c,sortBy:i,groupBy:s,search:v}),xe({VDataTableRows:{hideNoData:A(a,"hideNoData"),noDataText:A(a,"noDataText"),loading:A(a,"loading"),loadingText:A(a,"loadingText")}});const R=P(()=>({page:o.value,itemsPerPage:c.value,sortBy:i.value,pageCount:Q.value,toggleSort:C,setItemsPerPage:oe,someSelected:Tt.value,allSelected:It.value,isSelected:kt,select:Pt,selectAll:Ft,toggleSelect:Ct,isExpanded:_t,toggleExpand:At,isGroupOpen:N,toggleGroup:S,items:ne.value.map(U=>U.raw),internalItems:ne.value,groupedItems:Z.value,columns:h.value,headers:u.value}));return ee(()=>{const U=He.filterProps(a),Mt=Ue.filterProps(a),Dt=Ge.filterProps(a),Vt=ze.filterProps(a);return b(ze,D({class:["v-data-table",{"v-data-table--show-select":a.showSelect,"v-data-table--loading":a.loading},a.class],style:a.style},Vt),{top:()=>{var se;return(se=n.top)==null?void 0:se.call(n,R.value)},default:()=>{var se,Ie,_e,Ae,Me,De;return n.default?n.default(R.value):b(X,null,[(se=n.colgroup)==null?void 0:se.call(n,R.value),!a.hideDefaultHeader&&b("thead",{key:"thead"},[b(Ue,Mt,n)]),(Ie=n.thead)==null?void 0:Ie.call(n,R.value),!a.hideDefaultBody&&b("tbody",null,[(_e=n["body.prepend"])==null?void 0:_e.call(n,R.value),n.body?n.body(R.value):b(Ge,D(e,Dt,{items:Z.value}),n),(Ae=n["body.append"])==null?void 0:Ae.call(n,R.value)]),(Me=n.tbody)==null?void 0:Me.call(n,R.value),(De=n.tfoot)==null?void 0:De.call(n,R.value)])},bottom:()=>n.bottom?n.bottom(R.value):!a.hideDefaultFooter&&b(X,null,[b(fa,null,null),b(He,U,{prepend:n["footer.prepend"]})])})}),{}}});export{Cn as V,J as a,Pn as b,je as c,Fn as d,xn as e,kn as m};
