import{d as U,r as E,aH as V,c as u,B as m,b as L,a as N,o as b,e as _,f as c,h as g,u as h,i as M,V as A,k as I,_ as w,aN as J,F as C,C as P}from"./index-BMVER-wz.js";import{a as D}from"./axios-CCb-kr4I.js";import{a as O}from"./assets-xkPoxekU.js";import{g as Q}from"./getRegexFilterFn-CU_0py8y.js";import{b as z}from"./betterSplit-CW8NIeFU.js";import{V as y}from"./VTextField-kItJq7Ui.js";import{_ as G}from"./InfiniteScroll.vue_vue_type_script_setup_true_lang-Dq4Br4UP.js";import"./VInput-B9t60o-Y.js";import"./forwardRefs-DWGaNmQL.js";function q(l,i,e="application/octet-stream"){const s=document.createElement("a"),n=new Blob([l],{type:e});s.href=URL.createObjectURL(n),s.download=i,s.click()}function v(l,i,e="",s=!1){const d=(e?`color: ${e};`:"")+(s?"font-weight: bold;":""),t=d?` style='${d}'`:"";return`<${i}${t}>${l}</${i}>`}function K(l){const i=l.map(e=>`(?:${e})`).join("|");return RegExp(i)}const x=v("<br>","div"),B=U("calStore",()=>{const l=E([]),i=V("positive",""),e=V("negative",""),s=V("highlight",""),n=u(()=>({positive:i.value,negative:e.value,highlight:s.value}));F();const o=u(()=>m.mapValues(n.value,Y)),d=u(()=>!o.value.positive.length&&!o.value.negative.length),t=u(()=>Q(o.value.positive.map(a=>RegExp(a)),o.value.negative.map(a=>RegExp(a)))),r=u(()=>d.value?[]:l.value.filter(a=>t.value(a.contentsString))),S=u(()=>{const a=m.mapValues(o.value,p=>p.some(m.identity)&&p.join(", "));return[a.positive&&`Should contain: ${a.positive}`,a.negative&&`Should not contain: ${a.negative}`,a.highlight&&`Highlight: ${a.highlight}`].filter(Boolean).map(p=>v(p,"div","brown",!0))}),T=u(()=>{if(!r.value.length)return"";const a=[`Total: ${r.value.length} entries`].map(f=>v(f,"div","green",!0)),p=v("=".repeat(25),"div");return[...S.value,a,p].join(x)}),R=u(()=>m.values(o.value).flat()),j=u(()=>K(R.value)),$=u(()=>{if(!r.value.length)return[];const a=r.value.map(X(j.value));return[T.value,x,...a]}),H=u(()=>$.value.join(""));async function F(){const a=`=============
`,{data:p}=await D.get(O.calJson.link);l.value=p.split(a).filter(Boolean).map(f=>f.split(`
`)).map(([f,...k])=>({entryName:f.replace(/\.txt$/,""),contents:k,contentsString:k.join(`
`)}))}return{cal:l,positive:i,negative:e,highlight:s,searchers:n,searchObj:o,isNoSearch:d,calMatchingParts:$,calMatchingHTML:H}});function W(l){return function(i){const e=z(i,l).reduce((s,n,o)=>{const d=o%2?"red":"",t=o%2;return s+v(n,"span",d,t)},"");return v(e,"div")}}function X(l){return function({entryName:i,contents:e}){const s=v("+".repeat(25),"div","blue"),n=v(i,"div","purple",!0),o=e.map(W(l));return[n,...o,s,x].join("")}}function Y(l){return m.chain(l).split(",").map(m.trim).compact().value()}const Z={class:"inputs"},tt={class:"input-block"},et={class:"input-block"},nt={class:"input-block"},ot=L({__name:"CalInputs",emits:["download"],setup(l,{emit:i}){const e=B(),s=i,n=N(e.searchers),o=m.debounce(()=>{m.assign(e,n)},1e3);return(d,t)=>(b(),_("div",Z,[c("div",tt,[t[4]||(t[4]=c("div",{class:"input-block__title"},"Should contain:   ",-1)),g(y,{modelValue:n.positive,"onUpdate:modelValue":[t[0]||(t[0]=r=>n.positive=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[5]||(t[5]=c("div",{class:"input-block__hint"},"e.g. Gal, Sam, CPA ",-1))]),c("div",et,[t[6]||(t[6]=c("div",{class:"input-block__title"},"Should not contain:   ",-1)),g(y,{modelValue:n.negative,"onUpdate:modelValue":[t[1]||(t[1]=r=>n.negative=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[7]||(t[7]=c("div",{class:"input-block__hint"},"e.g. Syr, JBA, Man, Com",-1))]),c("div",nt,[t[8]||(t[8]=c("div",{class:"input-block__title"},"Also highlight:   ",-1)),g(y,{modelValue:n.highlight,"onUpdate:modelValue":[t[2]||(t[2]=r=>n.highlight=r),h(o)],variant:"outlined",density:"compact",autocomplete:"no",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),t[9]||(t[9]=c("div",{class:"input-block__hint"},"e.g. LJLA, Qumran, Jud",-1))]),g(A,{disabled:h(e).isNoSearch,color:"green",variant:"outlined",class:"button",size:"large",onClick:t[3]||(t[3]=r=>s("download"))},{default:M(()=>t[10]||(t[10]=[I(" Download ")])),_:1},8,["disabled"])]))}}),at=w(ot,[["__scopeId","data-v-b21a4d58"]]),lt=["innerHTML"],it=L({__name:"CalSearch",setup(l){const i=B(),{calMatchingParts:e,calMatchingHTML:s}=J(i),n=()=>{q(s.value,"result.html")};return(o,d)=>(b(),_(C,null,[g(h(at),{onDownload:n}),g(G,{items:h(e),class:"search-results-box"},{default:M(({items:t})=>[(b(!0),_(C,null,P(t,(r,S)=>(b(),_("div",{key:S},[c("div",{innerHTML:r},null,8,lt)]))),128))]),_:1},8,["items"])],64))}}),ht=w(it,[["__scopeId","data-v-f894bcc4"]]);export{ht as default};
