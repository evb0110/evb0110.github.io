var U=Object.defineProperty;var X=(t,e,n)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>X(t,typeof e!="symbol"?e+"":e,n);import{aF as H,c as w,E as N,d as Q,r as b,aG as Y}from"./index-CzBZoTs2.js";import{u as q,a as v}from"./assetsStore-0sI2KEP-.js";import{u as $}from"./index-DGJnRSqf.js";const Z=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/gu,ee=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/u,te=/(?![\u0701-\u0709]|[\u0730-\u074c])[^\p{M}]/u;class g{constructor(e){m(this,"id",H());m(this,"str");m(this,"_nfd",null);m(this,"_stripped",null);m(this,"_chunks",null);this.str=e}static addFlagIfAbsent(e,n){return e.includes(n)?e:e+n}get nfd(){return this._nfd||this.cacheNFD(),this._nfd}get stripped(){return this._stripped||this.cacheStripped(),this._stripped}get chunks(){return this._chunks||this.cacheChunks(),this._chunks||[]}cacheNFD(){this._nfd||(this._nfd=this.str.normalize("NFD"))}cacheStripped(){var e;this._stripped||(this._stripped=((e=this.nfd)==null?void 0:e.replace(Z,""))||"")}cacheChunks(){this._chunks||(this._chunks=this.str===this.stripped?this.str.split(""):this.makeNFDChunks())}makeNFDChunks(){var r;const e=((r=this.nfd)==null?void 0:r.split(""))||[],n=[];let s=0;n[s]="";for(let i=0;i<e.length;i++)n[s]+=e[i],i+1<e.length&&!ee.test(e[i+1])&&te.test(n[s])&&(s++,n[s]="");return n}splitInclusive(e){e=RegExp(e.source,g.addFlagIfAbsent(e.flags,"g"));const n=Array.from(this.stripped.matchAll(e)),s=[];let r=0;for(const i of n){const o=i[0].length,c=i.index;s.push(this.chunks.slice(r,c).join("")),s.push(this.chunks.slice(c,c+o).join("")),r=c+o}return s.push(this.chunks.slice(r).join("")),s}}const B=(t,e)=>e.some(n=>t instanceof n);let P,x;function ne(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function se(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M=new WeakMap,C=new WeakMap,I=new WeakMap;function re(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(p(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return I.set(e,t),e}function ie(t){if(M.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});M.set(t,e)}let A={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return M.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function O(t){A=t(A)}function oe(t){return se().includes(t)?function(...e){return t.apply(_(this),e),p(this.request)}:function(...e){return p(t.apply(_(this),e))}}function ae(t){return typeof t=="function"?oe(t):(t instanceof IDBTransaction&&ie(t),B(t,ne())?new Proxy(t,A):t)}function p(t){if(t instanceof IDBRequest)return re(t);if(C.has(t))return C.get(t);const e=ae(t);return e!==t&&(C.set(t,e),I.set(e,t)),e}const _=t=>I.get(t);function ce(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),c=p(o);return s&&o.addEventListener("upgradeneeded",a=>{s(p(o.result),a.oldVersion,a.newVersion,p(o.transaction),a)}),n&&o.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),c.then(a=>{i&&a.addEventListener("close",()=>i()),r&&a.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const ue=["get","getKey","getAll","getAllKeys","count"],le=["put","add","delete","clear"],S=new Map;function R(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(S.get(e))return S.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=le.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||ue.includes(n)))return;const i=async function(o,...c){const a=this.transaction(o,r?"readwrite":"readonly");let u=a.store;return s&&(u=u.index(c.shift())),(await Promise.all([u[n](...c),r&&a.done]))[0]};return S.set(e,i),i}O(t=>({...t,get:(e,n,s)=>R(e,n)||t.get(e,n,s),has:(e,n)=>!!R(e,n)||t.has(e,n)}));const de=["continue","continuePrimaryKey","advance"],T={},L=new WeakMap,W=new WeakMap,he={get(t,e){if(!de.includes(e))return t[e];let n=T[e];return n||(n=T[e]=function(...s){L.set(this,W.get(this)[e](...s))}),n}};async function*fe(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,he);for(W.set(n,e),I.set(n,_(e));e;)yield n,e=await(L.get(n)||e.continue()),L.delete(n)}function F(t,e){return e===Symbol.asyncIterator&&B(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&B(t,[IDBIndex,IDBObjectStore])}O(t=>({...t,get(e,n,s){return F(e,n)?fe:t.get(e,n,s)},has(e,n){return F(e,n)||t.has(e,n)}}));const pe="aramaic-site",f="store",y=ce(pe,1,{upgrade(t){if(!t.objectStoreNames.contains(f))return t.createObjectStore(f)}});class j{static async get(e){return(await y).get(f,e)}static async set(e,n){return(await y).put(f,n,e)}static async delete(e){return(await y).delete(f,e)}static async clear(){return(await y).clear(f)}static async keys(){return(await y).getAllKeys(f)}}const E=(t,e)=>{const n=$(t),s=w({get:()=>{switch(n.value){case"true":return!0;case"false":return!1}},set:r=>{switch(r){case!0:n.value="true";break;case!1:n.value="false";break}}});return N.isBoolean(e)&&(s.value=e),s},me="ʔbgdhYwzḥṭyklmnsʕpṣqršt",ye="AbgdhYwzHTyklmnsCpSqrWt",we="ܐܒܓܕܗܞܘܙܚܛܝܟܠܡܢܣܥܦܨܩܪܫܬ",[K,V,J]=[me,ye,we].map(t=>t.split("")),ve={translitArr:K,translitAnsiArr:V,originalLettersArr:J},Ce={pot:{name:"POT with Western vowels",link:v.potJson.link},pnt:{name:"PNT with Western vowels",link:v.pntJson.link},syr:{name:"Syriac Corpus",link:v.syrJson.link}},Se=Q("syriacCorpusStore",()=>{const t=q(),e=b([]),n=b(""),s=b(!1),r=E("simpleSymbols"),i=E("translit"),o=E("ignoreDiacritics"),c=w(()=>r.value?V:K),a=w(()=>{const l=n.value;return o.value?i.value?c.value.reduce((h,D,d)=>{const k=J[d],z=RegExp("(?<!\\\\)"+D,"gu");return h.replace(z,k)},l):new g(l).stripped:l}),u=w(()=>{if(!n.value)return[];const l=RegExp(a.value,"u");return o.value?e.value.filter(h=>l.test(h.line.stripped)):e.value.filter(h=>l.test(h.line.str))});async function G(l){e.value=[],s.value=!0;const h=l.map(d=>{switch(d){case"pot":return"potJson";case"pnt":return"pntJson";case"syr":return"syrJson";default:return null}}).flatMap(d=>d&&t[d].data||[]),D=await ge(h);e.value=D.map(({filename:d,line:k})=>({filename:d,line:new g(k)})),s.value=!1}return{corpus:e,searchString:n,isPreprocessingSyriacCorpus:s,isSimpleSymbols:r,isTranslit:i,doIgnoreDiacritics:o,activeTranslitArr:c,finalSearchString:a,matchingSyriacLines:u,initSyriacCorpus:G}});async function ge(t){const e=await Y(t),n=await j.get("syriacCorpus")||{},s=n[e];if(s)return s;const r=t.flatMap(({filename:i,text:o})=>o.split(/\n+/).map(N.trim).map(c=>({filename:i,line:c})));return n[e]=r,await j.set("syriacCorpus",n),r}export{j as I,Ce as S,E as a,ve as s,Se as u};
