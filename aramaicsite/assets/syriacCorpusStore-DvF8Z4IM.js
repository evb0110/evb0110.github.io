var U=Object.defineProperty;var X=(t,e,n)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>X(t,typeof e!="symbol"?e+"":e,n);import{aL as z,d as J,Y as y,c as k,aM as Y,E as H}from"./index-B2Sys05F.js";import{a as $}from"./axios-CCb-kr4I.js";import{a as C}from"./assets-dmyLWxaO.js";const q=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/gu,Q=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/u,Z=/(?![\u0701-\u0709]|[\u0730-\u074c])[^\p{M}]/u;class A{constructor(e){m(this,"id",z());m(this,"str");m(this,"_nfd",null);m(this,"_stripped",null);m(this,"_chunks",null);this.str=e}static addFlagIfAbsent(e,n){return e.includes(n)?e:e+n}get nfd(){return this._nfd||this.cacheNFD(),this._nfd}get stripped(){return this._stripped||this.cacheStripped(),this._stripped}get chunks(){return this._chunks||this.cacheChunks(),this._chunks}cacheNFD(){this._nfd||(this._nfd=this.str.normalize("NFD"))}cacheStripped(){this._stripped||(this._stripped=this.nfd.replace(q,""))}cacheChunks(){this._chunks||(this._chunks=this.str===this.stripped?this.str.split(""):this.makeNFDChunks())}makeNFDChunks(){const e=this.nfd.split(""),n=[];let s=0;n[s]="";for(let r=0;r<e.length;r++)n[s]+=e[r],r+1<e.length&&!Q.test(e[r+1])&&Z.test(n[s])&&(s++,n[s]="");return n}splitInclusive(e){e=RegExp(e.source,A.addFlagIfAbsent(e.flags,"g"));const n=Array.from(this.stripped.matchAll(e)),s=[];let r=0;for(const o of n){const i=o[0].length,c=o.index;s.push(this.chunks.slice(r,c).join("")),s.push(this.chunks.slice(c,c+i).join("")),r=c+i}return s.push(this.chunks.slice(r).join("")),s}}const M=(t,e)=>e.some(n=>t instanceof n);let P,x;function ee(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function te(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const v=new WeakMap,E=new WeakMap,w=new WeakMap;function ne(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",i)},o=()=>{n(p(t.result)),r()},i=()=>{s(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",i)});return w.set(e,t),e}function se(t){if(v.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",i),t.removeEventListener("abort",i)},o=()=>{n(),r()},i=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",i),t.addEventListener("abort",i)});v.set(t,e)}let S={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return v.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function j(t){S=t(S)}function re(t){return te().includes(t)?function(...e){return t.apply(_(this),e),p(this.request)}:function(...e){return p(t.apply(_(this),e))}}function ie(t){return typeof t=="function"?re(t):(t instanceof IDBTransaction&&se(t),M(t,ee())?new Proxy(t,S):t)}function p(t){if(t instanceof IDBRequest)return ne(t);if(E.has(t))return E.get(t);const e=ie(t);return e!==t&&(E.set(t,e),w.set(e,t)),e}const _=t=>w.get(t);function oe(t,e,{blocked:n,upgrade:s,blocking:r,terminated:o}={}){const i=indexedDB.open(t,e),c=p(i);return s&&i.addEventListener("upgradeneeded",a=>{s(p(i.result),a.oldVersion,a.newVersion,p(i.transaction),a)}),n&&i.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),c.then(a=>{o&&a.addEventListener("close",()=>o()),r&&a.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}const ce=["get","getKey","getAll","getAllKeys","count"],ae=["put","add","delete","clear"],b=new Map;function R(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(b.get(e))return b.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=ae.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||ce.includes(n)))return;const o=async function(i,...c){const a=this.transaction(i,r?"readwrite":"readonly");let u=a.store;return s&&(u=u.index(c.shift())),(await Promise.all([u[n](...c),r&&a.done]))[0]};return b.set(e,o),o}j(t=>({...t,get:(e,n,s)=>R(e,n)||t.get(e,n,s),has:(e,n)=>!!R(e,n)||t.has(e,n)}));const ue=["continue","continuePrimaryKey","advance"],T={},B=new WeakMap,O=new WeakMap,le={get(t,e){if(!ue.includes(e))return t[e];let n=T[e];return n||(n=T[e]=function(...s){B.set(this,O.get(this)[e](...s))}),n}};async function*de(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,le);for(O.set(n,e),w.set(n,_(e));e;)yield n,e=await(B.get(n)||e.continue()),B.delete(n)}function F(t,e){return e===Symbol.asyncIterator&&M(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&M(t,[IDBIndex,IDBObjectStore])}j(t=>({...t,get(e,n,s){return F(e,n)?de:t.get(e,n,s)},has(e,n){return F(e,n)||t.has(e,n)}}));const he="aramaic-site",f="store",g=oe(he,1,{upgrade(t){if(!t.objectStoreNames.contains(f))return t.createObjectStore(f)}});class N{static async get(e){return(await g).get(f,e)}static async set(e,n){return(await g).put(f,n,e)}static async delete(e){return(await g).delete(f,e)}static async clear(){return(await g).clear(f)}static async keys(){return(await g).getAllKeys(f)}}const fe="ʔbgdhYwzḥṭyklmnsʕpṣqršt",pe="AbgdhYwzHTyklmnsCpSqrWt",me="ܐܒܓܕܗܞܘܙܚܛܝܟܠܡܢܣܥܦܨܩܪܫܬ",[K,W,V]=[fe,pe,me].map(t=>t.split("")),Ee={translitArr:K,translitAnsiArr:W,originalLettersArr:V},ye={pot:{name:"POT with Western vowels",link:C.potJson.link},pnt:{name:"PNT with Western vowels",link:C.pntJson.link},syr:{name:"Syriac Corpus",link:C.syrJson.link}},ge=/[\p{M}]|[\u0700-\u070F]|[\u0730-\u074c]/gu,be=J("syriacCorpusStore",()=>{const t=y([]),e=y(""),n=y(!1),s=y(!0),r=y(!0),o=y(!0),i=k(()=>s.value?W:K),c=k(()=>{const l=e.value;return o.value?r.value?i.value.reduce((d,L,I)=>{const D=V[I],h=RegExp("(?<!\\\\)"+L,"gu");return d.replace(h,D)},l):l.replace(ge,""):l}),a=k(()=>{if(!e.value)return[];const l=RegExp(c.value,"u");return o.value?t.value.filter(d=>l.test(d.line.stripped)):t.value.filter(d=>l.test(d.line.str))});async function u(l){t.value=[],n.value=!0;const d=l.map(h=>$.get(ye[h].link)),I=(await Promise.all(d)).flatMap(({data:h})=>h),D=await we(I);t.value=D.map(({filename:h,line:G})=>({filename:h,line:new A(G)})),n.value=!1,e.value=""}return{corpus:t,searchString:e,isPreprocessingSyriacCorpus:n,isSimpleSymbols:s,isTranslit:r,doIgnoreDiacritics:o,activeTranslitArr:i,finalSearchString:c,matchingSyriacLines:a,initSyriacCorpus:u}});async function we(t){const e=await Y(t),n=await N.get("syriacCorpus")||{},s=n[e];if(s)return s;const r=t.flatMap(({filename:o,text:i})=>i.split(/\n+/).map(H.trim).map(c=>({filename:o,line:c})));return n[e]=r,await N.set("syriacCorpus",n),r}export{N as I,ye as S,Ee as s,be as u};
