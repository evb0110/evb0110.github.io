var he=Object.defineProperty;var pe=(a,e,s)=>e in a?he(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var w=(a,e,s)=>pe(a,typeof e!="symbol"?e+"":e,s);import{bG as fe,y as D,d as be,a1 as ye,c as d,a2 as ee,Y as ge,r as S,m as g,b as B,bH as ie,o as u,f as h,F as I,i as H,v as $,h as T,j,k as K,V as F,p as M,at as J,aA as ce,g as k,l as P,n as x,_ as A,ax as E,bI as xe,e as de,bC as _e,bJ as ve,aB as G,a4 as te,W as Q,as as we,I as ke,bn as Se,t as Ne,bK as Le,P as Ve,Q as se,X as Ce,aj as qe}from"./index-DGANnDqU.js";import{u as U}from"./index-BTE9H53T.js";import{u as $e,L as ae,D as le,K as ne,a as Te,b as R,G as Be,s as Ae,S as oe}from"./GrepLine-DMCrghql.js";import{V as re}from"./VSelect-PlSDLsrv.js";import{_ as Me,I as Ee}from"./InfiniteScroll.vue_vue_type_script_setup_true_lang-CmlvsMHc.js";import{_ as Ie}from"./CopyResults-DJq3meB-.js";class X{constructor({volume:e,texts:s}){w(this,"volumeName");w(this,"texts");this.texts=s.map(n=>({volumeName:e,...n})).map(Y.instantiate),this.volumeName=e}get totalContents(){return D.flatMap(this.texts,"contents")}static instantiate(e){return new X(e)}}class Y{constructor({volumeName:e,textNumber:s,textName:n,contents:l}){w(this,"volumeName");w(this,"textNumber");w(this,"_textName");w(this,"rawContents");this.volumeName=e,this.textNumber=s,this._textName=n,this.rawContents=l}get contents(){return this.rawContents.map(e=>({volumeName:this.volumeName,textNumber:this.textNumber,textName:this.textName,...e})).map(Z.instantiate)}get textName(){return this._textName.replace(/\.txt/,"")}set textName(e){this._textName=e}static instantiate(e){return new Y(e)}}class Z{constructor({volumeName:e,textNumber:s,textName:n,lineNumber:l,textus:t,versio:r}){w(this,"volumeName");w(this,"textNumber");w(this,"textName");w(this,"lineNumber");w(this,"textus");w(this,"versio");this.volumeName=e,this.textNumber=s,this.textName=n,this.lineNumber=l,this.textus=t,this.versio=r}get title(){return this.volumeName+": "+this.textName}get hash(){return"h"+fe(this)}static instantiate(e){return new Z(e)}}const De=be("corpusWithTranslationStore",()=>{const a=ye(),e=$e(),s=d(()=>{switch(e.value){case ae.maalula:return ee.maalulaCorpusJson;case ae.turoyo:default:return ee.turoyoNewCorpusJson}}),n=d(()=>a[s.value]),l=d(()=>{var o;return(o=n.value)==null?void 0:o.data}),t=d(()=>{var o;return((o=n.value)==null?void 0:o.isLoading)||!1}),r=d(()=>{var o;return((o=n.value)==null?void 0:o.error)||null}),c=ge(()=>{var o;return((o=l.value)==null?void 0:o.map(X.instantiate))||[]},[]),m=d(()=>D.flatMap(c.value,"totalContents"));return{corpusArray:c,corpusLines:m,isLoading:t,error:r}}),Re=(a,e)=>{const s=S(a.indexOf(g(e))||0),n=d(()=>a[s.value]);function l(){s.value=(s.value+1)%a.length}return function(){return l(),n.value}},He={class:"d-flex ga-1"},Ke=B({__name:"ModeSwitcher",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(a){const e=ie(a,"modelValue"),s=Re(le,e);function n(){e.value=s()}return(l,t)=>(u(),h("div",He,[(u(!0),h(I,null,H(g(le),r=>(u(),$(F,{key:r,variant:r===e.value?"outlined":"text",class:"d-none d-sm-block",size:"small",onClick:c=>e.value=r},{default:T(()=>[j(K(r)+" mode ",1)]),_:2},1032,["variant","onClick"]))),128)),e.value?(u(),$(F,{key:0,class:"d-sm-none",variant:"outlined",onClick:t[0]||(t[0]=r=>n())},{default:T(()=>[j(K(e.value)+" mode ",1)]),_:1})):M("",!0)]))}}),Ue={class:"browse"},ze={class:"no-data-placeholder mr-5"},Oe=B({__name:"Browse",props:{corpusArr:{default:()=>[]},volumeLabel:{default:"Volume"},textLabel:{default:"Text"},isLoading:{type:Boolean,default:!1}},emits:["chosen"],setup(a,{emit:e}){const s={get chosen(){return{volume:"",text:""}}},n=e,l=U("volume"),t=U("text");l.value&&y(),t.value&&o(),J(o),ce(()=>{l.value=null,t.value=null});const r=d(()=>{if(l.value)return a.corpusArr.find(({volumeName:p})=>p===l.value)}),c=d(()=>r.value?r.value.texts:[]);function m(p,v){v==="volume"?(t.value=null,y()):o()}function o(){n("chosen",{volume:l.value,text:t.value})}function y(){n("chosen",s.chosen)}return(p,v)=>(u(),h("div",Ue,[k(re,{modelValue:g(l),"onUpdate:modelValue":[v[0]||(v[0]=i=>P(l)?l.value=i:null),v[1]||(v[1]=i=>m(i,"volume"))],items:p.corpusArr,label:p.isLoading?"Loading...":p.volumeLabel,disabled:p.isLoading,"item-title":"volumeName","item-value":"volumeName",variant:"outlined",density:"compact"},null,8,["modelValue","items","label","disabled"]),k(re,{modelValue:g(t),"onUpdate:modelValue":[v[2]||(v[2]=i=>P(t)?t.value=i:null),v[3]||(v[3]=i=>m(i,"text"))],items:c.value,label:p.isLoading?"Loading...":p.textLabel,disabled:p.isLoading||!g(l),"item-title":"textName","item-value":"textNumber",variant:"outlined",density:"compact"},{"no-data":T(()=>[v[4]||(v[4]=x("span",{class:"no-data-arrow"},"⬅",-1)),x("span",ze,K(`A ${p.volumeLabel} should be chosen`),1)]),_:1},8,["modelValue","items","label","disabled"])]))}}),je=A(Oe,[["__scopeId","data-v-e627f564"]]),Fe={},Pe={height:"32",viewBox:"2 9 20 8",width:"32",xmlns:"http://www.w3.org/2000/svg"};function Ge(a,e){return u(),h("svg",Pe,e[0]||(e[0]=[x("path",{d:"M4.616 18q-.691 0-1.153-.462T3 16.384V7.616q0-.691.463-1.153T4.615 6h14.77q.69 0 1.152.463T21 7.616v8.769q0 .69-.463 1.153T19.385 18zm0-1h14.769q.23 0 .423-.192t.192-.424V7.616q0-.231-.192-.424T19.385 7H4.615q-.23 0-.423.192T4 7.616v8.769q0 .23.192.423t.423.192M9 15.77h6q.31 0 .54-.221q.23-.22.23-.549q0-.31-.23-.54t-.54-.23H9q-.31 0-.54.221q-.23.22-.23.549q0 .31.23.54t.54.23M4 17V7zm2-7.23q.31 0 .54-.23T6.77 9t-.23-.54T6 8.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23T9.77 9t-.23-.54T9 8.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m-12 3q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23m3 0q.31 0 .54-.23t.23-.54t-.23-.54t-.54-.23t-.54.23t-.23.54t.23.54t.54.23"},null,-1)]))}const We=A(Fe,[["render",Ge],["__scopeId","data-v-b43887a6"]]),Je={class:"input-wrapper"},Qe=["value","type","size"],Xe=B({__name:"DsInput",props:xe({type:{default:"text"},label:{default:""},clearable:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const e=S(null),s=ie(a,"modelValue"),n=d(()=>a.clearable&&s.value);function l(t){var r;s.value=((r=t==null?void 0:t.target)==null?void 0:r.value)||""}return(t,r)=>(u(),h("div",Je,[x("input",{ref_key:"input",ref:e,value:s.value,type:t.type,size:t.label.length+1,placeholder:"",class:E({"has-content":s.value}),onInput:l},null,42,Qe),x("label",null,K(t.label),1),x("button",{type:"button",class:E(["clear-btn",{"visually-hidden":!n.value}]),"aria-label":"Clear",onClick:r[0]||(r[0]=c=>s.value="")}," × ",2)]))}}),ue=A(Xe,[["__scopeId","data-v-9d202ec7"]]),Ye=B({__name:"DsModal",props:{isShown:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},cancelable:{type:Boolean,default:!1},clickClosable:{type:Boolean,default:!1}},setup(a){const e=S();de(()=>a.isShown,t=>{t?s():n()},{immediate:!0}),_e(e,"cancel",t=>{a.cancelable||t.preventDefault()});function s(){e.value&&e.value.showModal()}function n(){e.value&&e.value.close()}function l(){e.value&&a.clickClosable&&e.value.close()}return(t,r)=>(u(),h("dialog",{ref_key:"dialog",ref:e,class:E({fullscreen:t.fullscreen}),onClick:G(l,["self"])},[ve(t.$slots,"default",{},void 0,!0)],2))}}),Ze=A(Ye,[["__scopeId","data-v-00d05337"]]),et={class:"searchers-grid"},tt={class:"instruments"},st=B({__name:"Search",props:{textusLabel:{default:"Search corpus"},versioLabel:{default:"Search translation"}},emits:["searchers","copy-to-clipboard"],setup(a,{emit:e}){const s=a,n={get searchers(){return{textus:null,versio:null}}},l=e,t=S(n.searchers),r=S(n.searchers),c=S(!1),m=S(null),o=U("textus"),y=U("versio");t.value.textus=o.value,t.value.versio=y.value;const p=d(()=>!t.value.textus&&!t.value.versio),v=d(()=>[{name:"textus",value:t.value.textus,label:s.textusLabel},{name:"versio",value:t.value.versio,label:s.versioLabel}]);function i(q,N){t.value[N]=q||"",q||b()}function f(q){t.value.textus=q,c.value&&b()}function b(){r.value=D.cloneDeep(t.value),l("searchers",D.cloneDeep(r.value)),C()}function C(){o.value=r.value.textus||null,y.value=r.value.versio||null}return J(()=>{b(),t.value.textus=o.value,t.value.versio=y.value,(t.value.textus||t.value.versio)&&b(),m.value=document.querySelector(".searchers-grid .input_textus input")}),ce(()=>{o.value=null,y.value=null}),(q,N)=>(u(),h(I,null,[x("div",et,[(u(!0),h(I,null,H([v.value[0]],({value:_,label:V,name:L})=>(u(),$(ue,{key:L,"model-value":_,label:V,class:E(`input_${L}`),clearable:"","onUpdate:modelValue":z=>i(z,L),onKeydown:te(G(b,["prevent"]),["enter"])},null,8,["model-value","label","class","onUpdate:modelValue","onKeydown"]))),128)),k(ne,{value:v.value[0].value,"input-el":m.value,class:"keyboard-regex",type:"regex",visible:"",onSubmit:f},null,8,["value","input-el"]),(u(!0),h(I,null,H([v.value[1]],({value:_,label:V,name:L})=>(u(),$(ue,{key:L,"model-value":_,label:V,class:E(`input_${L}`),clearable:"","onUpdate:modelValue":z=>i(z,L),onKeydown:te(G(b,["prevent"]),["enter"])},null,8,["model-value","label","class","onUpdate:modelValue","onKeydown"]))),128)),x("div",tt,[k(We,{class:"keyboard-icon",onClick:N[0]||(N[0]=_=>c.value=!0)}),k(F,{disabled:p.value,variant:"outlined",class:"search-btn",color:"success",onClick:b},{default:T(()=>N[2]||(N[2]=[j(" Search ")])),_:1},8,["disabled"]),ve(q.$slots,"default",{class:"slot"},void 0,!0)])]),k(Ze,{"is-shown":c.value,fullscreen:""},{default:T(()=>[k(ne,{visible:c.value,value:t.value.textus,"input-name":a.textusLabel,"onUpdate:visible":N[1]||(N[1]=_=>c.value=_),onSubmit:f},null,8,["visible","value","input-name"])]),_:1},8,["is-shown"])],64))}}),at=A(st,[["__scopeId","data-v-17aa5b43"]]),me=300;function O({hash:a="",keepLocation:e=!1,className:s="chosen"}){return new Promise(n=>{setTimeout(()=>{e||(location.hash=a,setTimeout(()=>scrollBy(0,-200),0));const l=document.querySelector(a);l&&(l.classList.add(s),setTimeout(n,1))},me)})}function lt(a){const e=document.querySelector(a);e&&W(e)}function W(a,e="chosen"){a&&setTimeout(()=>{a.classList.remove(e)},me)}const nt=["id"],ot={class:"controls-wrapper"},rt={class:"lines"},ut=B({__name:"LineCard",props:{line:{},searchers:{}},setup(a){const e=a,s=S(),n=Q(),l=we(),t=d(()=>Te.map(i=>({lineName:i,str:e.line[i],searcher:e.searchers.data[i]}))),r=d(()=>!e.searchers.areAllEmpty),c=d(()=>n.hash),m=d(()=>"#"+e.line.hash),o=d(()=>{var b;const i=((b=e.line)==null?void 0:b.volumeName.toLowerCase())||"";return i.includes("abou")?"":["jastrow","ritter","arnold","lehrbuch","luf","prym","hors","talay","baxa","ubbadin","maalula","lieder","britta"].some(C=>i.includes(C))?"German":""});function y(){W(s.value,"chosen")}de(c,(i,f)=>{!i&&f&&y()});async function p(){if(!r.value)return;const{volumeName:i,textNumber:f}=e.line;await l.push({query:{mode:R.browse,volume:i,text:f}}),await O({hash:m.value})}function v(){if(!n.hash){O({hash:m.value});return}lt(n.hash),n.hash===m.value?l.replace({query:n.query,hash:""}):(O({hash:m.value,keepLocation:!0}),l.replace({query:n.query,hash:m.value}));const i=Array.from(document.querySelectorAll('div.line-card[id^="h"]'));for(const f of i)f.style.background&&f.id!==e.line.hash&&W(f)}return(i,f)=>i.line?(u(),h("div",{key:0,class:"line-card",id:i.line.hash,ref_key:"lineCardRef",ref:s},[x("div",ot,[r.value?(u(),h("div",{key:1,class:"control-sign",onClick:f[1]||(f[1]=b=>p())},"▤")):(u(),h("div",{key:0,class:"control-sign",onClick:f[0]||(f[0]=b=>v())},"#"))]),x("div",rt,[(u(!0),h(I,null,H(t.value,(b,C)=>(u(),$(Be,ke({ref_for:!0},b,{key:C,"translation-language":b.lineName==="versio"&&o.value,class:"mb-1"}),null,16,["translation-language"]))),128)),f[2]||(f[2]=x("div",null,[x("br")],-1))])],8,nt)):M("",!0)}}),it=A(ut,[["__scopeId","data-v-bed2a0ad"]]),ct={key:1},dt=B({__name:"Results",props:{results:{},searchers:{},disableInfinite:{type:Boolean,default:!1}},setup(a){const e=window,s=S(),n=Q(),l=Se(),t=Ne(l,"isDark"),r=d(()=>!a.searchers.areAllEmpty);return J(async()=>{var m;const c=n.hash;c&&(await Ae(1e3),(m=document.querySelector(c))==null||m.scrollIntoView({behavior:"smooth",block:"center"}))}),(c,m)=>(u(),h("div",{class:E(["results w-100",{invert:t.value}])},[r.value?(u(),h("div",{key:0,ref_key:"stats",ref:s,class:"results-stats mb-1"},[x("div",null,"Found "+K(c.results.length)+" contexts",1)],512)):M("",!0),m[0]||(m[0]=x("br",null,null,-1)),c.results?(u(),h("div",ct,[k(Me,{items:c.results,el:g(e),disable:c.disableInfinite},{default:T(({items:o})=>[(u(!0),h(I,null,H(o,y=>(u(),h("div",null,[y?(u(),$(it,{line:y,searchers:c.searchers,key:y.hash},null,8,["line","searchers"])):M("",!0)]))),256))]),_:1},8,["items","el","disable"])])):M("",!0)],2))}}),vt=A(dt,[["__scopeId","data-v-80cc1f4a"]]),mt={key:1,class:"loading-indicator"},ht={key:2,class:"error-indicator"},pt={key:4,class:"error-indicator"},ft=B({__name:"BrowseAndSearch",setup(a){const e=De(),s=Le(),n=d(()=>!!s.text.value),l=d(()=>o.value===R.search),t=d(()=>o.value===R.browse),r=d(()=>l.value?p.value:m.searchers),c=S(!1);qe(Ee.isEager,c);const m={get searchers(){return new oe({textus:"",versio:""})}},o=U("mode"),y=Q();Ve(()=>y,()=>{o.value||(o.value=R.search)},{immediate:!0,deep:!0});const p=S(m.searchers),v=S({volume:null,text:null}),i=d(()=>{if(!v.value.text||!e.corpusArray.length)return[];const _=D.find(e.corpusArray,{volumeName:v.value.volume});return D.find(_.texts,{textNumber:v.value.text}).contents}),f=d(()=>e.corpusLines),b=d(()=>p.value.areAllEmpty?[]:f.value.filter(p.value.test)),C=d(()=>o.value===R.browse?i.value:b.value);function q(_){se(()=>{p.value=new oe(_)})}function N(_){se(()=>{v.value=_})}return(_,V)=>(u(),h("div",{class:E([{"no-hashes":n.value},"browse-and-search"]),ref:"wrapper"},[l.value&&!g(e).isLoading?(u(),$(at,{key:0,"corpus-arr-prop":g(e).corpusArray,"textus-label":"Aramaic text","versio-label":"Translation text",onSearchers:q},{default:T(()=>[k(Ie,{count:C.value.length,onClick:V[0]||(V[0]=L=>c.value=!0)},null,8,["count"])]),_:1},8,["corpus-arr-prop"])):l.value&&g(e).isLoading?(u(),h("div",mt," Loading corpus data... ")):l.value&&g(e).error?(u(),h("div",ht," Error loading corpus data. Please try refreshing the page. ")):t.value?(u(),$(je,{key:3,"corpus-arr":g(e).corpusArray,"is-loading":g(e).isLoading,onChosen:N},null,8,["corpus-arr","is-loading"])):M("",!0),t.value&&g(e).error?(u(),h("div",pt," Error loading corpus data. Please try refreshing the page. ")):M("",!0),k(vt,{results:C.value,searchers:r.value,"disable-infinite":t.value},null,8,["results","searchers","disable-infinite"]),k(g(Ce),{to:"#app-bar-slot"},{default:T(()=>[k(Ke,{modelValue:g(o),"onUpdate:modelValue":V[1]||(V[1]=L=>P(o)?o.value=L:null),class:"mr-5 button-switcher"},null,8,["modelValue"])]),_:1})],2))}}),St=A(ft,[["__scopeId","data-v-b59dbf18"]]);export{St as B};
