import{d as A,c,E as p,b as L,a as E,o as _,f as x,n as v,g as h,m as f,h as M,j as F,V as U,_ as C,aH as N,F as $,i as I}from"./index-DE1r6lH_.js";import{u as S}from"./index-Brl3iKwr.js";import{g as J}from"./getRegexFilterFn-CU_0py8y.js";import{b as P}from"./betterSplit-CW8NIeFU.js";import{u as D,A as O}from"./assetsStore-LwOXJYcf.js";import{_ as Q}from"./InfiniteScrollOld.vue_vue_type_script_setup_true_lang-CqIw1gPC.js";import{V}from"./VTextField-CiDB_Zri.js";import"./VInput-CH6dN1Gu.js";import"./forwardRefs-DWGaNmQL.js";function z(i,a,t="application/octet-stream"){const l=document.createElement("a"),n=new Blob([i],{type:t});l.href=URL.createObjectURL(n),l.download=a,l.click()}function m(i,a,t="",l=!1){const s=(t?`color: ${t};`:"")+(l?"font-weight: bold;":""),e=s?` style='${s}'`:"";return`<${a}${e}>${i}</${a}>`}function G(i){const a=i.map(t=>`(?:${t})`).join("|");return RegExp(a)}const y=m("<br>","div"),q=`=============
`,k=A("calStore",()=>{const i=D(),a=c(()=>{var o;return((o=i[O.calJson].data)==null?void 0:o.split(q).filter(Boolean).map(d=>d.split(`
`)).map(([d,...b])=>({entryName:d.replace(/\.txt$/,""),contents:b,contentsString:b.join(`
`)})))||[]}),t=S("positive",""),l=S("negative",""),n=S("highlight",""),r=c(()=>({positive:t.value,negative:l.value,highlight:n.value})),s=c(()=>p.mapValues(r.value,X)),e=c(()=>!s.value.positive.length&&!s.value.negative.length),u=c(()=>J(s.value.positive.map(o=>RegExp(o)),s.value.negative.map(o=>RegExp(o)))),g=c(()=>e.value?[]:a.value.filter(o=>u.value(o.contentsString))),T=c(()=>{const o=p.mapValues(s.value,d=>d.some(p.identity)&&d.join(", "));return[o.positive&&`Should contain: ${o.positive}`,o.negative&&`Should not contain: ${o.negative}`,o.highlight&&`Highlight: ${o.highlight}`].filter(Boolean).map(d=>m(d,"div","brown",!0))}),j=c(()=>{if(!g.value.length)return"";const o=[`Total: ${g.value.length} entries`].map(b=>m(b,"div","green",!0)),d=m("=".repeat(25),"div");return[...T.value,o,d].join(y)}),B=c(()=>p.values(s.value).flat()),R=c(()=>G(B.value)),w=c(()=>{if(!g.value.length)return[];const o=g.value.map(W(R.value));return[j.value,y,...o]}),H=c(()=>w.value.join(""));return{cal:a,positive:t,negative:l,highlight:n,searchers:r,searchObj:s,isNoSearch:e,calMatchingParts:w,calMatchingHTML:H}});function K(i){return function(a){const t=P(a,i).reduce((l,n,r)=>{const s=r%2?"red":"",e=r%2;return l+m(n,"span",s,e)},"");return m(t,"div")}}function W(i){return function({entryName:a,contents:t}){const l=m("+".repeat(25),"div","blue"),n=m(a,"div","purple",!0),r=t.map(K(i));return[n,...r,l,y].join("")}}function X(i){return p.chain(i).split(",").map(p.trim).compact().value()}const Y={class:"inputs"},Z={class:"input-block"},ee={class:"input-block"},te={class:"input-block"},ne=L({__name:"CalInputs",emits:["download"],setup(i,{emit:a}){const t=k(),l=a,n=E(t.searchers),r=p.debounce(()=>{p.assign(t,n)},1e3);return(s,e)=>(_(),x("div",Y,[v("div",Z,[h(V,{modelValue:n.positive,"onUpdate:modelValue":[e[0]||(e[0]=u=>n.positive=u),f(r)],variant:"outlined",density:"compact",autocomplete:"no",label:"Should contain","min-width":"200px","max-width":"350px",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),e[4]||(e[4]=v("div",{class:"input-block__hint"},"e.g. Gal, Sam, CPA ",-1))]),v("div",ee,[h(V,{modelValue:n.negative,"onUpdate:modelValue":[e[1]||(e[1]=u=>n.negative=u),f(r)],variant:"outlined",density:"compact",autocomplete:"no",label:"Should not contain","min-width":"200px","max-width":"350px",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),e[5]||(e[5]=v("div",{class:"input-block__hint"},"e.g. Syr, JBA, Man, Com",-1))]),v("div",te,[h(V,{modelValue:n.highlight,"onUpdate:modelValue":[e[2]||(e[2]=u=>n.highlight=u),f(r)],variant:"outlined",density:"compact",autocomplete:"no",label:"Also highlight","min-width":"200px","max-width":"350px",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),e[6]||(e[6]=v("div",{class:"input-block__hint"},"e.g. LJLA, Qumran, Jud",-1))]),h(U,{disabled:f(t).isNoSearch,color:"green",variant:"outlined",class:"button",size:"large",onClick:e[3]||(e[3]=u=>l("download"))},{default:M(()=>e[7]||(e[7]=[F(" Download ")])),_:1},8,["disabled"])]))}}),oe=C(ne,[["__scopeId","data-v-a488ec33"]]),ae=["innerHTML"],le=L({__name:"CalSearch",setup(i){const a=k(),{calMatchingParts:t,calMatchingHTML:l}=N(a),n=()=>{z(l.value,"result.html")};return(r,s)=>(_(),x($,null,[h(oe,{onDownload:n}),h(Q,{items:f(t),class:"search-results-box"},{default:M(({items:e})=>[(_(!0),x($,null,I(e,(u,g)=>(_(),x("div",{key:g},[v("div",{innerHTML:u},null,8,ae)]))),128))]),_:1},8,["items"])],64))}}),ge=C(le,[["__scopeId","data-v-e1d8d18b"]]);export{ge as default};
