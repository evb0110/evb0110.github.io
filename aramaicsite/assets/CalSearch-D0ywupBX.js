import{d as A,c as i,E as v,b as w,aH as E,aI as F,a as U,o as y,f as _,n as b,g as f,m as S,h as T,j as N,V as I,ag as J,_ as j,aJ as D,F as M,i as P}from"./index-R3iIKeaL.js";import{u as $}from"./index-B9UyFapI.js";import{g as z}from"./getRegexFilterFn-CU_0py8y.js";import{b as O}from"./betterSplit-CW8NIeFU.js";import{u as Q,A as G}from"./assetsStore-3EU0VO8y.js";import{_ as q}from"./InfiniteScrollOld.vue_vue_type_script_setup_true_lang-BaKYyXE_.js";import{V as x}from"./VTextField-D1yIH6Xy.js";import"./VInput-Dnk46INa.js";import"./forwardRefs-DWGaNmQL.js";function K(l,o,t="application/octet-stream"){const a=document.createElement("a"),u=new Blob([l],{type:t});a.href=URL.createObjectURL(u),a.download=o,a.click()}function g(l,o,t="",a=!1){const r=(t?`color: ${t};`:"")+(a?"font-weight: bold;":""),s=r?` style='${r}'`:"";return`<${o}${s}>${l}</${o}>`}function W(l){const o=l.map(t=>`(?:${t})`).join("|");return RegExp(o)}const C=g("<br>","div"),X=`=============
`,B=A("calStore",()=>{const l=Q(),o=i(()=>{var e;return((e=l[G.calJson].data)==null?void 0:e.split(X).filter(Boolean).map(d=>d.split(`
`)).map(([d,...V])=>({entryName:d.replace(/\.txt$/,""),contents:V,contentsString:V.join(`
`)})))||[]}),t=$("positive",""),a=$("negative",""),u=$("highlight",""),c=i(()=>({positive:t.value,negative:a.value,highlight:u.value})),r=i(()=>v.mapValues(c.value,ee)),s=i(()=>!r.value.positive.length&&!r.value.negative.length),h=i(()=>z(r.value.positive.map(e=>RegExp(e)),r.value.negative.map(e=>RegExp(e)))),p=i(()=>s.value?[]:o.value.filter(e=>h.value(e.contentsString))),n=i(()=>{const e=v.mapValues(r.value,d=>d.some(v.identity)&&d.join(", "));return[e.positive&&`Should contain: ${e.positive}`,e.negative&&`Should not contain: ${e.negative}`,e.highlight&&`Highlight: ${e.highlight}`].filter(Boolean).map(d=>g(d,"div","brown",!0))}),m=i(()=>{if(!p.value.length)return"";const e=[`Total: ${p.value.length} entries`].map(V=>g(V,"div","green",!0)),d=g("=".repeat(25),"div");return[...n.value,e,d].join(C)}),R=i(()=>v.values(r.value).flat()),H=i(()=>W(R.value)),L=i(()=>{if(!p.value.length)return[];const e=p.value.map(Z(H.value));return[m.value,C,...e]}),k=i(()=>L.value.join(""));return{cal:o,positive:t,negative:a,highlight:u,searchers:c,searchObj:r,isNoSearch:s,calMatchingParts:L,calMatchingHTML:k}});function Y(l){return function(o){const t=O(o,l).reduce((a,u,c)=>{const r=c%2?"red":"",s=c%2;return a+g(u,"span",r,s)},"");return g(t,"div")}}function Z(l){return function({entryName:o,contents:t}){const a=g("+".repeat(25),"div","blue"),u=g(o,"div","purple",!0),c=t.map(Y(l));return[u,...c,a,C].join("")}}function ee(l){return v.chain(l).split(",").map(v.trim).compact().value()}const te={class:"rows"},ne=w({__name:"CalInputs",emits:["download"],setup(l,{emit:o}){E(p=>({"4f14506d":u.value,"252624f5":a.value}));const t=F(),a=i(()=>t.current.value.colors.background),u=i(()=>t.current.value.colors.header),c=B(),r=o,s=U(c.searchers),h=v.debounce(()=>{v.assign(c,s)},1e3);return(p,n)=>(y(),_("div",{class:J([{invert:p.isDark},"inputs"])},[b("div",te,[f(x,{modelValue:s.positive,"onUpdate:modelValue":[n[0]||(n[0]=m=>s.positive=m),S(h)],variant:"outlined",density:"compact",autocomplete:"no",label:"Should contain",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n[4]||(n[4]=b("div",{class:"hint"},"e.g. Gal, Sam, CPA ",-1)),f(x,{modelValue:s.negative,"onUpdate:modelValue":[n[1]||(n[1]=m=>s.negative=m),S(h)],variant:"outlined",density:"compact",autocomplete:"no",label:"Should not contain",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n[5]||(n[5]=b("div",{class:"hint"},"e.g. Syr, JBA, Man, Com",-1)),f(x,{modelValue:s.highlight,"onUpdate:modelValue":[n[2]||(n[2]=m=>s.highlight=m),S(h)],variant:"outlined",density:"compact",autocomplete:"no",label:"Also highlight",clearable:"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n[6]||(n[6]=b("div",{class:"hint"},"e.g. LJLA, Qumran, Jud",-1))]),f(I,{disabled:S(c).isNoSearch,color:"green",variant:"outlined",class:"button",size:"large",onClick:n[3]||(n[3]=m=>r("download"))},{default:T(()=>n[7]||(n[7]=[N(" Download ")])),_:1},8,["disabled"])],2))}}),oe=j(ne,[["__scopeId","data-v-9b631500"]]),ae=["innerHTML"],se=w({__name:"CalSearch",setup(l){const o=B(),{calMatchingParts:t,calMatchingHTML:a}=D(o),u=()=>{K(a.value,"result.html")};return(c,r)=>(y(),_(M,null,[f(oe,{onDownload:u}),f(q,{items:S(t),class:"search-results-box"},{default:T(({items:s})=>[(y(!0),_(M,null,P(s,(h,p)=>(y(),_("div",{key:p},[b("div",{innerHTML:h},null,8,ae)]))),128))]),_:1},8,["items"])],64))}}),ge=j(se,[["__scopeId","data-v-e1d8d18b"]]);export{ge as default};
