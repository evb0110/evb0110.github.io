var O=Object.defineProperty;var w=(t,e,s)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>w(t,typeof e!="symbol"?e+"":e,s);import{_ as D,a as N}from"./Searcher-CrE4Ct5O.js";import{i as V,o,b as m,F as k,q as $,n as l,w as g,h as S,t as B,V as f,A as y,e as d,_ as v,x as K,c as C,bj as A,d as E}from"./index-CT75iCmw.js";import{c as W}from"./VDialog-CiFpC8co.js";class _{constructor({key:e,title:s,isChosen:u}){h(this,"key");h(this,"title");h(this,"isChosen");this.key=e,this.title=s,this.isChosen=u}toggle(){this.isChosen=!this.isChosen}choose(){this.isChosen=!0}unchoose(){this.isChosen=!1}static instantiate(e){return new _(e)}}class L{constructor(e){h(this,"data");this.data=e.map(_.instantiate)}optionByKey(e){return this.data.find(s=>s.key===e)}toggle(e){this.optionByKey(e).toggle()}chooseAll(){this.data.forEach(e=>e.choose())}unchooseAll(){this.data.forEach(e=>e.unchoose())}toggleAll(){this.data.areAllChosen?this.unchooseAll():this.chooseAll()}chooseKeys(e){this.unchooseAll(),this.data.forEach(s=>e.includes(s.key)?s.choose():s.unchoose())}get chosenKeys(){return this.data.filter(({isChosen:e})=>e).map(({key:e})=>e)}get areAllChosen(){return this.data.every(e=>e.isChosen)}}const P={class:"container d-flex justify-center"},b=V({__name:"OptionsChooser",props:{optionsProp:{type:Array,default:()=>[]},hasAll:{type:Boolean},chosenOptions:{default:()=>[]}},emits:"chosen-options",setup(t,{emit:e}){const s=t,u=e,r=new L(s.optionsProp);r.chooseKeys(s.chosenOptions);const n=c=>{c?r.toggle(c):r.toggleAll(),u("chosen-options",r.chosenKeys)};return(c,a)=>(o(),m("div",P,[(o(!0),m(k,null,$(y(r).data,({title:p,key:i,isChosen:q})=>(o(),l(f,{key:i,variant:q?"outlined":"text",onClick:I=>n(i)},{default:g(()=>[S(B(p),1)]),_:2},1032,["variant","onClick"]))),128)),t.hasAll?(o(),l(f,{key:0,variant:y(r).areAllChosen?"outlined":"text",onClick:a[0]||(a[0]=p=>n())},{default:g(()=>a[1]||(a[1]=[S(" All ")])),_:1},8,["variant"])):d("",!0)]))}}),x=v(b,[["__scopeId","data-v-da919cd2"]]),j={name:"DictsSearch",components:{Searcher:D,SearchResults:N,OptionsChooser:x},props:["corpusName"],data(){return{searcherString:"",disableInfiniteScroll:!1,chosenDictionaries:[]}},computed:{dicts(){return this.$store.getters.dictsByCorpusNames(this.corpusName)},matchingDictLinesArr(){return this.$store.getters.matchingDictLinesArrByCorpus(this.corpusName).filter(({key:t})=>this.chosenDictionaries.includes(t))},query(){const t=this.chosenDictionaries?{dicts:this.chosenDictionaries.join("_")}:{},e=this.searcherString?{search:this.searcherString}:{};return{...t,...e}},searcherStringWrapper(){return new W(this.searcherString)}},watch:{query:{deep:!0,handler(t){K.isEqual(t,this.$route.query)||this.$router.push({query:t})}}},methods:{onSearcherString(t){this.searcherString=t,this.$store.commit("setSearcherString",{corpusName:this.corpusName,searcherString:this.searcherStringWrapper})},onChosenDictionaries(t){this.chosenDictionaries=t}},created(){this.$store.dispatch("initializeDictData",{corpusName:this.corpusName}),this.$route.query.dicts?this.chosenDictionaries=this.$route.query.dicts.split("_"):this.chosenDictionaries=this.$store.getters.dictsByCorpusNames(this.corpusName).filter(({isChosen:t})=>t).map(({key:t})=>t),this.$store.commit("setSearcherString",{corpusName:this.corpusName,searcherString:this.searcherStringWrapper})},mounted(){this.$route.query.search&&this.onSearcherString(this.$route.query.search)}};function F(t,e,s,u,r,n){const c=D,a=x,p=N;return o(),m("div",null,[C(A,{class:"searcher-wrapper"},{default:g(()=>[C(c,{"searcher-string":r.searcherString,"corpus-name":s.corpusName,onSearcherString:n.onSearcherString},null,8,["searcher-string","corpus-name","onSearcherString"])]),_:1}),n.dicts.length>1?(o(),l(a,{key:0,"options-prop":n.dicts,"chosen-options":r.chosenDictionaries,"has-all":"",onChosenOptions:n.onChosenDictionaries},null,8,["options-prop","chosen-options","onChosenOptions"])):d("",!0),(o(!0),m(k,null,$(n.matchingDictLinesArr,i=>(o(),l(A,{key:i.key},{default:g(()=>[E("h1",null,B(i.title),1),i.lines.length?(o(),l(p,{key:0,"lines-matching":i.lines,"searcher-string":n.searcherStringWrapper},null,8,["lines-matching","searcher-string"])):d("",!0)]),_:2},1024))),128))])}const H=v(j,[["render",F]]);export{H as _};
