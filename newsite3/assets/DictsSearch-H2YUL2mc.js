var q=Object.defineProperty;var w=(s,e,t)=>e in s?q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>w(s,typeof e!="symbol"?e+"":e,t);import{_ as D,a as N}from"./Searcher-B_hLNULA.js";import{d as V,o,f as m,F as k,x as $,s as l,w as g,k as S,t as B,V as f,h as y,l as d,_ as v,A as K,c as C,bs as A,i as E}from"./index-eAgdvAXd.js";import{c as W}from"./VDialog-Bzj42sgH.js";class _{constructor({key:e,title:t,isChosen:u}){h(this,"key");h(this,"title");h(this,"isChosen");this.key=e,this.title=t,this.isChosen=u}toggle(){this.isChosen=!this.isChosen}choose(){this.isChosen=!0}unchoose(){this.isChosen=!1}static instantiate(e){return new _(e)}}class L{constructor(e){h(this,"data");this.data=e.map(_.instantiate)}optionByKey(e){return this.data.find(t=>t.key===e)}toggle(e){this.optionByKey(e).toggle()}chooseAll(){this.data.forEach(e=>e.choose())}unchooseAll(){this.data.forEach(e=>e.unchoose())}toggleAll(){this.data.areAllChosen?this.unchooseAll():this.chooseAll()}chooseKeys(e){this.unchooseAll(),this.data.forEach(t=>e.includes(t.key)?t.choose():t.unchoose())}get chosenKeys(){return this.data.filter(({isChosen:e})=>e).map(({key:e})=>e)}get areAllChosen(){return this.data.every(e=>e.isChosen)}}const P={class:"container d-flex justify-center"},b=V({__name:"OptionsChooser",props:{optionsProp:{type:Array,default:()=>[]},hasAll:{type:Boolean},chosenOptions:{default:()=>[]}},emits:"chosen-options",setup(s,{emit:e}){const t=s,u=e,r=new L(t.optionsProp);r.chooseKeys(t.chosenOptions);const n=c=>{c?r.toggle(c):r.toggleAll(),u("chosen-options",r.chosenKeys)};return(c,a)=>(o(),m("div",P,[(o(!0),m(k,null,$(y(r).data,({title:p,key:i,isChosen:O})=>(o(),l(f,{key:i,variant:O?"outlined":"text",onClick:I=>n(i)},{default:g(()=>[S(B(p),1)]),_:2},1032,["variant","onClick"]))),128)),s.hasAll?(o(),l(f,{key:0,variant:y(r).areAllChosen?"outlined":"text",onClick:a[0]||(a[0]=p=>n())},{default:g(()=>a[1]||(a[1]=[S(" All ")])),_:1},8,["variant"])):d("",!0)]))}}),x=v(b,[["__scopeId","data-v-da919cd2"]]),j={name:"DictsSearch",components:{Searcher:D,SearchResults:N,OptionsChooser:x},props:["corpusName"],data(){return{searcherString:"",disableInfiniteScroll:!1,chosenDictionaries:[]}},computed:{dicts(){return this.$store.getters.dictsByCorpusNames(this.corpusName)},matchingDictLinesArr(){return this.$store.getters.matchingDictLinesArrByCorpus(this.corpusName).filter(({key:s})=>this.chosenDictionaries.includes(s))},query(){const s=this.chosenDictionaries?{dicts:this.chosenDictionaries.join("_")}:{},e=this.searcherString?{search:this.searcherString}:{};return{...s,...e}},searcherStringWrapper(){return new W(this.searcherString)}},watch:{query:{deep:!0,handler(s){K.isEqual(s,this.$route.query)||this.$router.push({query:s})}}},methods:{onSearcherString(s){this.searcherString=s,this.$store.commit("setSearcherString",{corpusName:this.corpusName,searcherString:this.searcherStringWrapper})},onChosenDictionaries(s){this.chosenDictionaries=s}},created(){this.$store.dispatch("initializeDictData",{corpusName:this.corpusName}),this.$route.query.dicts?this.chosenDictionaries=this.$route.query.dicts.split("_"):this.chosenDictionaries=this.$store.getters.dictsByCorpusNames(this.corpusName).filter(({isChosen:s})=>s).map(({key:s})=>s),this.$store.commit("setSearcherString",{corpusName:this.corpusName,searcherString:this.searcherStringWrapper})},mounted(){this.$route.query.search&&this.onSearcherString(this.$route.query.search)}};function F(s,e,t,u,r,n){const c=D,a=x,p=N;return o(),m("div",null,[C(A,{class:"searcher-wrapper"},{default:g(()=>[C(c,{"searcher-string":r.searcherString,"corpus-name":t.corpusName,onSearcherString:n.onSearcherString},null,8,["searcher-string","corpus-name","onSearcherString"])]),_:1}),n.dicts.length>1?(o(),l(a,{key:0,"options-prop":n.dicts,"chosen-options":r.chosenDictionaries,"has-all":"",onChosenOptions:n.onChosenDictionaries},null,8,["options-prop","chosen-options","onChosenOptions"])):d("",!0),(o(!0),m(k,null,$(n.matchingDictLinesArr,i=>(o(),l(A,{key:i.key},{default:g(()=>[E("h1",null,B(i.title),1),i.lines.length?(o(),l(p,{key:0,"lines-matching":i.lines,"searcher-string":n.searcherStringWrapper},null,8,["lines-matching","searcher-string"])):d("",!0)]),_:2},1024))),128))])}const H=v(j,[["render",F]]);export{H as _};
