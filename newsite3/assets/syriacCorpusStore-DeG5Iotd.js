import{aK as G,aL as D,aM as U,S as X,r as m,v as k,aN as z,aO as J,A as H}from"./index-eAgdvAXd.js";const Y=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/gu,$=/[\p{M}]|[\u0701-\u0709]|[\u0730-\u074c]/u,q=/(?![\u0701-\u0709]|[\u0730-\u074c])[^\p{M}]/u;class A{static addFlagIfAbsent(e,n){return e.includes(n)?e:e+n}constructor(e){this.id=G(),this.str=e,this._nfd=null,this._stripped=null,this._chunks=null}get nfd(){return this._nfd||this.cacheNFD(),this._nfd}get stripped(){return this._stripped||this.cacheStripped(),this._stripped}get chunks(){return this._chunks||this.cacheChunks(),this._chunks}cacheNFD(){this._nfd||(this._nfd=this.str.normalize("NFD"))}cacheStripped(){this._stripped||(this._stripped=this.nfd.replace(Y,""))}cacheChunks(){this._chunks||(this._chunks=this.str===this.stripped?this.str.split(""):this.makeNFDChunks())}makeNFDChunks(){const e=this.nfd.split(""),n=[];let s=0;n[s]="";for(let r=0;r<e.length;r++)n[s]+=e[r],r+1<e.length&&!$.test(e[r+1])&&q.test(n[s])&&(s++,n[s]="");return n}splitInclusive(e){e=RegExp(e.source,A.addFlagIfAbsent(e.flags,"g"));const n=Array.from(this.stripped.matchAll(e)),s=[];let r=0;for(const o of n){const i=o[0].length,a=o.index;s.push(this.chunks.slice(r,a).join("")),s.push(this.chunks.slice(a,a+i).join("")),r=a+i}return s.push(this.chunks.slice(r).join("")),s}}const b=(t,e)=>e.some(n=>t instanceof n);let L,P;function Q(){return L||(L=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Z(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const v=new WeakMap,C=new WeakMap,g=new WeakMap;function ee(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",i)},o=()=>{n(p(t.result)),r()},i=()=>{s(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",i)});return g.set(e,t),e}function te(t){if(v.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",i),t.removeEventListener("abort",i)},o=()=>{n(),r()},i=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",i),t.addEventListener("abort",i)});v.set(t,e)}let M={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return v.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function F(t){M=t(M)}function ne(t){return Z().includes(t)?function(...e){return t.apply(S(this),e),p(this.request)}:function(...e){return p(t.apply(S(this),e))}}function se(t){return typeof t=="function"?ne(t):(t instanceof IDBTransaction&&te(t),b(t,Q())?new Proxy(t,M):t)}function p(t){if(t instanceof IDBRequest)return ee(t);if(C.has(t))return C.get(t);const e=se(t);return e!==t&&(C.set(t,e),g.set(e,t)),e}const S=t=>g.get(t);function re(t,e,{blocked:n,upgrade:s,blocking:r,terminated:o}={}){const i=indexedDB.open(t,e),a=p(i);return s&&i.addEventListener("upgradeneeded",c=>{s(p(i.result),c.oldVersion,c.newVersion,p(i.transaction),c)}),n&&i.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{o&&c.addEventListener("close",()=>o()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const ie=["get","getKey","getAll","getAllKeys","count"],oe=["put","add","delete","clear"],E=new Map;function x(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(E.get(e))return E.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=oe.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||ie.includes(n)))return;const o=async function(i,...a){const c=this.transaction(i,r?"readwrite":"readonly");let u=c.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),r&&c.done]))[0]};return E.set(e,o),o}F(t=>({...t,get:(e,n,s)=>x(e,n)||t.get(e,n,s),has:(e,n)=>!!x(e,n)||t.has(e,n)}));const ae=["continue","continuePrimaryKey","advance"],R={},_=new WeakMap,j=new WeakMap,ce={get(t,e){if(!ae.includes(e))return t[e];let n=R[e];return n||(n=R[e]=function(...s){_.set(this,j.get(this)[e](...s))}),n}};async function*ue(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,ce);for(j.set(n,e),g.set(n,S(e));e;)yield n,e=await(_.get(n)||e.continue()),_.delete(n)}function N(t,e){return e===Symbol.asyncIterator&&b(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&b(t,[IDBIndex,IDBObjectStore])}F(t=>({...t,get(e,n,s){return N(e,n)?ue:t.get(e,n,s)},has(e,n){return N(e,n)||t.has(e,n)}}));const le="aramaic-site",f="store",y=re(le,1,{upgrade(t){if(!t.objectStoreNames.contains(f))return t.createObjectStore(f)}});class T{static async get(e){return(await y).get(f,e)}static async set(e,n){return(await y).put(f,n,e)}static async delete(e){return(await y).delete(f,e)}static async clear(){return(await y).clear(f)}static async keys(){return(await y).getAllKeys(f)}}const he="ʔbgdhYwzḥṭyklmnsʕpṣqršt",de="AbgdhYwzHTyklmnsCpSqrWt",fe="ܐܒܓܕܗܞܘܙܚܛܝܟܠܡܢܣܥܦܨܩܪܫܬ",[O,K,W]=[he,de,fe].map(t=>t.split("")),we={translitArr:O,translitAnsiArr:K,originalLettersArr:W},pe={pot:{name:"POT with Western vowels",link:D.potJson.link},pnt:{name:"PNT with Western vowels",link:D.pntJson.link},syr:{name:"Syriac Corpus",link:D.syrJson.link}},me=/[\p{M}]|[\u0700-\u070F]|[\u0730-\u074c]/gu,Ie=U("syriacCorpusStore",()=>{const t=X([]),e=m(""),n=m(!1),s=m(!0),r=m(!0),o=m(!0),i=k(()=>s.value?K:O),a=k(()=>{const l=e.value;return o.value?r.value?i.value.reduce((h,B,w)=>{const I=W[w],d=RegExp("(?<!\\\\)"+B,"gu");return h.replace(d,I)},l):l.replace(me,""):l}),c=k(()=>{if(!e.value)return[];const l=RegExp(a.value,"u");return o.value?t.value.filter(h=>l.test(h.line.stripped)):t.value.filter(h=>l.test(h.line.str))});async function u(l){t.value=[],n.value=!0;const h=l.map(d=>z.get(pe[d].link)),w=(await Promise.all(h)).flatMap(({data:d})=>d),I=await ye(w);t.value=I.map(({filename:d,line:V})=>({filename:d,line:new A(V)})),n.value=!1,e.value=""}return{corpus:t,searchString:e,isPreprocessingSyriacCorpus:n,isSimpleSymbols:s,isTranslit:r,doIgnoreDiacritics:o,activeTranslitArr:i,finalSearchString:a,matchingSyriacLines:c,initSyriacCorpus:u}});async function ye(t){const e=await J(t),n=await T.get("syriacCorpus")||{},s=n[e];if(s)return s;const r=t.flatMap(({filename:o,text:i})=>i.split(/\n+/).map(H.trim).map(a=>({filename:o,line:a})));return n[e]=r,await T.set("syriacCorpus",n),r}export{T as I,pe as S,we as s,Ie as u};
